# 論理設計: バックログ移行重複警告 (Unit 006)

## 概要

`prompts/package/prompts/setup.md` の「6. 旧形式バックログ移行」セクションに重複警告機能を追加する論理設計。

## 変更対象

### ファイル

- `prompts/package/prompts/setup.md`

### 変更箇所

#### 1. スキップ条件の説明更新（6.2 移行処理 内）

**現在の記述** (行430付近):

```markdown
**スキップ条件**（以下の項目は移行しない）:
- タイトル行（### 見出し）に取消線（~~）が含まれる
- タイトル行に「対応済み」「完了」が含まれる（本文中の言及は対象外）
- `docs/cycles/backlog/` に同名ファイルが既に存在する
```

**変更後**:

```markdown
**スキップ条件**（以下の項目は移行しない）:
- タイトル行（### 見出し）に取消線（~~）が含まれる
- タイトル行に「対応済み」「完了」が含まれる（本文中の言及は対象外）
- `docs/cycles/backlog/` に同名ファイルが既に存在する（**警告を表示してスキップ**）
```

#### 2. 移行結果サマリの拡張（6.2 移行処理 内）

**現在の記述** (行454-464付近):

```markdown
3. **移行結果サマリ表示**:
   ```
   移行が完了しました。

   - 移行成功: X件
   - スキップ（完了済み）: Y件
   - スキップ（重複）: Z件

   元ファイルは docs/cycles/backlog.md.bak.[タイムスタンプ] として保存されています。
   問題がなければ、後で削除してください。
   ```
```

**変更後**:

```markdown
3. **移行結果サマリ表示**:
   ```
   移行が完了しました。

   - 移行成功: X件
   - スキップ（完了済み）: Y件
   - スキップ（重複）: Z件
   ```

   **重複スキップがある場合（Z > 0）は追加表示**:
   ```
   【警告】以下の項目は既存ファイルと重複するためスキップしました:
   - [ファイル名1] (元タイトル: "[タイトル1]")
   - [ファイル名2] (元タイトル: "[タイトル2]")
   ...

   これらの項目を移行するには、既存ファイルを削除または名前変更してから再度移行を実行してください。
   ```

   **共通の終了メッセージ**:
   ```
   元ファイルは docs/cycles/backlog.md.bak.[タイムスタンプ] として保存されています。
   問題がなければ、後で削除してください。
   ```
```

## 処理フロー

```
[移行開始]
    ↓
[各項目をループ]
    ↓
[ファイル名生成]
    ↓
[重複チェック] ──(重複あり)──→ [警告リストに追加] → [スキップ]
    ↓ (重複なし)
[ファイル作成]
    ↓
[次の項目へ]
    ↓
[ループ完了]
    ↓
[サマリ表示]
    ↓
[重複リストが空でなければ警告表示]
    ↓
[終了]
```

## 非機能要件

- パフォーマンス: N/A（プロンプト修正のため）
- セキュリティ: N/A
- 可用性: N/A

## テスト方針

プロンプトファイルの修正のため、コードテストは不要。設計レビューで以下を確認：
- 指示が明確で曖昧さがないこと
- 既存のフローと整合していること
- 警告メッセージが有用な情報を含んでいること

---

**作成日**: 2026-01-08
