# ドメインモデル: サイクル横断ドキュメント置き場

## 概要

サイクルに依存しない共通資料の配置場所を決定し、管理ガイドラインを定める。

## 現状分析

### 既存ディレクトリ構造

```text
docs/
├── aidlc/           # AI-DLC自体のドキュメント（テンプレート、プロンプト、ガイド）
├── aidlc.toml       # プロジェクト設定
├── cycles/          # サイクルごとのドキュメント
│   ├── rules.md     # 追加ルール（サイクル横断的だが現在ここに配置）
│   ├── v1.0.1/
│   ├── v1.1.0/
│   └── ...
├── development/     # 開発関連
├── translations/    # 翻訳
└── versions/        # バージョン関連
```

### 問題点

1. `docs/cycles/rules.md` はサイクル横断的だが、cycles配下に配置されている
2. プロジェクト固有の設計決定（ADR等）を置く場所が不明確
3. サイクルをまたぐ技術仕様の置き場がない

## ドキュメント分類

### カテゴリ1: AI-DLCフレームワーク（docs/aidlc/）

AI-DLC自体に関するドキュメント。スターターキットに同梱される。

- プロンプト（setup.md, construction.md等）
- テンプレート（intent_template.md等）
- ガイド（ai-agent-allowlist.md等）
- スキル定義

### カテゴリ2: サイクル固有（docs/cycles/vX.X.X/）

特定のサイクルに紐づくドキュメント。

- requirements/（Intent, PR/FAQ）
- story-artifacts/（ユーザーストーリー、Unit定義）
- design-artifacts/（ドメインモデル、論理設計）
- construction/（実装記録）
- operations/（デプロイ、監視）
- history/（履歴）
- plans/（計画）

### カテゴリ3: サイクル横断（docs/shared/）【新規】

プロジェクト固有でサイクルをまたぐドキュメント。

| サブディレクトリ | 内容 | 例 |
|------------------|------|-----|
| `adr/` | Architecture Decision Records | 0001-use-jj-for-version-control.md |
| `specs/` | 技術仕様（長期的な設計決定） | api-versioning-strategy.md |
| `runbooks/` | 運用手順書（サイクルをまたぐ） | incident-response.md |

### カテゴリ4: 開発環境（docs/development/）

開発環境のセットアップや開発者向け情報。

- 環境構築手順
- 開発ツール設定
- ローカルテスト方法

**docs/shared/specs/ との棲み分け**:
- `development/`: 「開発者が環境を整える」ための手順
- `specs/`: 「システムがどう動くか」の技術仕様

### カテゴリ5: プロジェクトルート

- `docs/aidlc.toml` - プロジェクト設定（現状維持）
- `docs/cycles/rules.md` - 追加ルール（現状維持、docs/shared/README.md からリンク）

## ADR導入方針

### フォーマット

軽量なフォーマットを採用（MADR - Markdown Architectural Decision Records）。

```markdown
# XXXX: タイトル

## ステータス
提案中 | 承認 | 非推奨 | 置換（YYYY）

## コンテキスト
決定が必要になった背景・状況

## 決定
採用した決定内容

## 結果
決定による影響（良い面・悪い面）
```

### 命名規則

- ファイル名: `XXXX-<slug>.md`（例: `0001-use-jj-for-version-control.md`）
- 見出し: `# XXXX: タイトル`（ファイル名と同じ番号）
- 連番は4桁ゼロ埋め
- slugはケバブケース

### 運用ルール

1. **作成タイミング**: 重要な技術的決定時（サイクルのConstruction Phase等）
2. **レビュー**: PR/Issue経由で議論
3. **更新**: ステータス変更時のみ（内容は原則変更しない）
4. **対象**: プロジェクト全体に影響する恒久的な決定のみ

### サイクル内決定との棲み分け

| 決定の種類 | 保存先 | 例 |
|------------|--------|-----|
| プロジェクト全体の恒久決定 | docs/shared/adr/ | VCS選択、API設計方針 |
| サイクル固有の設計決定 | docs/cycles/vX.X.X/design-artifacts/ | Unit実装方式 |
| 実験的・暫定的決定 | docs/cycles/vX.X.X/plans/ | 試験的なアプローチ |

**注**: 暫定決定が恒久化する場合は、ADRとして docs/shared/adr/ に昇格させる。

## 配置場所の決定

### 新規ディレクトリ

```text
docs/shared/
├── README.md           # このディレクトリの説明
├── adr/
│   └── README.md       # ADR一覧・運用ルール
├── specs/
│   └── README.md       # 技術仕様一覧
└── runbooks/
    └── README.md       # 運用手順書一覧
```

### 既存ファイルの扱い

| ファイル | 現在の場所 | 対応 | 理由 |
|----------|------------|------|------|
| rules.md | docs/cycles/ | 移動しない | AI-DLCプロンプトから参照されているため |
| monitoring.md | docs/ | 移動しない | 既存参照への影響を避けるため |

**注**: 今回は既存ファイルの移動は行わない（境界条件）。
代わりに `docs/shared/README.md` から既存のサイクル横断ドキュメントへのリンクを設置する。

## ガイドライン

### サイクル横断ドキュメントの判断基準

以下に該当する場合はサイクル横断ドキュメントとして管理:

1. **複数サイクルで参照される**: 特定サイクルに限定されない
2. **長期的な決定**: アーキテクチャ選択、技術スタック決定
3. **運用手順**: サイクルに依存しない定常運用

### サイクル固有にすべきもの

1. そのサイクルでの実装詳細
2. リリースノート
3. 一時的な調査結果

### 境界事例の判断フロー

```text
Q1: 次のサイクルでも参照される？
  No → サイクル固有（docs/cycles/vX.X.X/）
  Yes → Q2へ

Q2: プロジェクト全体の方針・決定？
  No → サイクル固有（ただし参照リンクを設置）
  Yes → Q3へ

Q3: 恒久的な決定？
  No → サイクル固有（将来ADRに昇格検討）
  Yes → サイクル横断（docs/shared/）
```

### 境界事例の例

| ケース | 判断 | 理由 |
|--------|------|------|
| 特定サイクル向け運用手順 | サイクル固有 | 次サイクルで変更の可能性 |
| 期限付き技術仕様 | サイクル固有 | 恒久的でない |
| 実験的アーキテクチャ | サイクル固有（plans/） | 結果次第でADR化 |
| API設計方針 | サイクル横断 | プロジェクト全体に影響 |
