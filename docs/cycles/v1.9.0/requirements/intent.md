# Intent（開発意図）

## プロジェクト名

AI-DLC Starter Kit v1.9.0 - プロンプトモジュール化

## 開発の目的

AI-DLCプロンプトファイル間で重複している共通セクション（約615行）を外部ファイル化し、保守性と一貫性を向上させる。

**背景**:
- 4つのプロンプトファイル（setup, inception, construction, operations）に同一内容が重複
- メンテナンス時に複数ファイルを更新する必要があり、不整合リスクが高い
- プロンプト分析（v1.8.0）で約615行の重複が確認済み

## ターゲットユーザー

- AI-DLCスターターキットを使用する開発者
- AI-DLCスターターキット自体のメンテナー

## ビジネス価値

1. **保守性向上**: 共通ルールの変更が1箇所で完結
2. **一貫性確保**: 全プロンプトで同一のルールが適用される
3. **コンテキスト効率化**: プロンプトサイズ削減によりAIのコンテキスト効率が向上
4. **品質向上**: Operations Phaseのサイズチェック・deprecation管理で品質担保

## 成功基準

| 項目 | 完了条件 | 検証方法 |
|------|---------|---------|
| 外部参照方式PoC | 「ファイルを読み込んでください」指示形式で動作確認 | Claude Code/KiroCLI両方で検証 |
| 共通セクション外部化 | intro.md, rules.md 作成、250行以上削減 | wc -l で削減行数を測定 |
| AIレビューフロー外部化 | review-flow.md 作成、各プロンプトから参照 | 3プロンプトでレビューフロー記述を削除確認 |
| 参照漏れチェック機構 | チェックスクリプト作成 | CI/手動で参照漏れを検出できることを確認 |
| Operations Phaseサイズチェック | サイズ警告機能追加 | 閾値超過時に警告が出ることを確認 |
| deprecation準備 | 対象コード一覧作成、警告メッセージ追加 | deprecation対象がドキュメント化されていることを確認 |
| 設定確認スクリプト整備 | check-backlog-mode.sh, check-gh-status.sh作成 | 約100行の削減を`wc -l`で測定 |
| 複合コマンド廃止 | 複合コマンドを単純コマンドに置換 | `&&`, `||`, `|`, 変数代入がプロンプトから削除されていること |
| アップグレード指示改善 | メタ開発用パス参照追加 | `prompts/package/`パスが追加されていることを確認 |

**備考**: 重複615行のうち、本サイクルでは共通セクション（#76）の250行削減を目標とする。残りはAIレビューフロー（#77）等で段階的に削減。

## 期限とマイルストーン

- **マイルストーン1**: 参照方式のPoC確立（#74）
- **マイルストーン2**: 共通セクション外部ファイル化（#76, #77）
- **マイルストーン3**: 参照漏れチェック・品質管理（#75, #79, #80）

## 制約事項

- **マルチ環境対応**: Claude Code、KiroCLI等の複数環境で動作する方式を採用
- **参照方式**: `@ファイルパス`記法ではなく、「ファイルを読み込んでください」という指示形式を使用（全環境で動作）
- **後方互換性**: 既存の利用プロジェクトに影響を与えない
- **メタ開発の考慮**: `prompts/package/`を編集し、`docs/aidlc/`はrsyncコピー

## スコープ外（Non-goals）

- プロンプトの全面的な再設計（今回はモジュール化のみ）
- テーマB/Dの一部（#81, #85, #93, #94, #88）は後回し

## スコープ

### 優先対応（Must）

| テーマ | Issue | 内容 |
|--------|-------|------|
| A. モジュール化 | #74 | 参照方式のPoC確立 |
| A. モジュール化 | #75 | 参照漏れチェックの仕組み構築 |
| A. モジュール化 | #76 | 共通セクションの外部ファイル化 |
| A. モジュール化 | #77 | AIレビューフローの外部化 |
| B. スクリプト整備 | #78 | 設定確認スクリプトの整備 |
| C. Operations改善 | #79 | Operations Phaseサイズチェック追加 |
| C. Operations改善 | #80 | 後方互換性コードのdeprecation準備 |
| C. Operations改善 | #87 | AIDLCアップグレード指示にメタ開発用パス参照を追加 |
| D. その他 | #34 | 複合コマンド廃止・許可リスト整備 |

### 後回し（Should/バックログ戻し）

| テーマ | Issue | 内容 |
|--------|-------|------|
| B. スクリプト整備 | #81 | env-info.shにセットアップ情報を追加 |
| B. スクリプト整備 | #85 | 各プロンプトの依存コマンド条件分岐を削除 |
| B. スクリプト整備 | #93 | setup.md: env確認の重複解消 |
| B. スクリプト整備 | #94 | setup.md: サイクル一覧取得時の不要項目除外 |
| D. その他 | #88 | init-cycle-dir.sh でプレリリースバージョンをサポート |

## 不明点と質問（Inception Phase中に記録）

[Question] 参照方式はどうするか？
[Answer] `@ファイルパス`記法ではなく、「ファイルを読み込んでください」という指示形式を使用。これによりClaude Code、KiroCLI等の全環境で動作する。PoCで検証する。

[Question] このサイクルの最も重要な目的は？
[Answer] A. プロンプトのモジュール化（共通セクションの外部ファイル化で保守性向上）

[Question] 時間が足りない場合のスコープ調整は？
[Answer] テーマB（スクリプト・設定整備）とテーマD（その他）は後回し可能。テーマA, Cを優先。
