# Unit 004 計画: 参照漏れチェック

## 概要

プロンプト内の外部ファイル参照が正しいかをチェックする機構を導入する。「〜を読み込んでください」形式の参照パターンを検出し、参照先ファイルの存在を検証する。

## 変更対象ファイル

### 新規作成

- `prompts/package/bin/check-references.sh` - 参照漏れ検出スクリプト

### 変更なし（参照対象）

- `prompts/package/` 配下のプロンプトファイル（検証対象として読み込み）

## 実装計画

### Phase 1: 設計

1. **ドメインモデル設計**
   - 参照パターンの定義（「〜を読み込んでください」等）
   - 検出対象ファイルの範囲定義
   - エラー出力フォーマットの設計

2. **論理設計**
   - スクリプトの入出力設計
   - パターンマッチングロジック
   - 終了コードの設計（CI対応）

### Phase 2: 実装

1. **コード生成**
   - 参照漏れ検出スクリプト作成
   - パターンマッチング実装
   - 存在チェック実装

2. **テスト**
   - 正常系テスト（存在するファイルへの参照）
   - 異常系テスト（存在しないファイルへの参照）
   - CI実行を想定した終了コード確認

3. **統合とレビュー**
   - 全プロンプトファイルに対する検証実行
   - AIレビュー
   - 人間レビュー

## 完了条件チェックリスト

- [ ] 参照漏れ検出スクリプトの作成
- [ ] 存在しないファイルへの参照の検出が可能
- [ ] CI/手動実行のサポート（終了コードで結果を返す）

## 技術的考慮事項

- 「〜を読み込んでください」形式のパターンマッチング
- 相対パス・絶対パスの両方に対応
- バックティック内のパス抽出
- スクリプト実行が数秒以内に完了すること

## 依存関係

- Unit 002: 共通セクション外部化（完了）
- Unit 003: AIレビューフロー外部化（完了）
