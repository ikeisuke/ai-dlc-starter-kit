# 論理設計: アップグレード指示改善

## 変更対象

`prompts/setup-prompt.md`

## 変更箇所

### 1. セクション1「実行環境の確認」のガード文を修正

現在の「ai-dlc-starter-kit リポジトリ内なら実行しない」というガードを、メタ開発モードでは許可するように修正。

**現在の記述（86-88行目）**:
```markdown
もし現在のディレクトリが `ai-dlc-starter-kit` リポジトリ内の場合:
- **このままセットアップを実行しないでください**
- **対象プロジェクトのルートディレクトリに移動してから、このファイルのフルパスを指定して再度実行してください**
```

**修正後**:
```markdown
もし現在のディレクトリが `ai-dlc-starter-kit` リポジトリ内の場合:
- **メタ開発モード**: `prompts/package/` ディレクトリが存在する場合は、スターターキット自体の開発として続行できます
- **通常利用**: 対象プロジェクトのルートディレクトリに移動してから、このファイルのフルパスを指定して再度実行してください
```

### 2. セクション8.2「パッケージファイルの同期」の前に環境判定を追加

**追加内容**:

```markdown
### 8.1.1 スターターキットパスの判定【重要】

rsync実行前に、スターターキットパスを特定してください。

**環境判定**:
```bash
# メタ開発環境の判定（prompts/package/ が存在するか）
if [ -d "prompts/package" ]; then
    echo "META_DEV_MODE"
    STARTER_KIT_PATH="."  # 同一リポジトリ内
else
    echo "NORMAL_MODE"
    # ghq形式でパスを構築（docs/aidlc.toml の setup_prompt から取得可能）
    STARTER_KIT_PATH="$(ghq root)/github.com/ikeisuke/ai-dlc-starter-kit"
fi
```

**パス参照の読み替え**:

| 環境 | `[スターターキットパス]` の実際の値 |
|------|-----------------------------------|
| メタ開発 | `.`（カレントディレクトリ = プロジェクトルート） |
| 通常利用 | `$(ghq root)/github.com/ikeisuke/ai-dlc-starter-kit` |

**非ghq環境の場合**:
- ghqを使用していない環境では、スターターキットの絶対パスを手動で指定してください
- 例: `/path/to/ai-dlc-starter-kit`

**メタ開発時の注意**:
- rsync元とrsync先が同一リポジトリ内になる
- `prompts/package/` → `docs/aidlc/` への同期
- 変更は `prompts/package/` で行い、rsyncで `docs/aidlc/` に反映する
```

### 2. rsyncコマンド例にメタ開発用の注釈を追加

各rsyncコマンドブロックの前に以下の注釈を追加:

```markdown
**注意**: `[スターターキットパス]` はセクション8.1.1で判定したパスに置き換えてください。
メタ開発環境の場合は `.`（カレントディレクトリ）になります。
```

## 変更しない箇所

- rsyncコマンド自体のオプションやロジック
- 既存のセクション構造
- その他のセットアップフロー
