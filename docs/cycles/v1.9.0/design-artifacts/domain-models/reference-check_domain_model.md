# ドメインモデル: 参照漏れチェック

## 概要

プロンプトファイル内の外部ファイル参照を検出し、参照先ファイルの存在を検証するチェック機構のドメインモデル。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。実装はImplementation Phase（コード生成ステップ）で行います。

## エンティティ（Entity）

このUnitはシェルスクリプトのためエンティティは定義しない。

## 値オブジェクト（Value Object）

### FileReference

プロンプトファイル内で検出された参照を表す。

- **属性**:
  - sourcePath: String - 参照が記述されているファイルのパス
  - lineNumber: Integer - 参照が記述されている行番号
  - referencedPath: String - 参照されているファイルパス（バックティック内）
  - context: String - 参照の前後のコンテキスト（デバッグ用）
- **不変性**: 検出後は変更しない
- **等価性**: sourcePath + lineNumber + referencedPath の組み合わせで判定

### ValidationResult

参照検証の結果を表す。

- **属性**:
  - reference: FileReference - 検証対象の参照
  - exists: Boolean - 参照先ファイルが存在するか
  - resolvedPath: String - 解決されたファイルパス（存在する場合）
- **不変性**: 検証後は変更しない
- **等価性**: reference の等価性で判定

## 集約（Aggregate）

### ReferenceCheckReport

チェック全体の結果を集約。

- **集約ルート**: ReferenceCheckReport
- **含まれる要素**: ValidationResult のリスト
- **境界**: 1回のチェック実行の結果全体
- **不変条件**:
  - 全ファイルが検査済みであること
  - 結果は重複しないこと

## ドメインサービス

### ReferenceExtractor

ファイルから参照パターンを抽出するサービス。

- **責務**: Markdownファイル内の参照パターン（バックティック内パス + 「を読み込んで」または「を参照して」で始まる形式）を抽出。語尾の揺れ（「ください」「下さい」等）は問わない
- **操作**:
  - extractReferences(filePath) - ファイルから全参照を抽出

### ReferenceValidator

参照先ファイルの存在を検証するサービス。

- **責務**: 抽出された参照の参照先ファイルが存在するかを検証
- **操作**:
  - validate(reference, basePath) - 参照の存在を検証

### ReportFormatter

検証結果を出力するサービス。

- **責務**: 検証結果を人間が読める形式で出力
- **操作**:
  - formatReport(report) - レポートを出力形式に変換

## リポジトリインターフェース

このUnitではファイルシステムを直接使用するため、リポジトリパターンは不要。

## ファクトリ（必要な場合のみ）

不要。

## ユビキタス言語

- **参照（Reference）**: プロンプトファイル内のバックティック内パス + 「を読み込んで」または「を参照して」で始まる形式で記述されたファイルパス（語尾の揺れは問わない）
- **参照元（Source）**: 参照が記述されているファイル
- **参照先（Target）**: 参照によって示されるファイル
- **参照漏れ（Broken Reference）**: 参照先ファイルが存在しない状態
- **検証（Validation）**: 参照先ファイルの存在確認処理
- **パス解決基準**: リポジトリルートを基準として相対パスを解決する（参照元ファイルの位置ではない）

## 不明点と質問（設計中に記録）

（現時点で不明点なし）
