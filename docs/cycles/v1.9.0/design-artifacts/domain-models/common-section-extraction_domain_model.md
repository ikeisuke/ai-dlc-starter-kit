# ドメインモデル設計: 共通セクション外部化

## 概要

各フェーズプロンプト（inception.md, construction.md, operations.md）に重複して記載されている共通セクションを外部ファイルに切り出し、参照形式に変更する。

## ドメイン境界

### 外部化対象（intro.md）

**AI-DLC手法の要約セクション**（各プロンプト5-24行目、約20行）

```markdown
## AI-DLC手法の要約

AI-DLCは、AIを開発の中心に据えた新しい開発手法です...
（主要原則、3つのフェーズ、主要アーティファクト）
```

- 3ファイルで完全に同一
- 変更頻度: 低（手法自体の説明のため）

### 外部化対象（rules.md）

**共通開発ルール**（各プロンプト44-86行目付近、約45行）

| ルール | 行数 | 備考 |
|--------|------|------|
| 人間の承認プロセス | 5行 | 完全共通 |
| 質問と回答の記録 | 1行 | 完全共通 |
| 予想禁止・一問一答質問ルール | 20行 | 完全共通 |
| Gitコミットのタイミング | 7行 | 完全共通 |
| jjサポート設定 | 3行 | 完全共通 |
| コード品質基準参照 | 1行 | 完全共通 |

### 外部化対象外（フェーズ固有）

| セクション | 所属フェーズ | 理由 |
|------------|--------------|------|
| プロンプト履歴管理 | 全フェーズ（内容が異なる） | 履歴ファイルパスがフェーズごとに異なる |
| 気づき記録フロー | Construction | Construction固有の運用 |
| Workaround対応ルール | Construction | Construction固有の運用 |
| 割り込み対応フロー | Construction | Construction固有の運用 |
| AIレビューフロー | 全フェーズ | Unit 003で別途外部化 |

### 外部化対象外（プロジェクト情報）

**プロジェクト情報セクション**は微妙に異なるため、今回は外部化しない。

| 項目 | inception.md | construction.md | operations.md |
|------|--------------|-----------------|---------------|
| 技術スタック | "Inception Phaseで決定" | "Inception Phaseで決定済み、または既存スタックを使用" | "Inception/Construction Phaseで決定済み" |
| ディレクトリ構成 | `prompts/`含む | `プロジェクトルートディレクトリ`含む | `プロジェクトルートディレクトリ`含む |

## エンティティ定義

### 外部ファイル

| ファイル | 作成先（repo内） | デプロイ先 | 責務 | 推定行数 |
|----------|------------------|------------|------|----------|
| intro.md | `prompts/package/prompts/common/intro.md` | `docs/aidlc/prompts/common/intro.md` | AI-DLC手法の要約を提供 | 約20行 |
| rules.md | `prompts/package/prompts/common/rules.md` | `docs/aidlc/prompts/common/rules.md` | 共通開発ルールを提供 | 約45行 |

### 参照指示

Unit 001 PoC結果に基づき、以下の**推奨形式**を使用（Claude Code / KiroCLI 両対応）:

```markdown
**【次のアクション】** 今すぐ `docs/aidlc/prompts/common/intro.md` を読み込んで、内容を確認してください。
**【次のアクション】** 今すぐ `docs/aidlc/prompts/common/rules.md` を読み込んで、内容を確認してください。
```

### 参照指示の挿入位置

各プロンプトのタイトル直後（`# {Phase名} Phase プロンプト` の次行）に挿入する。

## 削減見積もり

### 計算前提

- intro.md: 約20行
- rules.md: 約45行
- 参照指示追加: 3行/ファイル

### 削減計算

| ファイル | 削除行数 | 参照追加 | 純削減 |
|----------|----------|----------|--------|
| inception.md | -65行 | +3行 | -62行 |
| construction.md | -65行 | +3行 | -62行 |
| operations.md | -65行 | +3行 | -62行 |
| **3ファイル計** | **-195行** | **+9行** | **-186行** |

| 外部ファイル追加 | 行数 |
|------------------|------|
| intro.md | +20行 |
| rules.md | +45行 |
| **外部計** | **+65行** |

**最終結果**: 186行削減 - 65行追加 = **約121行の純削減**（重複排除効果）

### 250行以上の削減達成について

- 当初見積もりの250行には本Unitのみでは届かない
- **AIレビューフロー（約70行×3ファイル = 210行）はUnit 003で対応**
- Unit 002（186行） + Unit 003（210行） = 合計で約396行削減となり、目標を大きく上回る

## 質問事項

[Question] 削減目標について確認させてください。Unit定義では「250行以上の削減達成」となっていますが、AIレビューフローがUnit 003で対応されることを考慮すると、本Unitでは約186行の削減となります。これで問題ないでしょうか？

[Answer] 承認。Unit 002では約186行削減、Unit 003（約210行）と合わせて約396行削減となるため、問題なし。
