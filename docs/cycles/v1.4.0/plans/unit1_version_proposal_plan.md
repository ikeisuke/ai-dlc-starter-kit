# Unit 1: サイクルバージョン提案改善 - 実装計画

## 概要

既存サイクルから次バージョンを自動推測し、バージョン番号の入力ミスを防ぐ機能を実装する。

## 現状分析

### 現在の動作（setup-cycle.md セクション2）
- ユーザーに直接バージョンを入力させる
- 既存サイクル一覧は表示するが、推測機能なし

### 問題点
- ユーザーが毎回バージョンを手入力する必要がある
- 入力ミスの可能性がある
- 適切なバージョンが分からない場合がある

## 実装方針

### 変更対象ファイル
- `prompts/setup-cycle.md` のセクション2を改善

### 実装内容

1. **既存サイクル検出**: `docs/cycles/` 内のサイクルを列挙
2. **バージョンパース**: 最新バージョンを `v{major}.{minor}.{patch}` 形式で解析
3. **次バージョン提案**:
   - デフォルト: パッチバージョンをインクリメント（例: v1.3.2 → v1.3.3）
   - オプション: マイナー/メジャーバージョン変更も選択可能
4. **ユーザー確認**: 提案を表示し、承認または変更を受け付け

### 変更箇所

```markdown
## 2. サイクルバージョンの確認

### 2.1 既存サイクルの検出

docs/cycles/ 内の既存サイクルを確認:
```bash
ls -d docs/cycles/*/ 2>/dev/null | sort -V
```

### 2.2 次バージョンの提案

最新バージョンから次バージョンを推測:
- 最新バージョンを解析（例: v1.3.2 → major=1, minor=3, patch=2）
- パッチインクリメントをデフォルト提案（v1.3.3）

ユーザーへ提案:
```
既存サイクル: v1.0.0, v1.1.0, v1.2.0, v1.3.0, v1.3.1, v1.3.2
最新バージョン: v1.3.2

次バージョンの提案:
1. v1.3.3（パッチ - バグ修正・小さな変更）[推奨]
2. v1.4.0（マイナー - 新機能追加）
3. v2.0.0（メジャー - 破壊的変更）
4. その他（カスタム入力）

どれを選択しますか？
```

### 2.3 バージョン確定

ユーザーの選択を受け、重複チェック後にバージョンを確定。
```

## 設計方針

このUnitは**プロンプト編集のみ**のため：
- ドメインモデル設計: 軽量版（概念整理のみ）
- 論理設計: 軽量版（プロンプト構造の設計）
- コード生成: プロンプトファイルの編集
- テスト: 手動確認（新規サイクル開始時に動作確認）

## 成果物

1. 設計ドキュメント
   - `docs/cycles/v1.4.0/design-artifacts/domain-models/unit1_domain_model.md`
   - `docs/cycles/v1.4.0/design-artifacts/logical-designs/unit1_logical_design.md`

2. 実装
   - `prompts/setup-cycle.md` の更新

3. 実装記録
   - `docs/cycles/v1.4.0/construction/units/unit1_implementation.md`

## リスク・考慮事項

- 既存サイクルがない場合のフォールバック処理
- バージョン形式が `vX.Y.Z` 以外の場合の対応
- package.json参照は初回セットアップ（setup-init.md）のみに限定（Unit定義の通り）
