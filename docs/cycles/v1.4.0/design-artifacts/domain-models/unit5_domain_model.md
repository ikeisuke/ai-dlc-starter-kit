# ドメインモデル: Unit 5 AI MCPレビュー推奨

## 概要

MCPサーバーが利用可能な場合に、各フェーズの成果物完了時にレビューを積極的に推奨する機能の概念モデルを定義する。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。実装はImplementation Phase（コード生成ステップ）で行います。

## 注記

本Unitはプロンプト編集のため、従来のDDDドメインモデル（エンティティ、値オブジェクト、集約等）は該当しません。代わりに、MCPレビュー推奨機能の概念モデルを定義します。

---

## 概念モデル

### MCPレビュー推奨（MCP Review Recommendation）

MCPサーバーの利用可否に応じて、成果物完了時にレビューを推奨する仕組み。

#### 構成要素

1. **MCP利用可否判定**
   - 判定条件: 利用可能なツール一覧にMCP関連ツール（`mcp__*`）が存在するか
   - 判定結果: 利用可能 / 利用不可

2. **推奨トリガー（タイミング）**
   - 各フェーズの主要成果物完了時
   - トリガー条件: MCP利用可能 AND 成果物完了

3. **推奨メッセージ**
   - 強いトーンで推奨（任意ではなく推奨）
   - ユーザーの選択を促す

4. **動作分岐**
   - MCP利用可能: 推奨メッセージを表示
   - MCP利用不可: 何も表示しない（スキップ）

---

## 推奨タイミング定義

**タイミング**: ユーザーの承認を求める前

### Inception Phase

| トリガー | 成果物 |
|---------|--------|
| Intent承認前 | Intent定義ファイル |
| ユーザーストーリー承認前 | ユーザーストーリー一覧 |
| Unit定義承認前 | 各Unit定義ファイル |

### Construction Phase

| トリガー | 成果物 |
|---------|--------|
| 設計レビュー（承認）前 | ドメインモデル + 論理設計 |
| コード生成後の確認前 | 実装コード |
| テスト完了後の確認前 | テストコード + 実行結果 |

### Operations Phase

| トリガー | 成果物 |
|---------|--------|
| デプロイ計画承認前 | デプロイ計画書 |
| 運用ドキュメント承認前 | 運用手順書 |

## aidlc.toml での設定

```toml
[rules.mcp_review]
mode = "recommend"  # "recommend" | "required" | "disabled"
```

| mode | MCP利用可否 | 動作 |
|------|-------------|------|
| "required" | 利用可能 | 必須（レビュー実施） |
| "required" | 利用不可 | 警告表示（MCPが必要） |
| "recommend" | 利用可能 | **推奨表示** |
| "recommend" | 利用不可 | 何も表示しない |
| "disabled" | - | 何も表示しない |

**デフォルト値**: "recommend"（設定がない場合）

---

## 推奨メッセージ仕様

### フォーマット

```markdown
### 【レビュー推奨】

別のAIエージェント（Codex MCP等）が利用可能です。
品質向上のため、この成果物のレビューを実施することを推奨します。

**レビュー対象**: [成果物名]

レビューを実施しますか？
```

### 条件付き表示

- プロンプト内で「MCPサーバーが利用可能な場合のみ表示」という条件付き記述
- AIが実行時に判断

---

## ユビキタス言語

- **MCPサーバー**: Model Context Protocol サーバー。外部AIエージェント（Codex等）を提供
- **レビュー推奨**: 成果物の品質向上のため、別のAIによるレビューを促すこと
- **トリガー**: 推奨を表示するきっかけとなる成果物完了イベント

---

## 不明点と質問（設計中に記録）

（現時点で不明点なし）
