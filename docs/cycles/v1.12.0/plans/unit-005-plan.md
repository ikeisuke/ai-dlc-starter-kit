# Unit 005 計画: Codex resume機能活用

## 概要

AIレビューフロー（`review-flow.md`）にCodex Skill のresume機能を組み込み、反復レビュー時にセッションコンテキストを維持する。

## 変更対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `prompts/package/prompts/common/review-flow.md` | セッションID管理とresume呼び出しロジックを追加 |

## 実装計画

### Phase 1: 設計（ドキュメント変更のため簡略化）

このUnitはプロンプトファイルの修正のみであり、コード実装はないため、ドメインモデル・論理設計は省略し、変更設計のみ作成する。

**技術的考慮事項**:
- Unit定義の「技術的考慮事項」セクションに「設計省略」相当の記載があるため、ステップ0.5（設計・実装整合性チェック）はスキップ対象

### Phase 2: 実装

#### ステップ1: review-flow.md の修正

**追加する内容**:

1. **セッションID管理セクション**（処理フローのステップ4内に追加）
   - 初回レビュー実行時: session idを記録する指示
   - 2回目以降: resume を使用する指示

2. **フォールバック処理**
   - resume失敗時（セッション期限切れ等）: 新規セッションで再開

3. **Unit切り替え時のセッションリセット**
   - 別Unitの作業開始時はセッションIDをクリア

**変更箇所の詳細**:

ステップ4「反復レビュー」セクションに以下を追加:

```markdown
### Codex セッション管理（Codexを選択した場合）

**セッションID保持**:
- 初回レビュー実行後、出力末尾の `session id: xxx` を記録
- 2回目以降のレビューでは `codex exec resume <session-id>` を使用

**フォールバック**:
- resume失敗時（セッション期限切れ、エラー等）: 新規セッションで再開し、session idを更新

**Unit切り替え時**:
- 別Unitの作業を開始する際は、セッションIDを破棄し新規セッションで開始
```

---

## 完了条件チェックリスト

- [ ] review-flow.md にセッションID管理の指示が追加されている
- [ ] resume機能を使った継続レビューの手順が記載されている
- [ ] フォールバック処理（resume失敗時の新規セッション開始）が記載されている
