# Unit 012 実装計画: Unit完了条件明確化

## 概要

Unit開始時に完了条件を提示し、終了時に確認するフローを `construction.md` に追加する。

## 関連情報

- **Unit定義**: `docs/cycles/v1.8.0/story-artifacts/units/012-unit-completion-check.md`
- **関連Issue**: #47

## 完了条件チェックリスト

Unit定義から抽出した完了条件：

- [ ] Unit開始時の完了条件チェックリスト生成ロジックが追加されている
- [ ] Unit終了時の完了条件確認フローが追加されている
- [ ] construction.md が更新されている
- [ ] AIレビューを通過している

## 変更対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `prompts/package/prompts/construction.md` | Unit開始時・終了時のフロー追加 |

## 実装計画

### Phase 1: 設計

このUnitはプロンプト修正のみのため、ドメインモデル・論理設計は省略し、変更仕様の設計ドキュメントを作成する。

**成果物**: `docs/cycles/v1.8.0/design-artifacts/logical-designs/unit-completion-check_logical_design.md`

### Phase 2: 実装

#### 変更箇所1: Unit開始時のフロー追加

**場所**: 「5. 実行前確認」セクション（472-476行目付近）の後

**追加内容**:

```markdown
### 5.5 完了条件の確認【重要】

選択されたUnitの定義ファイルから完了条件を抽出し、以下の形式で提示する:

1. Unit定義ファイルの「責務」セクションから完了条件を抽出
2. 関連Issue（あれば）から追加の受け入れ基準を抽出
3. チェックリスト形式で整理
4. ユーザーに提示して確認を得る

**提示フォーマット**:
```text
**完了条件チェックリスト**:
- [ ] 条件1
- [ ] 条件2
- [ ] ...

この条件を満たした時点でUnitを完了とします。よろしいですか？
```

**計画ファイルへの記録**: 計画ファイルに「完了条件チェックリスト」セクションを含める
```

#### 変更箇所2: Unit終了時のフロー追加

**場所**: 「Unit完了時の必須作業」セクションの先頭（「1. Unit定義ファイルの〜」の前）

**追加内容**:

```markdown
### 0. 完了条件の確認【必須】

Unit完了をマークする前に、計画ファイルの「完了条件チェックリスト」を確認する:

1. 計画ファイル（`docs/cycles/{{CYCLE}}/plans/unit-{NNN}-plan.md`）を読み込む
2. 「完了条件チェックリスト」の各項目を確認
3. 結果を以下の形式で提示:

**確認フォーマット**:
```text
**完了条件の確認結果**:
- [x] 条件1 - 達成
- [x] 条件2 - 達成
- [ ] 条件3 - 未達成（理由: ...）

**判定**: すべて達成 / 未達成項目あり
```

4. **すべて達成の場合**: 次のステップ（Unit定義ファイルの更新）へ進む
5. **未達成項目がある場合**:
   - 未達成の理由をユーザーに説明
   - 「未達成のまま完了としますか？」と確認
   - ユーザーが承認した場合のみ完了処理を継続
```

## リスク・考慮事項

- 既存のフローを大きく変更しないため、後方互換性に問題なし
- 計画ファイルに完了条件を記録するため、追跡が容易

## 見積もり

- 設計: 30分
- 実装: 1時間
- レビュー・修正: 30分
