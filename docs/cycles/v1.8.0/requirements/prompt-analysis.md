# プロンプト分析レポート

## 概要

AI-DLCプロンプトの現状を分析し、次サイクルでの最適化作業の土台を作成した。

**分析日**: 2026-01-18
**分析者**: @claude
**関連Issue**: #45

## 分析対象

| ファイル | 行数 | 文字数 | 備考 |
|----------|------|--------|------|
| setup.md | 802 | 27,610 | セットアップ |
| inception.md | 1,032 | 41,359 | Inception Phase |
| construction.md | 907 | 36,427 | Construction Phase |
| operations.md | 1,097 | 42,036 | Operations Phase |
| AGENTS.md | 226 | 8,061 | エージェント設定 |
| CLAUDE.md | 35 | 1,499 | Claude Code固有設定 |
| **合計** | **4,099** | **156,992** | - |

## 重要な前提

**5つのフェーズプロンプト（setup, setup-prompt, inception, construction, operations）は同時には読み込まれない**。各フェーズで1つのプロンプトのみが読み込まれる。

したがって、重複の問題は「ユーザー体験への影響」ではなく「**メンテナンス性の問題**」である。

## 問題箇所サマリ

### 1. 完全重複（推定615行）

| セクション | 影響ファイル数 | 推定重複行数 |
|------------|---------------|--------------|
| AI-DLC手法の要約 | 4 | 72行 |
| 人間の承認プロセス | 3 | 15行 |
| 質問と回答の記録 | 3 | 6行 |
| 予想禁止・一問一答質問ルール | 3 | 60行 |
| Gitコミットのタイミング | 3 | 21行 |
| jjサポート設定 | 4 | 12行 |
| AIレビュー優先ルール | 3 | 240行 |
| 外部入力検証ルール | 3 | 90行 |
| コンテキストリセット対応 | 3 | 75行 |
| フェーズの責務分離 | 3 | 12行 |
| 進捗管理と冪等性 | 3 | 12行 |

### 2. 冗長（簡潔化可能）

| 箇所 | 問題点 |
|------|--------|
| dasel未インストール時の説明 | 毎回同じ説明を記載 |
| GitHub CLI確認コード | 同一パターンが繰り返し |
| バックログモード確認 | 同じbashコードブロックが5箇所以上 |

### 3. 削除候補

| 箇所 | 理由 |
|------|------|
| progress.md関連の後方互換性説明 | v1.6.0以前の形式、移行済み |
| 旧形式バックログ移行セクション | 十分な期間経過 |

## 改善提案

### 最優先: 参照方式のPoC確立

外部ファイル参照が正しく動作するかの検証が必須。AGENTS.md方式（`@ファイルパス`）の技術的制約を確認してから他の施策を実施する。

### 高優先度

1. **共通セクションの外部ファイル化**（削減見込み: 約250行）
   - `prompts/package/prompts/common/intro.md`: AI-DLC手法の要約
   - `prompts/package/prompts/common/rules.md`: 共通開発ルール

2. **AIレビューフローの外部化**（削減見込み: 約160行）
   - `prompts/package/guides/ai-review-flow.md`: 詳細フロー

### 中優先度

3. **設定確認コードのスクリプト化**（削減見込み: 約100行）
4. **Operations Phaseでのサイズチェック追加**

### 低優先度

5. **後方互換性コードのdeprecation準備**（削減見込み: 約50行）

## 最適化による効果見込み

| 施策 | 削減見込み |
|------|-----------|
| AI-DLC手法の要約を1箇所に集約 | 約54行 |
| 共通開発ルールの外部化 | 約200行 |
| AIレビューフローの外部化 | 約160行 |
| 設定確認コードのスクリプト化 | 約100行 |
| **合計** | **約514行（約12%削減）** |

## リスクと対策

| リスク | 対策 |
|--------|------|
| AIが参照先を読まない | PoC で事前検証 |
| 参照漏れ（記載忘れ） | grepによる必須参照チェック |
| 参照先更新忘れ | 参照先一覧（依存マップ）作成 |
| 分割による文脈断絶 | 参照時の要約を適切に記載 |
| 参照循環 | 参照関係を一方向に限定 |

## 次サイクルへの引継ぎ

1. **参照方式のPoC確立**を最優先で実施
2. PoCが成功したら、共通セクションとAIレビューフローの外部化を並行実施
3. 移行計画: v1.9.0で開始、v1.10.0で完了、v2.0.0で後方互換性削除

## 関連ドキュメント

- ドメインモデル設計: `docs/cycles/v1.8.0/design-artifacts/domain-models/015-prompt-optimization-prep_domain_model.md`
- 論理設計: `docs/cycles/v1.8.0/design-artifacts/logical-designs/015-prompt-optimization-prep_logical_design.md`
