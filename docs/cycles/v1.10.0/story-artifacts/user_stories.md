# ユーザーストーリー

## Epic 1: バグ修正

### ストーリー 1: version.txtの参照問題修正 (#126)
**優先順位**: Must-have

As a AI-DLCスターターキットの利用者
I want to バージョン情報の参照エラーが発生しない状態
So that セットアップやアップグレード時にエラーで中断しない

**受け入れ基準**:
- [ ] `prompts/version.txt` が存在しないのに参照しているスクリプト/プロンプトを特定
- [ ] 参照箇所を正しいパス（`version.txt`）に修正、または `prompts/version.txt` を作成
- [ ] 修正後、参照箇所でエラーが発生しないことを確認

**技術的考慮事項**:
- 調査対象: `prompts/` 配下のスクリプト、`prompts/package/bin/` 配下のスクリプト
- 修正対象: `prompts/package/` 配下のみ（`docs/aidlc/` は直接編集しない）
- 正しいバージョン情報の取得元を確認（`version.txt` または `docs/aidlc.toml`）

---

## Epic 2: インフラ改善

### ストーリー 2: バージョンチェック機能の統合 (#128)
**優先順位**: Should-have

As a AI-DLC利用者
I want to 環境一覧スクリプト実行時にバージョン情報も確認できる
So that 環境情報とバージョン情報を一括で把握できる

**受け入れ基準**:
- [ ] 環境一覧スクリプト（`check-env.sh` 等）にバージョンチェック機能が追加されている
- [ ] スクリプト実行時にスターターキットのバージョン情報が出力される
- [ ] #126の修正後に実装（依存関係あり）

**技術的考慮事項**:
- 対象スクリプト: `prompts/package/bin/` 配下の環境確認系スクリプト（具体的なスクリプト名はUnit定義で特定）
- バージョン情報の取得元: `version.txt`

---

### ストーリー 3: Issue用基本ラベルの移動 (#127)
**優先順位**: Should-have

As a プロジェクト管理者
I want to セットアップ時にIssue用基本ラベルが自動作成される
So that 手動でラベルを作成する手間が省ける

**受け入れ基準**:
- [ ] セットアッププロンプト（`prompts/setup-prompt.md`）にラベル作成処理が追加されている
- [ ] 作成されるラベル: `backlog`, `bug`, `enhancement`, `documentation` 等の基本ラベル
- [ ] 既存ラベルがある場合はスキップする処理が含まれている

**技術的考慮事項**:
- GitHub CLI（`gh label create`）を使用
- 冪等性を確保（既存ラベルの上書き防止）
- 必須ラベル一覧はUnit定義で特定

**依存関係**:
- Story 5（Issueテンプレート差分確認）と同一ファイル（`prompts/setup-prompt.md`）を編集。競合回避のため順次実施を推奨

---

### ストーリー 4: PRによるIssue自動Close (#114)
**優先順位**: Should-have

As a 開発者
I want to PRマージ時に対応Issueが自動でCloseされる
So that 手動でIssueを閉じる手間が省ける

**受け入れ基準**:
- [ ] Operations PhaseのPR作成時に `Closes #xx` が本文に自動記載される
- [ ] 対応Issue番号はIntent/Unit定義から取得される
- [ ] `prompts/package/prompts/operations.md` にPR作成セクションが更新されている

**技術的考慮事項**:
- GitHubの標準機能（キーワード: `Closes`, `Fixes`, `Resolves`）を活用
- PR本文のテンプレートに組み込み
- 具体的な記載位置・フォーマットはUnit定義で特定

---

### ストーリー 5: Issueテンプレート差分確認 (#113)
**優先順位**: Could-have

As a プロジェクト管理者
I want to Issueテンプレートのコピー前に差分を確認できる
So that 不要なコピーを防ぎ、変更がある場合のみ更新できる

**受け入れ基準**:
- [ ] Issueテンプレートコピー前に差分確認が実施される
- [ ] 差分がない場合はコピーがスキップされる
- [ ] 差分がある場合はユーザーに確認を求める

**技術的考慮事項**:
- 差分確認方法: `diff` または `git diff` コマンド（具体的な実装方法はUnit定義で特定）
- 対象: `.github/ISSUE_TEMPLATE/` 配下のファイル

**依存関係**:
- Story 3（Issue用基本ラベル移動）と同一ファイル（`prompts/setup-prompt.md`）を編集する可能性あり。競合回避のため順次実施を推奨

---

## Epic 3: プロンプト最適化

### ストーリー 6: inception.mdのサイズ最適化 (#115)
**優先順位**: Should-have

As a AI-DLC利用者
I want to プロンプトファイルのサイズが削減されている
So that AIのコンテキスト消費が減り、応答品質が向上する

**受け入れ基準**:
- [ ] `prompts/package/prompts/inception.md` が812行から730行以下に削減されている（10%以上削減）
- [ ] 外部ファイル化対象: iOSバージョン更新セクション、Dependabot PR確認・GitHub Issue確認のbashコマンド
- [ ] ヘルパースクリプト化対象: 複雑なbashコマンド（具体的な対象はUnit定義で特定）
- [ ] 機能検証: 最適化後のinception.mdを使用してサイクル開始が正常に動作すること

**技術的考慮事項**:
- v1.9.2 Unit 002で実施した手法を横展開
- 作成済みヘルパースクリプトの再利用を検討

---

## Epic 4: 品質向上ルール追加

### ストーリー 7: AIレビュー指摘先送り抑制ルール (#112)
**優先順位**: Must-have

As a 開発者
I want to AIレビュー指摘を先送りする判断が抑制される
So that 設計・成果物の品質が向上する

**受け入れ基準**:
- [ ] `prompts/package/prompts/common/review-flow.md` に「AIレビュー指摘の先送り判断基準」セクションが追加されている
- [ ] 先送りする場合は `AskUserQuestion` でユーザー承認を得るフローが記載されている
- [ ] 先送り理由を履歴に記録するフローが含まれている
- [ ] 検証: 「パッチだから」「小さい変更だから」という理由が単独では先送り承認の選択肢に含まれないこと

**技術的考慮事項**:
- AIレビュー指摘が残っている場合の承認フローを明確化
- 先送り理由の記録先: `docs/cycles/*/history/*.md`（各フェーズの履歴ファイル）
- 承認フローの具体的な選択肢・条件はUnit定義で特定

---

### ストーリー 8: 設計・実装整合性チェック (#106)
**優先順位**: Should-have

As a 開発者
I want to Unit完了時に設計と実装の整合性がチェックされる
So that 設計ドキュメントと実装の乖離を防げる

**受け入れ基準**:
- [ ] `prompts/package/prompts/construction.md` に整合性チェックフローが追加されている
- [ ] Unit完了時のチェックリストに「設計との整合性確認」項目がある
- [ ] 乖離がある場合は警告を表示し、修正を促すフローがある

**技術的考慮事項**:
- 対象: ドメインモデル、論理設計ドキュメント
- AIレビュー時に設計ドキュメントを参照
- 具体的なチェック項目・判定基準はUnit定義で特定

---

### ストーリー 9: バックログ登録時の不明点確認フロー (#101)
**優先順位**: Could-have

As a 開発者
I want to バックログ登録時に不明点が確認される
So that 後から見ても意味がわかるバックログになる

**受け入れ基準**:
- [ ] バックログ登録前にAIがユーザーに質問して詳細を確認するフローがある
- [ ] 必須項目（概要、背景、期待する結果）のテンプレートが用意されている
- [ ] AskUserQuestionを活用した対話的な登録フローが実装されている

**技術的考慮事項**:
- 対象: ユーザー起点の登録のみ（AI自動検出は除く）
- 対象プロンプト: `setup.md` または関連プロンプト（具体的なファイル・セクションはUnit定義で特定）
