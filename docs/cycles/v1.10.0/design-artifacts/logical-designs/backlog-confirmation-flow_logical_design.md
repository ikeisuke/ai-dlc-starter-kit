# 論理設計: バックログ登録時の不明点確認フロー

## 概要

バックログ登録時の確認フローをガイドドキュメントとして定義し、既存のバックログ管理ガイドから参照する。

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。具体的なコード（SQL、JSON、実装コード等）はImplementation Phase（コード生成ステップ）で作成します。

## アーキテクチャパターン

ドキュメント参照パターン - 既存ガイドから新規ガイドを参照し、関心事を分離する

## コンポーネント構成

### ファイル構成

```text
prompts/package/guides/
├── backlog-management.md     (既存 - 参照追加)
└── backlog-registration.md   (新規 - 確認フロー定義)
```

### コンポーネント詳細

#### backlog-registration.md（新規）

- **責務**: バックログ登録時の確認フロー、必須項目を定義（ツール非依存）
- **依存**: なし
- **公開インターフェース**:
  - 確認フローのトリガー条件
  - 質問テンプレート
  - 必須項目一覧
  - 出力テンプレート（バックログ記載フォーマット）

#### backlog-management.md（更新）

- **責務**: バックログ管理全般のガイド（モード、保存先、フロー）
- **依存**: backlog-registration.md への参照追加
- **公開インターフェース**: 変更なし

## インターフェース設計

### 確認フロー（一問一答形式）

#### 質問1: 概要（必須）

- **質問内容**: 「概要を教えてください（何をしたいか、1-2文で）」
- **期待する回答**: 1-2文の簡潔な説明
- **曖昧な回答時**: 「具体的には何を追加/変更/修正したいですか？」と深掘り

#### 質問2: 背景（必須）

- **質問内容**: 「背景を教えてください（なぜ必要か、発見した経緯）」
- **期待する回答**: 必要性や発見経緯の説明
- **曖昧な回答時**: 「どのような作業中に気づきましたか？」「どんな問題が起きていますか？」と深掘り

#### 質問3: 期待する結果（必須）

- **質問内容**: 「期待する結果を教えてください（完了時にどうなっていれば良いか）」
- **期待する回答**: 受け入れ基準・完了条件
- **曖昧な回答時**: 「どうなっていれば『できた』と判断できますか？」と深掘り

#### 質問4: 優先度（任意）

- **質問内容**: 「優先度を選択してください」
- **選択肢提示**（デフォルトを先頭に）:
  - Medium: 次のサイクルで対応（デフォルト）
  - High: すぐに対応が必要
  - Low: 余裕があれば対応

### 出力テンプレート（バックログ記載フォーマット）

確認フロー完了後、以下のフォーマットでバックログを登録する。
※ 発見日/発見フェーズ/発見サイクルはAIが自動補完（現在の日付/フェーズ/サイクルを使用）:

```markdown
# [概要]

- **発見日**: YYYY-MM-DD
- **発見フェーズ**: [Inception / Construction / Operations]
- **発見サイクル**: vX.X.X
- **優先度**: [High / Medium / Low]

## 背景
[背景の回答]

## 期待する結果
[期待する結果の回答]
```

**Issue登録時**: タイトルに `[Backlog] [概要]`、本文に上記フォーマットを使用

## 処理フロー概要

### バックログ登録確認フロー

**トリガー条件**:
- ユーザーが「バックログに追加して」「backlogに登録して」等の発言をした場合
- Construction Phase で作業中に発見した課題を記録する場合（ユーザー起点のみ）

**ステップ**:
1. トリガー検出 - ユーザーからのバックログ登録要求を検出
2. 確認フロー開始 - 一問一答形式で質問を提示
3. 必須項目の収集 - 概要、背景、期待する結果を収集
4. 任意項目の収集 - 優先度を確認（スキップ可能）
5. 内容確認 - 収集した情報を整理してユーザーに確認
6. バックログ登録 - 確認後、設定されたモード（Issue/Git）で登録

**関与するコンポーネント**: AIアシスタント

**深掘り・キャンセル**:
- 曖昧な回答（「わからない」「特にない」等）の場合、具体化を促す
- ユーザーが「やめる」「キャンセル」等の発言をした場合、登録を中止

### 適用範囲の判定

**対象**:
- ユーザーが明示的にバックログ登録を要求した場合

**対象外（既存フローを使用）**:
- AI自動検出による気づき記録（Construction Phase の気づき記録フロー）
- workaround 実施時の自動記録

## 非機能要件（NFR）への対応

### パフォーマンス
- **要件**: 該当なし
- **対応策**: なし

### セキュリティ
- **要件**: 該当なし
- **対応策**: なし

### スケーラビリティ
- **要件**: 該当なし
- **対応策**: なし

### 可用性
- **要件**: 該当なし
- **対応策**: なし

## 技術選定

- **形式**: Markdownドキュメント

## 実装上の注意事項

- メタ開発のため `prompts/package/` を編集（`docs/aidlc/` は直接編集禁止）
- 一問一答形式を遵守（複数質問を一度に提示しない）
- Claude Code では AskUserQuestion 機能を活用可能（CLAUDE.md に前提として記載）

## 不明点と質問（設計中に記録）

なし
