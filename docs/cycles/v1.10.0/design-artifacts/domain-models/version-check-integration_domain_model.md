# ドメインモデル: バージョンチェック機能統合

## 概要

環境情報スクリプト `env-info.sh` にスターターキットのバージョン情報出力機能を追加する。バージョン情報はプロジェクトルートの `version.txt` から取得する。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。

## 値オブジェクト（Value Object）

### StarterKitVersion

- **属性**: version: String - セマンティックバージョン形式（例: "1.9.2"）
- **不変性**: バージョン文字列は読み取り専用、一度取得したら変更しない
- **等価性**: バージョン文字列の完全一致で等価性を判定

### VersionSource

- **属性**: path: String - バージョンファイルのパス（`version.txt`）
- **不変性**: ソースパスは固定
- **等価性**: パス文字列の完全一致

## ドメインサービス

### VersionInfoProvider

- **責務**: `version.txt` からスターターキットのバージョン情報を取得する
- **操作**:
  - `get_starter_kit_version()` - version.txt からバージョンを読み取り、正規化して返す
- **正規化の定義**: 末尾の改行（LF）およびCR（キャリッジリターン）のみを除去。内部の空白や文字は変更しない
- **エラーケース**:
  - ファイルが存在しない → 空値を返す
  - ファイルが空 → 空値を返す
  - ファイル読み取りエラー → 空値を返す
- **バリデーション**: セマンティックバージョン形式の検証は行わない（そのまま出力）

### EnvInfoOutputFormatter

- **責務**: 環境情報を一貫したフォーマットで出力する
- **操作**:
  - `format_version(version)` - `starter_kit_version:{version}` 形式で出力

## ユビキタス言語

このドメインで使用する共通用語：

- **スターターキットバージョン**: AI-DLCスターターキット本体のバージョン（`version.txt` に記載）
- **プロジェクトバージョン**: プロジェクトにインストールされているバージョン（`docs/aidlc.toml` の `starter_kit_version`）
- **環境情報**: gh, dasel, jj, git などのツール状態とバージョン情報の集合

## 設計判断

### 実行前提【AIレビュー指摘対応】

- **判断**: リポジトリルートで実行する前提を維持する
- **理由**: 既存の `env-info.sh` は `docs/aidlc.toml`、`docs/cycles/` などをカレントディレクトリ基準で参照している。`version.txt` も同様にカレントディレクトリ基準（リポジトリルート）で参照することで一貫性を保つ
- **注意**: `SCRIPT_DIR` 基準でのパス解決は行わない（既存コードとの整合性のため）

### バージョン取得のタイミング

- **判断**: 通常出力時に常に `starter_kit_version` を出力する
- **理由**: バージョン情報は基本的な環境情報の一部であり、`--setup` オプションに限定する必要はない

### エラー時の振る舞い

- **判断**: ファイルが存在しない/読み取りエラー時は空値を出力（`starter_kit_version:`）
- **理由**: 既存の `dasel` 未インストール時の挙動（空値出力）と一貫性を保つ

### 出力順序

- **判断**: 既存のツール状態出力（gh, dasel, jj, git）の後、`--setup` オプション出力の前に配置
- **理由**: バージョン情報は基本情報として常に出力すべきだが、プロジェクト固有の設定情報より前が適切

## 不明点と質問（設計中に記録）

（なし - 設計方針は明確）
