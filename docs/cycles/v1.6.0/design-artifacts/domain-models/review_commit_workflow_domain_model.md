# ドメインモデル: レビュー・コミットワークフロー

## 概要

レビュー前後にGitコミットを自動的に作成するワークフローを定義し、変更履歴の追跡性を向上させる。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。

## ドメイン概念

このUnitは通常のアプリケーション開発ではなくプロンプトファイルの改善のため、DDDの伝統的なパターン（エンティティ、値オブジェクト、集約等）ではなく、**ワークフロー概念モデル**として定義します。

### レビューワークフロー（Review Workflow）

レビュープロセスにおけるコミットタイミングを管理する概念。

**状態遷移**:
```
[作業中] → [レビュー前コミット] → [レビュー実行] → [レビュー後コミット（修正あり）] → [承認待ち]
                                               ↓
                                   [修正なし] → [承認待ち]
```

**コミットタイミング**:
1. **レビュー前コミット**: レビュー依頼直前に現在の作業状態を保存
2. **レビュー後コミット**: レビュー指摘への修正反映後に状態を保存（修正がある場合のみ）

### レビュー種別（Review Type）

- **AIレビュー（MCP）**: Codex MCP等を使用した自動レビュー
- **人間レビュー**: ユーザーによる手動レビュー

### レビューモード（Review Mode）

設定ファイル（`docs/aidlc.toml`）で定義されるモード：

- **required**: AIレビュー必須
- **recommend**: AIレビュー推奨
- **disabled**: AIレビュー無効（人間レビューのみ）

### MCP利用可否（MCP Availability）

- **利用可能**: Codex MCPツールが存在する
- **利用不可**: Codex MCPツールが存在しない

## ワークフロー分岐

### 分岐条件と対応フロー

| レビューモード | MCP利用可否 | フロー |
|--------------|-------------|--------|
| disabled | - | 人間レビューフロー |
| required | 利用可 | AIレビューフロー |
| required | 利用不可 | 警告 → ユーザー選択 → 人間レビューフロー（スキップ時は履歴に記録） |
| recommend | 利用可 | AIレビュー推奨メッセージ表示 → ユーザー選択 → AIレビューフロー or 人間レビューフロー |
| recommend | 利用不可 | 人間レビューフロー |

### スキップ履歴の記録

`mode = "required"` でMCP利用不可かつユーザーがスキップを選択した場合、以下の形式で履歴ファイルに記録:

```markdown
### AIレビュースキップ
- **理由**: MCP利用不可
- **日時**: YYYY-MM-DD HH:MM:SS
- **対象成果物**: {成果物名}
```

**記録先**: 各フェーズの履歴ファイル（`history/inception.md`, `history/construction_unit{N}.md`, `history/operations.md`）

### AIレビューフロー

1. レビュー前コミット実行
2. AIレビュー実行
3. 指摘確認
4. 修正反映（指摘がある場合）
5. レビュー後コミット実行（修正がある場合）
6. 人間に提示・承認待ち

### 人間レビューフロー

1. レビュー前コミット実行
2. 成果物を人間に提示
3. 承認待ち
4. 修正反映（修正依頼がある場合）
5. レビュー後コミット実行（修正がある場合）
6. 再度人間に提示・承認待ち

## コミットメッセージ形式

### レビュー前コミット
```
chore: [{{CYCLE}}] レビュー前 - {成果物名}
```

### レビュー後コミット
```
chore: [{{CYCLE}}] レビュー反映 - {成果物名}
```

## ユビキタス言語

- **レビュー前コミット**: レビュー依頼直前に作成するコミット。現在の作業状態を保存する目的
- **レビュー後コミット**: レビュー指摘への修正を反映した後に作成するコミット。修正がない場合は作成しない
- **成果物名**: レビュー対象の成果物を識別する名称（例: Intent、Unit 001 設計ドキュメント）
- **AIレビュー**: MCP（Model Context Protocol）を使用した自動レビュー
- **人間レビュー**: ユーザーが手動で行うレビュー

## 不明点と質問（設計中に記録）

（現時点で不明点なし）

---
作成日: 2026-01-09
