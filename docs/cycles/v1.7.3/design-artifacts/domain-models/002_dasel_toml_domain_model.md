# ドメインモデル: daselによるTOML読み込み対応

## 概要

このUnitは「プロンプトファイルの修正」であり、ビジネスドメインは存在しない。
代わりに、設定読み込みに関する概念と責務を整理する。

## 概念モデル

### 設定読み込みパターン

TOML設定ファイル（`docs/aidlc.toml`）から値を取得するパターン。

**構成要素**:

```text
┌─────────────────────────────────────────────────────────┐
│                   設定読み込みフロー                      │
├─────────────────────────────────────────────────────────┤
│  1. dasel利用可否判定                                    │
│     └─ command -v dasel                                 │
│                                                          │
│  2a. dasel利用可能時                                     │
│      └─ dasel -f docs/aidlc.toml -r toml '.key.path'   │
│                                                          │
│  2b. dasel利用不可時（フォールバック）                    │
│      └─ AIがReadツールでTOMLを読み込み、値を解析         │
│                                                          │
│  3. 値が空の場合                                         │
│      └─ デフォルト値を使用                               │
└─────────────────────────────────────────────────────────┘
```

### 設定値の種類

| 設定パス | 用途 | デフォルト値 |
|----------|------|-------------|
| `.starter_kit_version` | スターターキットバージョン | "" (VERSION_NOT_FOUND) |
| `.project.name` | プロジェクト名 | "" |
| `.paths.setup_prompt` | セットアッププロンプトパス | "prompts/setup-prompt.md" |
| `.backlog.mode` | バックログ管理モード | "git" |
| `.project.type` | プロジェクトタイプ | "general" |

### 責務の分離

| 責務 | 担当 |
|------|------|
| TOML構造解析 | dasel（優先）/ AI（フォールバック） |
| 設定ファイルの存在確認 | bashスクリプト |
| デフォルト値の適用 | bashスクリプト |
| エラーハンドリング | bashスクリプト + プロンプト記述 |

## フォールバック戦略

### 優先順位

1. **dasel**: 構造化されたTOML解析、最も信頼性が高い
2. **AI読み込み**: dasel未インストール時の代替、TOMLを直接解析

### AI読み込みの特徴

- Readツールで `docs/aidlc.toml` をそのまま読み込む
- コメント行・空行はAIが解釈時に無視
- 前処理（grep等）は行わない（複数行文字列等で問題を起こすため）

## ユビキタス言語

- **dasel**: TOML/JSON/YAML等の構造化データを操作するCLIツール
- **フォールバック**: 主要な手段が利用できない場合の代替手段
- **設定パス**: TOML内の値を指定するドット区切りの表記（例: `.project.name`）

## 不明点と質問

（なし - 計画策定時に解決済み）
