# 論理設計: Operations Phase再利用性

## 概要

Operations Phaseの運用引き継ぎ情報をサイクル横断で引き継げる仕組みの具体的な構造とフローを定義する。

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。具体的なコード（SQL、JSON、実装コード等）はImplementation Phase（コード生成ステップ）で作成します。

## アーキテクチャパターン

ドキュメント駆動アーキテクチャ - AI-DLCの既存パターンに従い、Markdownファイルベースで運用引き継ぎ情報を管理する。

## コンポーネント構成

### ディレクトリ構造

```
prompts/
├── setup-prompt.md          # セットアッププロンプト（変更）
└── setup/
    ├── common.md            # 共通セットアップ（変更）
    └── operations.md        # Operations Phaseテンプレート（変更）

# セットアップ時に生成される成果物:
{{AIDLC_ROOT}}/
├── operations/
│   ├── handover.md          # 運用引き継ぎ情報テンプレート
│   └── README.md            # ディレクトリの説明
└── prompts/
    └── operations.md        # Operations Phaseプロンプト（生成）
```

### コンポーネント詳細

#### handover.md（運用引き継ぎテンプレート）
- **責務**: 運用引き継ぎ情報の構造化されたテンプレートを提供
- **依存**: なし
- **公開インターフェース**:
  - CI/CD設定方針セクション
  - 監視設定セクション
  - デプロイ手順セクション
  - 環境情報セクション
  - 既知の問題セクション

#### prompts/setup/operations.md（変更）
- **責務**: Operations Phaseプロンプトのテンプレート。既存設定・引き継ぎ情報を認識するフローを追加
- **依存**: handover.md
- **公開インターフェース**:
  - 既存設定検出フロー
  - 引き継ぎ情報参照フロー
  - 再利用/更新/新規作成の選択肢提示

#### setup-prompt.md / setup/common.md（変更）
- **責務**: セットアップ時にoperationsディレクトリを作成
- **依存**: なし
- **公開インターフェース**: ディレクトリ作成手順

## 変更対象ファイルと変更内容

### 1. 新規作成: `docs/aidlc/operations/handover.md`

運用引き継ぎ情報のテンプレートファイル。以下のセクションを含む：

- **CI/CD設定方針**: 使用ツール、パイプライン構成、ビルド・テスト・デプロイの流れ
- **監視設定**: 監視対象メトリクス、アラート閾値、通知先
- **デプロイ手順・注意事項**: 手順、ロールバック方法、注意点
- **環境情報**: 本番/ステージング等の構成、接続情報（秘密情報は除く）
- **既知の問題・注意点**: 運用で発覚した問題、ワークアラウンド

### 2. 新規作成: `docs/aidlc/operations/README.md`

ディレクトリの目的と使い方の説明。

### 3. 変更: `prompts/setup/operations.md`

**追加箇所**: 「最初に必ず実行すること」セクションに以下を追加

- ステップ追加: 「運用引き継ぎ情報の確認」
  - `{{AIDLC_ROOT}}/operations/handover.md` が存在するか確認
  - 存在する場合は読み込んで内容を確認
  - 前回サイクルの設定方針を参照できることをユーザーに通知

- ステップ追加: 「既存実設定ファイルの検出」
  - 以下のパターンで既存ファイルを検出:
    - `.github/workflows/*.yml` （GitHub Actions）
    - `Jenkinsfile`
    - `.gitlab-ci.yml`
    - `docker-compose*.yml`
    - `Dockerfile`
  - 検出結果をユーザーに提示
  - 再利用/更新/新規作成の選択肢を提示

**追加箇所**: 「完了時の必須作業」セクションに以下を追加

- ステップ追加: 「運用引き継ぎ情報の更新」
  - 今回のサイクルで決定した運用情報を `{{AIDLC_ROOT}}/operations/handover.md` に反映
  - 次回サイクルで参照できるように更新

### 4. 変更: `prompts/setup-prompt.md`

**追加箇所**: 「1. ディレクトリ構成の作成」セクションのディレクトリ構造に以下を追加

```
{{AIDLC_ROOT}}/
├── operations/              # 運用引き継ぎ情報（追加）
│   ├── handover.md
│   └── README.md
├── prompts/
...
```

### 5. 変更: `prompts/setup/common.md`

**追加箇所**: ディレクトリ作成手順に `operations/` を追加

## 処理フロー概要

### Operations Phase開始時のフロー

**ステップ**:
1. 追加ルール確認（既存）
2. 進捗管理ファイル確認（既存）
3. **【新規】運用引き継ぎ情報の確認**
   - `docs/aidlc/operations/handover.md` の存在確認
   - 存在する場合、内容を読み込んで前回の設定方針を把握
4. **【新規】既存実設定ファイルの検出**
   - CI/CD設定ファイルの検出
   - 検出結果の提示
   - 再利用/更新/新規作成の選択肢提示
5. 既存成果物の確認（既存）

### Operations Phase完了時のフロー

**ステップ**:
1. 履歴記録（既存）
2. **【新規】運用引き継ぎ情報の更新**
   - 今回決定した設定方針を `handover.md` に反映
3. Gitコミット（既存）

## 非機能要件（NFR）への対応

### スケーラビリティ
- **要件**: 将来的なOperations成果物の追加に対応できる構造
- **対応策**: `docs/aidlc/operations/` ディレクトリに新しいファイルを追加可能な設計

## 技術選定
- **形式**: Markdown
- **検出方法**: シェルコマンド（ls, find等）

## 実装上の注意事項
- 引き継ぎ情報に秘密情報（APIキー、パスワード等）を含めないこと
- 検出パターンは一般的なCI/CDツールを網羅しつつ、拡張可能な形で定義
- 既存のoperations.mdの構造を大きく変えず、最小限の追加に留める

## 不明点と質問（設計中に記録）

（ドメインモデル設計で解消済み）
