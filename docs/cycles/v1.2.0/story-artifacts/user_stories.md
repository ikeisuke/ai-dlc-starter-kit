# ユーザーストーリー

## Epic 1: 基盤整備

### ストーリー 1.1: パス参照不整合の修正
**優先順位**: Should-have
**ステータス**: ✅ 完了

As a AI-DLCを使用する開発者
I want to construction.mdのUnit定義ファイルパスが実際の構造と一致すること
So that AIがUnit定義ファイルを即座に見つけられる

**受け入れ基準**:
- [x] construction.md内のパス参照が `story-artifacts/units/` を指している
- [x] AIがUnit定義を探索なしで読み込める

**技術的考慮事項**:
- `docs/aidlc/prompts/construction.md` の修正
- `prompts/setup/construction.md` テンプレートの修正

---

## Epic 2: 設定アーキテクチャ（新規）

### ストーリー 2.1: 設定の階層構造設計
**優先順位**: Must-have

As a AI-DLCを使用する開発者
I want to プロジェクト設定とサイクル設定が明確に分離されていること
So that 設定の管理が容易になり、サイクルごとのカスタマイズが可能になる

**受け入れ基準**:
- [ ] プロジェクト設定（`docs/aidlc/config.md`）の構造が定義されている
- [ ] サイクル設定（`docs/cycles/vX/config.md`）の構造が定義されている
- [ ] 設定の継承・上書きルールが明確
- [ ] タイミング別の設定フロー（書き込み/読み込み）が定義されている

**技術的考慮事項**:
- 設定の「ハード/ソフト」分類
- 変数置換廃止の方針
- 設定ファイル形式（Markdown推奨）

---

### ストーリー 2.2: 変数置換方式の廃止
**優先順位**: Must-have

As a AI-DLCを使用する開発者
I want to フェーズプロンプトが変数置換ではなく設定ファイル参照方式を使うこと
So that AIが文脈として設定を理解し、置換ミスがなくなる

**受け入れ基準**:
- [ ] `{{VAR}}` 形式の変数がフェーズプロンプトから削除されている
- [ ] 「設定ファイルを読め」という指示に置き換わっている
- [ ] テンプレートからの変数置換処理が簡素化されている

**技術的考慮事項**:
- パス生成に必要な最小限の値のみ残すか検討
- 既存プロジェクトとの互換性

---

## Epic 3: セットアップ改善

### ストーリー 3.1: セットアップ処理の分離
**優先順位**: Must-have

As a AI-DLCを使用する開発者
I want to 初回セットアップとサイクルセットアップが分離されていること
So that サイクル開始時の作業が軽減される

**受け入れ基準**:
- [ ] 初回セットアップ: プロジェクト設定・共通プロンプト生成
- [ ] サイクルセットアップ: サイクル設定・ディレクトリ作成のみ
- [ ] 既存プロジェクトでは初回セットアップをスキップ可能

**技術的考慮事項**:
- `prompts/setup-prompt.md` の分割
- 初回/継続の判定ロジック

---

## Epic 4: プロンプト最適化

### ストーリー 4.1: プロンプトの分割・短縮化
**優先順位**: Must-have

As a AI-DLCを使用する開発者
I want to フェーズプロンプトが小さいファイルに分割されていること
So that AIが確実にプロンプト内容を読むようになる

**受け入れ基準**:
- [ ] 各フェーズプロンプトが init / flow / complete 等に分割
- [ ] ステップごとに必要最小限の情報のみ渡される
- [ ] 読み込み確認機構がある（オプション）

**技術的考慮事項**:
- 現在の大きなプロンプトを複数ファイルに分割
- 分割粒度: 初期化 / フロー / 完了処理
- Claude Code以外のAIツールでも安定動作

---

## Epic 5: バージョン管理・CI/CD

### ストーリー 5.1: プロンプト/テンプレートのバージョン埋め込み
**優先順位**: Should-have

As a AI-DLCを使用する開発者
I want to プロンプトとテンプレートにバージョン情報が埋め込まれていること
So that 更新の要否を判断できる

**受け入れ基準**:
- [ ] プロンプト/テンプレートの1行目にバージョンコメントがある
- [ ] 形式: `<!-- AI-DLC Toolkit vX.Y.Z -->`
- [ ] セットアップ時にバージョン比較が可能

**技術的考慮事項**:
- `prompts/setup/*.md` テンプレート側の修正
- 生成される `docs/aidlc/**/*.md` への反映
- バージョンがない場合は v1.2.0 以前と判断可能

---

### ストーリー 5.2: マージ後のタグ付け自動化
**優先順位**: Could-have

As a AI-DLCを使用する開発者
I want to mainブランチへのマージ時に自動でGitタグが作成されること
So that タグ付け忘れを防止しリリース作業を自動化できる

**受け入れ基準**:
- [ ] GitHub Actionsワークフローが作成されている
- [ ] mainマージ時に `docs/aidlc/version.txt` を読んでタグを作成
- [ ] 既存タグがある場合はスキップ

**技術的考慮事項**:
- `.github/workflows/auto-tag.yml` を新規作成
- version.txt のフォーマット: `X.Y.Z`
- タグ形式: `vX.Y.Z`

---

## ストーリー優先順位まとめ

| 優先順位 | ストーリー |
|---------|-----------|
| Must-have | 2.1（設定階層）, 2.2（変数廃止）, 3.1（セットアップ分離）, 4.1（プロンプト分割） |
| Should-have | 1.1（パス修正）✅, 5.1（バージョン埋め込み） |
| Could-have | 5.2（タグ自動化） |

---

## Unit との対応

| Unit | ストーリー |
|------|-----------|
| Unit 1 | 1.1（パス修正）✅ |
| Unit 2 | 2.1（設定階層）, 2.2（変数廃止）の設計部分 |
| Unit 3 | 3.1（セットアップ分離） |
| Unit 4 | 2.2（変数廃止）の実装部分 |
| Unit 5 | 4.1（プロンプト分割） |
| Unit 6 | 5.1（バージョン埋め込み） |
| Unit 7 | 5.2（タグ自動化） |

---

## 再構成履歴
- 2025-12-04: Unit構成の再編成に伴い、ストーリーを再整理
  - 旧ストーリー 1.2（変数削除）→ 新ストーリー 2.1, 2.2 に発展
  - Epic構成を変更
