# Unit 構成再編成計画

## 背景

Unit 2（変数具体例削除）の設計議論を通じて、以下が明らかになった：

1. 変数管理の本質は「具体例を消す」ではなく「設定の流れを設計する」こと
2. プロジェクト設定 / サイクル設定 の2層構造が必要
3. フェーズは設定の「消費者」（読むだけ）
4. 変数置換 → AIが設定ファイルを読む形式へ移行すべき

## 現状の Unit 構成

| Unit | 名称 | 依存 | ステータス |
|------|------|------|------------|
| 1 | パス参照不整合修正 | - | ✅ 完了 |
| 2 | 変数具体例削除 | - | 未着手 |
| 3 | タグ付け自動化 | - | 未着手 |
| 4 | バージョン管理 | - | 未着手 |
| 5 | セットアップ分離 | Unit 4 | 未着手 |
| 6 | プロンプト生成方式改善 | Unit 5 | 未着手 |
| 7 | プロンプト分割・短縮化 | Unit 4,5,6 | 未着手 |

## 新しい Unit 構成

| Unit | 名称 | 内容 | 依存 | 優先度 | 見積もり |
|------|------|------|------|--------|----------|
| 1 | パス参照不整合修正 | （完了済み） | - | - | - |
| 2 | 設定アーキテクチャ設計 | 設定の階層構造、ファイル形式、流れを定義 | - | High | 1h |
| 3 | セットアップ分離 | 初回/サイクル開始を分離、設定ファイル生成 | Unit 2 | High | 2h |
| 4 | フェーズプロンプト改修 | 変数置換廃止、設定参照方式へ | Unit 2, 3 | High | 2h |
| 5 | プロンプト分割・短縮化 | 大きなプロンプトを分割 | Unit 4 | High | 3h |
| 6 | バージョン管理 | ツールキットバージョン埋め込み | - | Medium | 1h |
| 7 | タグ付け自動化 | CI/CD でマージ時にタグ作成 | - | Low | 0.5h |

## 変更の詳細

### 削除される Unit
- 旧 Unit 2（変数具体例削除）→ Unit 2, 3, 4 に吸収
- 旧 Unit 6（プロンプト生成方式改善）→ Unit 3, 4 に吸収

### 再編成される Unit
- 旧 Unit 4（バージョン管理）→ 新 Unit 6（独立したまま）
- 旧 Unit 5（セットアップ分離）→ 新 Unit 3（スコープ拡大）
- 旧 Unit 3（タグ付け自動化）→ 新 Unit 7（優先度下げ）
- 旧 Unit 7（プロンプト分割）→ 新 Unit 5（依存関係整理）

### 新規追加 Unit
- 新 Unit 2（設定アーキテクチャ設計）：今回の議論の成果を設計ドキュメント化

## 依存関係図

```
Unit 2: 設定アーキテクチャ設計
    │
    ├──▶ Unit 3: セットアップ分離
    │        │
    │        └──▶ Unit 4: フェーズプロンプト改修
    │                  │
    │                  └──▶ Unit 5: プロンプト分割・短縮化
    │
Unit 6: バージョン管理（独立）
    │
Unit 7: タグ付け自動化（独立）
```

## 推奨実装順序

1. Unit 2: 設定アーキテクチャ設計（基盤、他のすべての前提）
2. Unit 3: セットアップ分離（設定ファイル生成の実装）
3. Unit 4: フェーズプロンプト改修（新しい設定方式の適用）
4. Unit 5: プロンプト分割・短縮化（最終的な最適化）
5. Unit 6: バージョン管理（独立して実行可能）
6. Unit 7: タグ付け自動化（独立して実行可能）

## 合計見積もり

9.5時間（旧: 11.5時間）

## 作業内容

1. 旧 Unit 定義ファイルをアーカイブ（`units/archived/` に移動）
2. 新 Unit 定義ファイルを作成
3. progress.md を更新
4. user_stories.md を必要に応じて更新
5. 履歴記録
6. コミット

## 作成日
2024-12-04
