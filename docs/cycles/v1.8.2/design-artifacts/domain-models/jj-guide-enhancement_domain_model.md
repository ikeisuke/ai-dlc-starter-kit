# ドメインモデル: jjサポート強化

## 概要

jj-support.md に「よくあるミスと対処法」セクションを追加し、ユーザーが遭遇しやすい問題と解決策を文書化する。

## 用語定義

jj-support.mdでは以下の用語を使用する（既存ガイドに合わせて統一）：

| 用語 | 説明 | jj内部での呼称 |
|------|------|---------------|
| リビジョン | 特定の状態を指すポインタ | change |
| コミット | 確定した変更の単位 | commit |
| bookmark | 名前付きポインタ（Gitのブランチに相当） | bookmark |

## ドメインエンティティ

### 1. TroubleshootingSection（トラブルシューティングセクション）

トラブルシューティングケースの集合を管理するエンティティ。

| 属性 | 説明 |
|------|------|
| title | セクションタイトル（「よくあるミスと対処法」） |
| cases | TroubleshootingCaseのリスト |
| relatedSections | 参照する既存セクション |

**制約**:
- ケースは発生頻度・重要度順に並べる
- 各ケースは既存セクションと重複しない

### 2. TroubleshootingCase（トラブルシューティングケース）

ユーザーが遭遇する問題とその解決策を表現するエンティティ。

| 属性 | 説明 |
|------|------|
| title | 問題の簡潔なタイトル |
| symptom | 症状（どのような状態か） |
| cause | 原因（なぜ発生するか） |
| solution | 解決策（具体的なコマンドや手順） |
| prevention | 予防策（再発防止の方法） |
| relatedCommands | 関連するjjコマンド |
| relatedSection | 参照する既存セクション（あれば） |

**制約**:
- solutionは具体的なコマンド例を含む
- preventionは既存チェックリストへの参照を含む

### 3. Command（コマンド）

トラブルシューティングで使用するjjコマンドを表現する値オブジェクト。

| 属性 | 説明 |
|------|------|
| name | コマンド名（例: `jj split`） |
| description | コマンドの簡易説明 |

### 4. ExistingSection（既存セクション）

jj-support.md内の既存セクションへの参照を表現する値オブジェクト。

| 属性 | 説明 |
|------|------|
| name | セクション名（例: 「作業開始時チェックリスト」） |
| anchor | ドキュメント内アンカー（例: `#作業開始時チェックリスト`） |

### 5. エンティティ間の関係

```
TroubleshootingSection 1 ─── * TroubleshootingCase
                                    │
                                    ├── relatedCommands: Command[] (0..*)
                                    └── relatedSection: ExistingSection? (0..1)
```

**制約**:
- relatedCommandsは0個以上（空でも可）
- relatedSectionは任意（参照先がない場合はnull）

## 対象ケース一覧

### ケース1: `jj new` 忘れ

- **症状**: 前のリビジョンに変更が混ざる、意図しない変更が含まれる
- **原因**: 作業前に `jj new` を実行せず、既存のリビジョンに変更を追加してしまった
- **解決策**: `jj split` で変更を対話的に分離し、新しいリビジョンに移動
- **予防策**: 作業開始時チェックリストの活用
- **関連コマンド**: `jj split`, `jj new`
- **関連セクション**: 作業開始時チェックリスト

### ケース2: bookmarkが進まない

- **症状**: pushしてもリモートに反映されない、PRのdiffが空になる
- **原因**: `jj bookmark set` を実行していない
- **解決策**: 正しいリビジョンを指定して `jj bookmark set` を実行
- **予防策**: 作業終了時チェックリストの活用
- **関連コマンド**: `jj bookmark set`, `jj git push`
- **関連セクション**: ⚠️ 重要: bookmarkは自動で進まない

### ケース3: 不要なbookmarkの削除

- **症状**: 古いbookmarkが残っている、一覧が煩雑になる
- **原因**: 作業完了後にbookmarkを削除していない
- **解決策**: `jj bookmark delete <name>` でローカル削除、`jj git push --deleted` で削除をリモートに反映
- **予防策**: サイクル完了時にbookmarkの整理を行う
- **関連コマンド**: `jj bookmark delete`, `jj git push --deleted`
- **関連セクション**: なし（新規追加）

### ケース4: 作業開始前の未コミット変更

- **症状**: 意図しない変更が新しい作業に混入する
- **原因**: 前の作業を完了せずに新しい作業を開始
- **解決策**: `jj describe` で現在の変更にメッセージを付け、`jj new` で新しいリビジョンを作成
- **予防策**: 作業開始時に `jj status` で状態を確認
- **関連コマンド**: `jj status`, `jj describe`, `jj new`
- **関連セクション**: 作業開始時チェックリスト

## 関連する既存セクション

- 「作業開始時チェックリスト」
- 「作業終了時チェックリスト」
- 「⚠️ 重要: bookmarkは自動で進まない」
- 「注意事項と制限」

これらのセクションと重複せず、相互参照する形で構成する。
