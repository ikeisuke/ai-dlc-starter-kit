# 論理設計: jjサポート強化

## 概要

jj-support.md の構成を分析し、「よくあるミスと対処法」セクションの最適な配置位置を決定する。

## 現在のドキュメント構成

```
jj-support.md
├── 概要
├── ⚠️ 重要: bookmarkは自動で進まない
├── 推奨設定
├── 前提条件
├── gitとjjの考え方の違い
├── jjの特徴と利点
├── Git/jjコマンド対照表
│   ├── 状態確認系
│   ├── ブックマーク操作系
│   ├── コミット操作系
│   └── リモート操作系
├── AI-DLCワークフローでの使用方法
│   ├── 作業開始時チェックリスト
│   ├── Setup Phase
│   ├── Inception Phase
│   ├── Construction Phase
│   ├── Operations Phase
│   └── 作業終了時チェックリスト
├── 注意事項と制限
└── 参考リンク
```

## 配置位置の決定

### 新セクション「よくあるミスと対処法」の配置

**配置候補の比較**:

| 配置場所 | メリット | デメリット |
|---------|---------|-----------|
| A: コマンド対照表の直後 | 検索性が高い、コマンド参照と近い | ワークフローとの距離が遠い |
| B: 「重要」セクションの直後 | 最も発見しやすい位置 | 基本情報を読む前に問題解決を見せる |
| C: ワークフローの後、注意事項の前 | 論理的な流れ | 発見性がやや低い |

**採用**: 候補C（ワークフローの後、注意事項の前）

**理由**:
- ワークフローを実践した後に発生する問題をカバーする自然な流れ
- 注意事項（予防的情報）の前にトラブルシューティング（事後対応）を配置
- 既存の「bookmarkは自動で進まない」セクションは重要な警告として冒頭に残す
- 目次に「よくあるミスと対処法」を追加することで発見性を補完

**発見性向上の補完策**:
- 「注意事項と制限」セクションから新セクションへの相互参照を追加
- 目次でセクション名を明確に表示

### コマンド対照表の補完

**追加するコマンド**:

| 用途 | Git コマンド | jj コマンド | 備考 |
|------|-------------|------------|------|
| 変更を分離 | `git add -p` + `git commit` | `jj split` | 対話的に分離（トラブルシューティングで使用） |
| ファイル復元 | `git restore <file>` | `jj restore <file>` | ワーキングコピーから復元 |
| リモートbookmark削除 | `git push origin --delete <name>` | `jj bookmark delete <name>` + `jj git push --deleted` | 2ステップで実行 |

**注**: `jj squash`（親リビジョンへの変更統合）は既存の対照表に含まれていないが、`jj new` 忘れのトラブルシューティングでは `jj split` を使用する方が適切なため、対照表への追加は見送る。

**コマンド仕様の根拠**:
- `jj bookmark delete`: ローカルbookmarkを削除し、次回pushで削除をリモートに伝播（`jj help bookmark delete` で確認）
- `jj git push --deleted`: 削除されたbookmarkをリモートにプッシュ（`jj git push --help` で確認）

**配置場所**: 既存のコマンド対照表の「コミット操作系」に追加（新カテゴリは作成しない）

**理由**: 既存の4カテゴリ（状態確認系、ブックマーク操作系、コミット操作系、リモート操作系）の構成を維持し、各コマンドを適切なカテゴリに追加する

## セクション構成

### 新規セクション: よくあるミスと対処法

```markdown
## よくあるミスと対処法

このセクションでは、AI-DLCでjjを使用する際によく遭遇する問題と解決策を説明します。

### `jj new` を忘れて作業を始めた
[症状・解決策・予防策]

### bookmarkが進まない・リモートに反映されない
[症状・解決策・予防策]
※ 冒頭の警告セクションへの相互参照を含む

### 不要なbookmarkの削除
[手順（ローカル・リモート）]

### 作業開始前に未コミットの変更がある
[症状・解決策・予防策]
```

## 既存セクションとの関係

| 新規コンテンツ | 関連する既存セクション | 関係性 |
|---------------|---------------------|--------|
| `jj new` 忘れ | 作業開始時チェックリスト | 予防策として参照 |
| bookmark進まない | ⚠️ bookmarkは自動で進まない | 詳細な対処法として補完 |
| 不要bookmark削除 | コマンド対照表 | コマンド追加で補完 |
| 未コミット変更 | 作業開始時チェックリスト | 予防策として参照 |

## 変更の影響範囲

- **変更対象**: `prompts/package/guides/jj-support.md`
- **影響なし**: 他のプロンプトファイル、テンプレート

## 技術的考慮事項

- jjバージョン差異への配慮（0.22前後でbookmark/branch）
- 実際のエラーメッセージやコマンド出力を含めて検索性を向上
- 既存の「注意事項と制限」セクションとの重複を避ける
