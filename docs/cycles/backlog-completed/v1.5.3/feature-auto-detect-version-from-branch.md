# ブランチ名からサイクルバージョンを自動推測

- **発見日**: 2025-12-27
- **発見フェーズ**: Setup
- **発見サイクル**: v1.5.3
- **優先度**: 中

## 概要

現在のブランチ名から次のサイクルバージョンを推測し、ユーザーに提案する機能を追加する。

## 詳細

現在の setup.md では、サイクルバージョンを決定する際に既存サイクルの最新バージョンから次バージョンを提案している。

しかし、ユーザーが事前にブランチを作成している場合（例: `cycle/v1.5.3`）、ブランチ名からバージョンを推測できる。この場合、わざわざユーザーに選択させる必要はなく、推測したバージョンを使うべき。

**現在のフロー**:
1. 既存サイクルから最新バージョンを検出
2. 次バージョンを提案（v1.5.3, v1.6.0, v2.0.0, その他）
3. ユーザーが選択

**改善後のフロー**:
1. 現在のブランチ名をチェック
2. ブランチ名が `cycle/vX.Y.Z` の形式の場合、そのバージョンを使用（確認を求める）
3. ブランチ名から推測できない場合、既存の提案フローを実行

## 対応案

### setup.md の「2. サイクルバージョンの決定」セクションを修正

#### 2.1 ブランチ名からバージョン推測（新規追加）

```bash
CURRENT_BRANCH=$(git branch --show-current)
if [[ $CURRENT_BRANCH =~ ^cycle/v([0-9]+\.[0-9]+\.[0-9]+)$ ]]; then
  SUGGESTED_VERSION="v${BASH_REMATCH[1]}"
  echo "BRANCH_VERSION_DETECTED: ${SUGGESTED_VERSION}"
else
  echo "BRANCH_VERSION_NOT_DETECTED"
fi
```

**判定**:
- **BRANCH_VERSION_DETECTED**: 検出されたバージョンを提案
  ```
  現在のブランチ名から v{X}.{Y}.{Z} を検出しました。
  このバージョンをサイクルバージョンとして使用しますか？
  1. はい、v{X}.{Y}.{Z} を使用する [推奨]
  2. いいえ、別のバージョンを選択する
  ```
  - **1 を選択**: 検出されたバージョンを使用（重複チェックへ）
  - **2 を選択**: 既存の提案フローへ進む
- **BRANCH_VERSION_NOT_DETECTED**: 既存サイクルの検出へ進む

#### 2.2 既存サイクルの検出（既存セクションを2.1から2.2に変更）

（現在の「2.1 既存サイクルの検出」と同じ内容）

### 実装の注意点

- ブランチ名のバージョンが既存サイクルと重複する場合は、エラーを表示して再選択を促す
- ブランチ名の形式が厳密に `cycle/vX.Y.Z` でない場合（例: `cycle/v1.5.3-beta`, `feature/v1.5.3`）は推測しない
