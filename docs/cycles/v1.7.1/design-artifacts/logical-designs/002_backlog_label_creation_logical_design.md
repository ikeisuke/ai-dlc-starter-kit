# 論理設計: backlogラベル自動作成

## 概要

Issue駆動バックログモード使用時のGitHubラベル自動作成機能の論理設計。setup.mdとinception.mdに追加するシェルスクリプトセクションを定義する。

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。具体的なコード（SQL、JSON、実装コード等）はImplementation Phase（コード生成ステップ）で作成します。

## アーキテクチャパターン

プロンプト駆動型シェルスクリプト - AI-DLCの既存パターンに従い、Markdownプロンプト内にシェルスクリプトを埋め込む形式

## コンポーネント構成

### プロンプトファイル構成

```text
prompts/package/prompts/
├── setup.md      ← ステップ0.8「ラベル確認・作成」を追加
└── inception.md  ← サイクルラベル作成セクションを追加
```

### コンポーネント詳細

#### setup.md への追加セクション

- **位置**: ステップ0.7「バックログモード確認」の後（ステップ0.8として追加）
- **責務**: 基本ラベル11種類の存在確認と自動作成
- **前提条件**:
  - BACKLOG_MODE = "issue"
  - GitHub CLIが利用可能かつ認証済み

#### inception.md への追加セクション

- **位置**: 「4. Unit定義」の後、「5. 完了時の作業」の前
- **責務**: サイクルラベルの存在確認と自動作成
- **前提条件**:
  - BACKLOG_MODE = "issue"
  - GitHub CLIが利用可能かつ認証済み

## インターフェース設計

### コマンド

#### ラベル存在確認

- **コマンド**: `gh label list --search "{label_name}" --json name --jq '.[] | select(.name=="{label_name}")'`
- **パラメータ**: label_name - 確認対象のラベル名
- **戻り値**: 存在する場合はラベル名、存在しない場合は空
- **注意**: `--search` は部分一致なので `--jq` で完全一致フィルタを追加

#### ラベル作成

- **コマンド**: `gh label create "{label_name}" --description "{description}" --color "{color}"`
- **パラメータ**:
  - label_name - ラベル名
  - description - 説明文
  - color - 6桁Hexカラーコード（#なし）
- **戻り値**: 成功時はメッセージ、失敗時はエラー
- **副作用**: GitHubリポジトリにラベルを作成

## 処理フロー概要

### setup.md: 基本ラベル作成フロー

**前提チェック**:
1. BACKLOG_MODE変数が "issue" であることを確認
2. GitHub CLI認証状態を確認（ステップ0.7で実施済み）

**ステップ**:
1. ユーザーにラベル作成の確認を求める
2. 各ラベルについて存在確認
3. 存在しないラベルを作成
4. 作成結果をサマリ表示

**関与するコンポーネント**: gh CLI

### inception.md: サイクルラベル作成フロー

**前提チェック**:
1. BACKLOG_MODE変数が "issue" であることを確認
2. GitHub CLI認証状態を確認

**ステップ**:
1. サイクルラベル `cycle:{{CYCLE}}` の存在確認
2. 存在しない場合に作成
3. Unit定義の「関連Issue」セクションからIssue番号を抽出
4. 各Issueにサイクルラベルを付与

**関与するコンポーネント**: gh CLI

## 非機能要件（NFR）への対応

### パフォーマンス

- **要件**: N/A
- **対応策**: なし（ラベル作成は初回のみ、即座に完了）

### セキュリティ

- **要件**: N/A
- **対応策**: GitHub CLI認証に依存

### スケーラビリティ

- **要件**: N/A
- **対応策**: なし

### 可用性

- **要件**: N/A
- **対応策**: GitHub API障害時はスキップ可能

## 技術選定

- **言語**: Bash（プロンプト内シェルスクリプト）
- **フレームワーク**: なし
- **ライブラリ**: なし
- **依存ツール**: GitHub CLI (gh)

## 実装上の注意事項

- ラベル作成確認はユーザーに承認を求める（デフォルトは作成）
- ラベル作成に失敗しても処理を継続（警告表示のみ）
- 既存ラベルとの名前衝突時はスキップ
- `--search` は部分一致なので `--jq` で完全一致フィルタが必要

## 不明点と質問

なし
