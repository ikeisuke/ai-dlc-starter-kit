# Unit 002: コード記述制限ルール追加 - 論理設計

## 変更対象ファイル

### 1. prompts/package/prompts/inception.md

**変更**: なし（既存の「フェーズの責務【重要】」セクションで十分）

**既存内容（151-163行目）**:
```markdown
### フェーズの責務【重要】

**このフェーズで行うこと**:
- 要件の明確化（Intent作成）
- ユーザーストーリー作成
- Unit定義

**このフェーズで行わないこと（禁止）**:
- 実装コードを書く
- テストコードを書く
- 設計ドキュメントの詳細化（Construction Phaseで実施）

**承認なしにConstruction Phaseに進んではいけない**
```

---

### 2. prompts/package/prompts/construction.md

**変更**: 「### フェーズの責務【重要】」セクションを追加

**追記位置**: 「### フェーズの責務分離」セクション（既存）の直前

**追加内容**:
```markdown
### フェーズの責務【重要】

**Phase 1（設計フェーズ）で行うこと**:
- ドメインモデル設計
- 論理設計
- 設計レビュー

**Phase 1で許可されるコード記述（例外）**:
- 設計判断のための探索的データ分析（EDA）
- ライブラリの動作確認
- 既存APIの調査
- ※ これらは設計ドキュメントに反映するための調査であり、成果物としてのコードではない

**Phase 1で行わないこと（禁止）**:
- 成果物としての実装コードを書く
- テストコードを書く
- 設計承認前に成果物としてのコードファイルを作成・編集する

**Phase 2（実装フェーズ）で行うこと**:
- 設計に基づくコード生成
- テストコード作成
- 統合とレビュー

**設計レビューで承認を得るまで、Phase 2に進んではいけない**
```

---

### 3. prompts/package/prompts/operations.md

**変更**: 「### フェーズの責務【重要】」セクションを追加

**追記位置**: 「### フェーズの責務分離」セクション（既存）の直前

**追加内容**:
```markdown
### フェーズの責務【重要】

**このフェーズで行うこと**:
- デプロイ計画・実行
- 監視・ロギング設定
- 運用ドキュメント作成
- CI/CD設定（.github/workflows/*.yml等）
- インフラ設定（IaC）

**このフェーズで許可されるコード記述**:
- CI/CD設定ファイル
- デプロイスクリプト
- 監視・アラート設定
- インフラ定義ファイル

**このフェーズで行わないこと（禁止）**:
- アプリケーションロジックの変更
- 新機能の実装
- テストコードの追加（バグ修正時を除く）

**緊急バグ修正が必要な場合**:
1. ユーザーに理由を説明し承認を得る
2. 最小限の修正のみ実施
3. 修正後、Construction Phaseへのバックトラックを提案
```

---

## 実装手順

1. construction.md の「### フェーズの責務分離」セクションを検索
2. その直前に「### フェーズの責務【重要】」セクションを挿入
3. operations.md の「### フェーズの責務分離」セクションを検索
4. その直前に「### フェーズの責務【重要】」セクションを挿入

## 整合性確認

- 3つのプロンプトすべてに「フェーズの責務【重要】」セクションが存在する状態になる
- 各フェーズで許可/禁止される内容が明確になる
- 既存の「フェーズの責務分離」セクションとの重複はない（責務分離は他フェーズへの参照、責務【重要】は当該フェーズの詳細ルール）
