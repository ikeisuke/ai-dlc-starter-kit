# 論理設計: 予想禁止・一問一答質問ルール追加

## 概要

ドメインモデルで定義した「予想禁止・ハイブリッド方式一問一答質問ルール」を各プロンプトファイルに追加するための具体的な配置と文言を定義する。

**重要**: この論理設計では**コードは書かず**、配置箇所とルール文言の定義のみを行います。

## ルール文言の統一フォーマット

### 共通ルール文言（全プロンプト共通）

```markdown
- **予想禁止・一問一答質問ルール【重要】**: 不明点や判断に迷う点がある場合、予想や仮定で進めてはいけない。必ずユーザーに質問する。

  **質問フロー（ハイブリッド方式）**:
  1. まず質問の数と概要を提示する
     ```
     質問が{N}点あります：
     1. {質問1の概要}
     2. {質問2の概要}
     ...

     まず1点目から確認させてください。
     ```
  2. 1問ずつ詳細を質問し、回答を待つ
  3. 回答を得てから次の質問に進む
  4. 回答に基づく追加質問が発生した場合は「追加で確認させてください」と明示して質問する

  **質問すべき場面**:
  - 要件が曖昧な場合
  - 複数の解釈が可能な場合
  - 技術的な選択肢がある場合
  - 前提条件が不明確な場合
```

## 配置設計

### 1. メインプロンプト（prompts/package/prompts/）

#### inception.md
- **配置箇所**: `### 開発ルール` セクション内
- **挿入位置**: 既存ルールの後に追加（「質問と回答の記録【重要】」の前または後）
- **行番号目安**: 44行目付近の開発ルールセクション

#### construction.md
- **配置箇所**: `### 開発ルール` セクション内
- **挿入位置**: 既存の「質問と回答の記録【重要】」を**置き換え**または**統合**
- **行番号目安**: 44行目付近の開発ルールセクション
- **注意**: 既存の「一問一答形式」ルールとの重複を避ける

#### operations.md
- **配置箇所**: `### 開発ルール` セクション内
- **挿入位置**: 既存ルールの後に追加
- **行番号目安**: 46行目付近の開発ルールセクション

### 2. Lite版プロンプト（prompts/package/prompts/lite/）

Lite版はメイン版の簡略版のため、同様の構造で配置する。

#### lite/inception.md, lite/construction.md, lite/operations.md
- **配置箇所**: 各ファイルの開発ルールセクション（または同等のセクション）
- **文言**: 共通ルール文言と同一

### 3. セットアッププロンプト（prompts/）

#### setup-prompt.md
- **配置箇所**: ファイル冒頭に新規セクション追加、または「## 1. 実行環境の確認」の前
- **挿入内容**: 簡略版のルール（セットアップ時は質問が少ないため）

#### setup-init.md
- **配置箇所**: `### 5.2 推測結果の確認` および `### 5.3 推測できなかった項目の入力` セクション周辺
- **挿入内容**: 推測内容確認時の質問ルール

#### setup-cycle.md
- **配置箇所**: `### 2.2 バージョン提案` および `### 3.2 ブランチ作成の提案` セクション周辺
- **挿入内容**: バージョン・ブランチ提案時の質問ルール

## 既存ルールとの統合

### construction.md の既存ルール

現在の記載:
```markdown
- **質問と回答の記録【重要】**: 独自の判断をせず、不明点はドキュメントに `[Question]` タグで記録し `[Answer]` タグを配置、ユーザーに回答を求める。**一問一答形式で対話する**：1つの質問をして回答を待ち、回答を得てから次の質問をする。**複数の質問をまとめて提示してはいけない**
```

**統合方針**:
- 「複数の質問をまとめて提示してはいけない」を削除（ハイブリッド方式では質問リスト提示を許容）
- `[Question]`/`[Answer]` タグによるドキュメント記録は維持
- 新ルールと統合して1つのルールにまとめる

### 統合後の文言（construction.md用）

```markdown
- **質問と回答の記録【重要】**: 独自の判断をせず、不明点はドキュメントに `[Question]` タグで記録し `[Answer]` タグを配置、ユーザーに回答を求める。

- **予想禁止・一問一答質問ルール【重要】**: 不明点や判断に迷う点がある場合、予想や仮定で進めてはいけない。必ずユーザーに質問する。

  **質問フロー（ハイブリッド方式）**:
  1. まず質問の数と概要を提示する
  2. 1問ずつ詳細を質問し、回答を待つ
  3. 回答を得てから次の質問に進む
  4. 回答に基づく追加質問が発生した場合は「追加で確認させてください」と明示して質問する

  **質問すべき場面**:
  - 要件が曖昧な場合
  - 複数の解釈が可能な場合
  - 技術的な選択肢がある場合
  - 前提条件が不明確な場合
```

## 処理フロー

### ルール適用時の処理フロー

1. AIが不明点を検出
2. 質問リストを作成（現時点で把握しているもの）
3. 質問の数と概要を提示
4. 1問目の詳細を質問
5. ユーザーの回答を待つ
6. 回答を受け取り、必要に応じて追加質問を判断
7. 追加質問があれば「追加で確認させてください」と明示
8. 全質問完了まで繰り返す
9. 回答をドキュメントに `[Question]`/`[Answer]` タグで記録（該当する場合）

## 非機能要件への対応

- **パフォーマンス**: N/A（プロンプト変更のため）
- **セキュリティ**: N/A
- **スケーラビリティ**: N/A
- **可用性**: N/A

## 実装上の注意事項

- 各ファイルの既存フォーマットに合わせてインデントを調整する
- 既存ルールとの重複・矛盾を避ける
- Lite版はメイン版と同じ文言を使用する
- セットアッププロンプトは必要に応じて簡略化可能

## 不明点と質問（設計中に記録）

（なし - ドメインモデル設計時に解決済み）

---

作成日: 2025-12-20
