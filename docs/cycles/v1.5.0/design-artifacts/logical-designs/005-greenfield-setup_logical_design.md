# 論理設計: グリーンフィールドセットアップ改善

## 概要

`prompts/setup-init.md` のセクション5「プロジェクト情報の収集」を改善し、複数の情報源から推測を試み、不足分のみ質問する柔軟なフローを実装する。

**重要**: この論理設計では**コードは書かず**、プロンプトの構造とフローの定義のみを行います。

## アーキテクチャパターン

既存の `setup-init.md` の構造を維持しつつ、セクション5を拡張する。

## コンポーネント構成

### 変更対象

```
prompts/setup-init.md
└── セクション5: プロジェクト情報の収集【初回のみ】
    ├── 5.1 情報源の探索（新規追加）
    ├── 5.2 README.mdの読み込み（既存、5.1に統合）
    ├── 5.3 プロジェクト情報の推測（既存を拡張）
    ├── 5.4 推測結果の確認（既存を移動）
    └── 5.5 不足項目の質問（既存を改善）
```

## 処理フロー概要

### セクション5 改善後の処理フロー

**ステップ**:

1. **情報源の探索**
   - 以下の情報源を順に確認し、存在するものを収集
   - README.md → 設定ファイル → docs/（aidlc/除く） → ソースコード

2. **プロジェクト情報の推測**
   - 収集した情報源から各フィールドを推測
   - 推測の根拠となった情報源も記録

3. **推測結果の確認**
   - 推測できた項目をテーブル形式で表示
   - ユーザーに確認を求める

4. **不足項目の質問**（必要な場合のみ）
   - aidlc.toml構成に必要な情報が不足している場合のみ質問
   - 一問一答形式で質問

## インターフェース設計

### 5.1 情報源の探索（新規セクション）

**注意**: `docs/aidlc/` はこのセットアップで作成されるディレクトリのため、探索対象から除外する。

```bash
# 1. README.md の確認
README_EXISTS=$(ls README.md 2>/dev/null && echo "yes" || echo "no")

# 2. 設定ファイルの確認（優先順位順）
CONFIG_FILE=""
for f in package.json go.mod Cargo.toml pyproject.toml composer.json Gemfile; do
  if [ -f "$f" ]; then
    CONFIG_FILE="$f"
    break
  fi
done

# 3. docs/ ディレクトリの確認（aidlc/ を除外）
# docs/aidlc/ はセットアップで作成されるため探索対象外
DOCS_FILES=$(find docs -maxdepth 2 -name "*.md" -not -path "docs/aidlc/*" -not -path "docs/cycles/*" 2>/dev/null | head -5)
DOCS_EXISTS=$([ -n "$DOCS_FILES" ] && echo "yes" || echo "no")

# 4. ソースコードディレクトリの確認
SRC_DIR=""
for d in src lib app cmd pkg; do
  if [ -d "$d" ]; then
    SRC_DIR="$d"
    break
  fi
done

echo "情報源: README=${README_EXISTS}, CONFIG=${CONFIG_FILE:-none}, DOCS=${DOCS_EXISTS}, SRC=${SRC_DIR:-none}"
```

**探索結果の表示**:
```
プロジェクトの情報源を確認しました：

| 情報源 | 状態 |
|--------|------|
| README.md | [あり/なし] |
| 設定ファイル | [ファイル名/なし] |
| docs/（プロジェクト固有） | [あり/なし] |
| ソースコード | [ディレクトリ名/なし] |
```

### 5.2 プロジェクト情報の推測（拡張）

既存の5.1（README.mdの読み込み）と5.1.1（リンク先の読み込み）を統合し、以下の順序で推測：

| フィールド | 推測方法（優先順位順） |
|-----------|----------------------|
| name | 1. package.json等のname 2. README.mdのタイトル 3. ディレクトリ名 |
| description | 1. package.json等のdescription 2. README.mdの冒頭 |
| languages | 1. 設定ファイルの種類から推測 2. ソースコードの拡張子から推測 |
| frameworks | 1. 依存関係から推測（package.json, go.mod等） |
| namingConvention | 1. 既存コードのスタイルから推測 2. デフォルト: lowerCamelCase |

### 5.3 推測結果の確認

```
プロジェクト情報を推測しました：

| 項目 | 推測値 | 根拠 |
|------|--------|------|
| プロジェクト名 | [値] | [情報源] |
| プロジェクト概要 | [値] | [情報源] |
| 使用言語 | [値] | [情報源] |
| フレームワーク | [値] | [情報源] |
| 命名規則 | [値] | [情報源/デフォルト] |

上記の内容で問題ありませんか？変更したい項目があれば教えてください。
```

### 5.4 不足項目の質問

**必須フィールドが推測できなかった場合のみ質問**:

必須フィールド:
- name（必須）
- description（推奨）

```
[フィールド名]が推測できませんでした。

[質問に応じた追加情報や選択肢があれば提示]

入力してください（スキップする場合は「スキップ」）:
```

## 非機能要件（NFR）への対応

### パフォーマンス
- **要件**: N/A（プロンプトファイルのため）
- **対応策**: 情報源の読み込みを必要最小限に制限（docs/は最大5ファイル、各100行まで）

### セキュリティ
- **要件**: N/A
- **対応策**: N/A

## 技術選定
- **対象ファイル**: `prompts/setup-init.md`
- **形式**: Markdown + Bash スニペット

## 実装上の注意事項
- 既存のセクション番号（5.x）を維持し、後続セクション（6, 7, 8, 9）に影響を与えない
- 既存のフローを壊さないよう、拡張のみ行う
- **`docs/aidlc/` と `docs/cycles/` は探索対象から除外**（セットアップで作成されるため）
- 情報源がすべて存在しない場合（完全なグリーンフィールド）でも動作するようにする

## 不明点と質問（設計中に記録）

[Question] グリーンフィールド判定の基準について
[Answer] 情報源を広く探索し、推測を試み、aidlc.toml構成に必要な情報が足りない項目のみ質問する柔軟なフローとする。

[Question] docs探索のタイミングについて
[Answer] `docs/aidlc/` はセットアップでコピーされるディレクトリのため、探索対象から除外する。`docs/cycles/` も同様に除外。
