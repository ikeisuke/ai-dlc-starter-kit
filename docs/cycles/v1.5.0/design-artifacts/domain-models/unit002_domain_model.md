# Unit 002: コード記述制限ルール追加 - ドメインモデル設計

## 概要

Construction Phase以外でのコード記述を制限するルールを各フェーズプロンプトに追加する。

## ルールの構造

### 1. コード記述制限ルール（Code Writing Restriction Rule）

**定義**: 各フェーズにおいてコード記述が許可される条件と禁止される条件を明確にするルール

**属性**:
- フェーズ名（phase_name）
- 許可条件リスト（allowed_conditions）
- 禁止条件リスト（prohibited_conditions）
- 違反時の対応（violation_response）

### 2. フェーズ別ルール定義

#### Inception Phase
- **許可**: なし（コード記述は一切禁止）
- **禁止**: 実装コード、テストコード、設計コード
- **既存ルール**: 「フェーズの責務【重要】」セクションに既に定義済み
- **対応**: 既存ルールで十分、変更不要

#### Construction Phase
- **Phase 1（設計フェーズ）**:
  - **許可（例外）**:
    - 設計判断のための探索的データ分析（EDA）
    - ライブラリの動作確認
    - 既存APIの調査
    - ※ これらは設計ドキュメントに反映するための調査であり、成果物としてのコードではない
  - **禁止**: 成果物としての実装コードの記述
  - **理由**: 設計承認前に成果物コードを書くと、手戻りのリスクが高い

- **Phase 2（実装フェーズ）**:
  - **許可**: 設計承認後のコード生成
  - **禁止**: なし（このフェーズが実装の本番）

#### Operations Phase
- **許可**:
  - CI/CD設定ファイル（.github/workflows/*.yml等）
  - デプロイスクリプト
  - 監視・アラート設定
  - インフラ設定（IaC）

- **禁止**:
  - アプリケーションロジックの変更
  - 新機能の実装

- **条件付き許可**:
  - 緊急バグ修正（ユーザー承認必須、修正後はConstruction Phaseへバックトラック推奨）

## 違反時の対応

1. **警告表示**: 「このフェーズではコード記述は許可されていません」
2. **承認フロー**: ユーザーに理由を説明し、承認を求める
3. **バックトラック提案**: 適切なフェーズへの移行を提案

## 追記位置

各プロンプトの「### 開発ルール」セクションに追加、または「### フェーズの責務【重要】」セクションを拡充

## 現状と変更点

| プロンプト | 現状 | 変更点 |
|-----------|------|--------|
| inception.md | 「フェーズの責務【重要】」に既にコード禁止ルールあり | 変更不要 |
| construction.md | Phase 1/Phase 2の分離はあるが明示的禁止ルールなし | 「フェーズの責務【重要】」セクション追加 |
| operations.md | コード記述ルールなし | 「フェーズの責務【重要】」セクション追加 |
