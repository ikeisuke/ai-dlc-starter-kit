# 論理設計: サブエージェント活用ガイド

## 概要

Claude CodeのTask Toolを活用したサブエージェント委任のベストプラクティスをガイドドキュメントとして整理・提供する。

**対象ツール**: Claude Code専用（他のAIエージェントツールでは動作しない）

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。具体的なコード（SQL、JSON、実装コード等）はImplementation Phase（コード生成ステップ）で作成します。

## アーキテクチャパターン

既存のガイドディレクトリ構造に従い、独立したガイドファイルとして配置。

## ファイル構成

```text
prompts/package/
├── guides/
│   ├── ai-agent-allowlist.md    (既存)
│   ├── backlog-management.md    (既存)
│   ├── jj-support.md            (既存)
│   └── subagent-usage.md        (新規作成)
└── prompts/
    └── construction.md          (参照追加)
```

## ガイドファイル設計

### `subagent-usage.md` 構成

#### 1. 概要セクション

- サブエージェント（Task Tool）とは何か
- いつ使用すべきか
- Claude Code固有の機能である旨の注記

#### 2. 委任可能な作業セクション

**バックログ関連**（#64 対応）:

- バックログファイル作成
- GitHub Issue作成
- ガイドへの参照: `backlog-management.md`

**ビルド・検証関連**:

- Markdownlint実行と自動修正
- ユニットテスト実行
- ビルドコマンド実行

**独立したファイル編集**:

- 単一ファイルの定型編集
- 履歴ファイルへの追記

#### 3. 委任不可の作業セクション（メインで処理）

- ユーザーとの対話・承認取得
- 設計レビュー
- MCPレビュー
- 一貫性が必要な複数ファイル編集（依存関係あり）

#### 4. 委任可否判断チェックリストセクション

ドメインモデルで定義したチェックリストをガイドに含める。

#### 5. 実行パターンセクション

- 直列実行（推奨）: 編集衝突防止
- 並列実行: 完全に独立したタスクのみ

**並列実行の禁止条件**（ガードルール）:

- 同一ファイルを編集する可能性がある場合
- 同一ディレクトリのインデックス（目次等）を更新する場合
- 依存関係のあるファイル群を編集する場合

#### 6. サンプル指示テンプレートセクション

- バックログ追加の指示例
- lint実行の指示例

## 参照追加箇所

### パス設計

- **編集先**: `prompts/package/guides/subagent-usage.md`
- **参照先**: `docs/aidlc/guides/subagent-usage.md`（Operations Phaseのrsync反映後）

プロンプト内の参照は `docs/aidlc/guides/` を使用する（利用時は反映済みのため）。

### `construction.md` への追加

「気づき記録フロー」セクション内にガイドへの参照を追加:

```markdown
**サブエージェント活用（オプション）**: バックログ追加処理は、サブエージェントに委任することで効率化できます。詳細は `docs/aidlc/guides/subagent-usage.md` を参照。
```

## 非機能要件（NFR）への対応

Unit定義より該当なし。

## 技術選定

- **形式**: Markdown
- **配置先**: `prompts/package/guides/`

## 実装上の注意事項

- Claude Code固有の機能（Task Tool）前提で記述
- 他のAIエージェントツールでは動作しない旨を明記（ガイド冒頭に警告として配置）
- 具体的な指示テンプレート例を含める
- 委任可否の判断フローチャートまたはチェックリストを追加

## 不明点と質問（設計中に記録）

現時点で不明点なし。
