# Unit 005: プロンプト最適化 - 計画

## 概要

質問深掘りルールの集約と受け入れ基準の具体化ガイダンス追加により、プロンプトを最適化する。

## 関連Issue

- #58: 質問深掘りプロンプトの移動
- #56: ユーザーストーリーの受け入れ基準具体化

## 対象ファイル

| ファイル | 変更内容 |
|---------|---------|
| `prompts/package/prompts/AGENTS.md` | 質問深掘りルールを追加 |
| `prompts/package/prompts/inception.md` | ステップ3に受け入れ基準ガイダンスを追加 |

## Phase 1: 設計

### ステップ1: ドメインモデル設計

本Unitはドキュメント追加のみのため、ドメインモデル設計はスキップ（対話で必要に応じて確認）

### ステップ2: 論理設計

#### 変更1: AGENTS.md に質問深掘りルールを追加

**追加位置**: 「AI-DLC共通ルール」セクション内、「禁止事項」の前

**追加内容**:

```markdown
### 質問と深掘り

ユーザーとの対話で質問する際は、以下のルールに従う：

**質問の目的**:
- 曖昧な要件を明確化する
- 前提条件や制約を確認する
- 複数の解釈がある場合に意図を特定する

**深掘りのテクニック**:
- 「具体的には？」で詳細を引き出す
- 「例えば？」で具体例を求める
- 「なぜ？」で背景・理由を確認する
- ユースケースやシナリオを聞いて理解を深める

**注意事項**:
- 一問一答形式を守る（複数質問を一度にしない）
- 回答を得てから次の質問に進む
- 独自の解釈で進めず、必ず確認する
```

#### 変更2: inception.md ステップ3 に受け入れ基準ガイダンスを追加

**追加位置**: ステップ3の「ユーザーストーリー作成」内、テンプレート参照の前

**追加内容**:

```markdown
**受け入れ基準の書き方【重要】**:

受け入れ基準は「何が実現されていれば完了とみなせるか」を具体的に記述する。

**良い例**（具体的で検証可能）:
- 「ログインボタンをクリックすると、ダッシュボード画面に遷移する」
- 「エラー時に赤色の警告メッセージが3秒間表示される」
- 「検索結果が100件を超える場合、ページネーションが表示される」

**悪い例**（曖昧で検証困難）:
- 「ユーザーが使いやすいこと」
- 「パフォーマンスが良いこと」
- 「適切に処理されること」

**記述のポイント**:
- 主語・動詞・結果を明確にする
- 数値や状態を具体的に記述する
- テスト可能な形で書く
```

## Phase 2: 実装

### ステップ4: コード生成

1. `prompts/package/prompts/AGENTS.md` を編集（質問深掘りルール追加）
2. `prompts/package/prompts/inception.md` を編集（受け入れ基準ガイダンス追加）

### ステップ5: テスト生成

本Unitはドキュメントのみのため、テストはなし

### ステップ6: 統合とレビュー

- Markdownlintの実行
- 設計レビュー（AIレビュー + 人間レビュー）

## 成果物

| 成果物 | パス |
|--------|-----|
| 設計ドキュメント | `docs/cycles/v1.7.4/design-artifacts/logical-designs/prompt-optimization_logical_design.md` |
| 実装記録 | `docs/cycles/v1.7.4/construction/units/prompt-optimization_implementation.md` |
| 履歴 | `docs/cycles/v1.7.4/history/construction_unit5.md` |

## 備考

- このUnitはAGENTS.mdを編集するため、Unit 004（KiroCLI対応）より先に完了する必要がある
- Operations Phaseでrsyncにより `docs/aidlc/` に反映される
