# Unit 4: 移行時ファイル削除確認追加 - 実装計画

## 概要
旧バージョンからの移行時にrsyncで削除されるファイルをユーザーに確認してから実行する。

## 修正対象
- `prompts/setup-init.md`

## 修正内容

### 1. セクション7.2 に注意追加（行243付近）

変更前:
```markdown
### 7.2 パッケージファイルの同期

スターターキットの `prompts/package/` ディレクトリから `docs/aidlc/` に同期。
```

変更後:
```markdown
### 7.2 パッケージファイルの同期【重要: 削除確認必須】

スターターキットの `prompts/package/` ディレクトリから `docs/aidlc/` に同期。

**移行モード・アップグレードモード共通**:
rsync実行前に**必ず**削除対象ファイルを確認し、ユーザーの承認を得てください。

**手順**:
1. ドライランで削除対象を確認
2. `.gitkeep` 以外の削除対象があればユーザーに表示
3. ユーザー承認後に実際の同期を実行
4. 承認が得られない場合は `--delete` オプションなしで同期
```

### 2. セクション7.2.1 の削除確認処理を強化（行256-277付近）

変更前:
```markdown
**削除対象がある場合**: 以下を表示してユーザーに確認
```
以下のファイルが削除されます：
[削除対象のファイル一覧]

これらのファイルを削除してよろしいですか？
```

**承認後に実行**:
```

変更後:
```markdown
**削除対象の確認**:
```bash
# 削除対象を抽出（.gitkeep を除く）
rsync -avn --checksum --delete \
  [スターターキットパス]/prompts/package/prompts/ \
  docs/aidlc/prompts/ 2>&1 | grep "^deleting" | grep -v ".gitkeep"
```

**削除対象がある場合（.gitkeep以外）**:
```
警告: 以下のファイルが削除されます：

[削除対象のファイル一覧]

これらはスターターキットに存在しないファイルです。
プロジェクト固有のカスタマイズが含まれている可能性があります。

選択してください:
1. 削除して同期する（スターターキットと完全同期）
2. 削除せずに同期する（--deleteオプションなし）
3. 同期をキャンセルする

どれを選択しますか？
```

**選択に応じた処理**:
- 1: `rsync -av --checksum --delete ...` を実行
- 2: `rsync -av --checksum ...` を実行（--deleteなし）
- 3: 同期をスキップし、手動対応を案内

**削除対象がない場合（または.gitkeepのみ）**:
```

## 受け入れ基準
- [ ] 移行モード時にrsyncドライランが実行される
- [ ] 削除対象ファイル（.gitkeep以外）がユーザーに表示される
- [ ] ユーザーが3つの選択肢から選べる
- [ ] 承認後に実際の同期が実行される

## 見積もり
小（プロンプト修正のみ）
