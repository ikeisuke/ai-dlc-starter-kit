# サイクル v1.2.3 バックログ

このファイルはサイクル固有のバックログを管理します。

---

## このサイクルで発見した項目

サイクル中に気づいた改善点・技術的負債をここに記録します。

### Lite版プロンプトのパス解決が不安定
- **発見日**: 2025-12-07
- **発見フェーズ**: Construction（Lite）
- **概要**: Lite版でファイルを探す際、1つ上のディレクトリから探し始めて「見つからない」と言ってから正しいパスを掘り下げるという非効率な動作が発生
- **詳細**:
  - 例: `docs/cycles/extra-adventcalendar-2025/progress.md` を探そうとして Error: File does not exist
  - その後「construction/ディレクトリにあるはずです」と推測して再度探す
  - 判断軸は毎回異なるが、一貫してパス解決が不安定
- **対応案**:
  - Lite版プロンプトでファイルパスをより明示的に指定する
  - 相対パスの基準ディレクトリを明確化する
  - サイクルディレクトリ構造の説明を追加する
- **優先度**: 中

### フェーズ遷移のガードレールが不足
- **発見日**: 2025-12-07
- **発見フェーズ**: セットアップ
- **概要**: AIがフェーズを無視して先走り実装を始めてしまう問題
- **詳細**:
  - セットアップ完了後、Inception Phaseを経ずにバックログ項目の実装を開始
  - ユーザーの明示的な承認なしにコード変更を実行
  - AI-DLCのプロセス（計画→承認→実装）が守られない
- **対応案**:
  - セットアップ完了時に「Inception Phase で計画を立ててから実装」と明示
  - 各プロンプトに「このフェーズでは実装しない」等のガードレール追加
  - フェーズごとの許可アクションを明確化（読み取りのみ/計画のみ/実装可能）
  - 「承認なしにコード変更しない」ルールの強化
- **優先度**: 高

### aidlc.toml に starter_kit_version フィールドがない
- **発見日**: 2025-12-07
- **発見フェーズ**: セットアップ
- **概要**: setup-prompt.md で starter_kit_version フィールドを参照するが、aidlc.toml にはコメントとしてのみ記載されている
- **詳細**:
  - setup-prompt.md: `grep -oP 'starter_kit_version\s*=\s*"\K[^"]+'` でフィールドを検索
  - 実際の aidlc.toml: `# スターターキットバージョン: 1.2.2` とコメントのみ
  - バージョン比較が正しく動作しない
- **対応案**:
  - aidlc.toml テンプレートに `starter_kit_version = "X.X.X"` フィールドを追加
  - setup-init.md でフィールドを生成するよう修正
- **優先度**: 中

### 旧バージョン（1.1以前）からの移行時にファイル削除の確認がない
- **発見日**: 2025-12-08
- **発見フェーズ**: セットアップ（アップグレード）
- **概要**: 1.1以前の古い仕組みからアップデートした時に移行モードではなく新規モードになり、rsyncで削除されるファイルを確認なしに同期しようとした
- **詳細**:
  - 旧形式（project.toml等）からのアップグレード時に移行モード判定が正しく動作しない
  - rsyncの--deleteオプションで削除されるファイルをユーザーに確認せず処理しようとする
  - 既存のカスタマイズが失われるリスクがある
- **対応案**:
  - アップグレード時にrsyncで削除されるファイル一覧をユーザーに表示
  - 削除前に必ずユーザー確認を求める
  - .gitkeep ファイルは無視してOK（確認不要）
- **優先度**: 高

### 初回セットアップ時のサイクルバージョン提案が不十分
- **発見日**: 2025-12-08
- **発見フェーズ**: セットアップ
- **概要**: AI-DLC初回でもプロジェクト自体にはバージョンがある場合があるので、サイクルバージョンを提案する前にプロジェクトのバージョン情報を調査すべき
- **詳細**:
  - 現状: 初回セットアップ時に「v1.0.0」などを単純に提案
  - 問題: プロジェクトが既に v2.3.1 等のバージョンを持っている場合がある
  - package.json、pyproject.toml、Cargo.toml、version.txt 等にバージョンがある可能性
- **対応案**:
  - 初回セットアップ時にプロジェクト関連ファイルを軽く調査
  - 既存のバージョン情報があれば表示して参考にしてもらう
  - 調査対象: package.json, pyproject.toml, Cargo.toml, build.gradle, pom.xml, version.txt 等
- **優先度**: 低

### git worktree を活用したワークフローの提案
- **発見日**: 2025-12-08
- **発見フェーズ**: セットアップ
- **概要**: git worktree を使うことで、サイクルごとに独立した作業ディレクトリを持てるようにしたい
- **詳細**:
  - 現状: 1つのディレクトリでブランチを切り替えて作業
  - 問題: 複数サイクルを並行作業する場合にブランチ切り替えが煩雑
  - git worktree を使えば `cycle/v1.2.3` と `cycle/v1.3.0` を同時に別ディレクトリで作業可能
- **対応案**:
  - セットアップ時に git worktree の使用を提案
  - worktree 前提のディレクトリ構成を案内
  - 例: `git worktree add ../project-v1.2.3 cycle/v1.2.3`
  - worktree 使用時の注意点（共有される .git、独立する作業ディレクトリ）を説明
- **優先度**: 低

### 日時記録時に毎回現在時刻を取得していない
- **発見日**: 2025-12-08
- **発見フェーズ**: セットアップ
- **概要**: AIが最初に取得した日時をセッション中ずっと使い回し、実際の時刻とずれる
- **詳細**:
  - セットアップ開始時に `date` コマンドで取得した時刻を記憶
  - その後のバックログ追加時も同じ時刻を使い続ける
  - 実際には数十分〜数時間ずれている場合がある
- **対応案**:
  - プロンプトに「日時を記録する際は必ず `date` コマンドで現在時刻を取得すること」を明記
  - history.md、backlog.md 更新時のルールとして強調
- **優先度**: 中

---

## 共通バックログから対応する項目

Inception Phase等で共通バックログ（`docs/cycles/backlog.md`）から選択した項目を転記します。

（例）
### [項目タイトル]
- **元の場所**: docs/cycles/backlog.md
- **転記日**: YYYY-MM-DD
- **対応予定**: [どのUnitで対応するか]

---

## Operations Phase完了時の処理

このファイルの項目は、Operations Phase完了時に以下のルールで処理されます：

| 出自 | 状態 | 移動先 |
|------|------|--------|
| このサイクルで発見 | 対応済み | backlog-completed.md |
| このサイクルで発見 | 未対応 | backlog.md（共通） |
| 共通から転記 | 対応済み | backlog-completed.md（共通から削除） |
| 共通から転記 | 未対応 | 共通に残す（転記を取り消し） |

---

## 最終更新

**日時**: 2025-12-08 13:31 JST
**更新者**: 日時記録項目追加・日付修正

### 2025-12-08 17:08:31 JST 気づき: Construction Phase用progressテンプレートがない
- **関連**: 新規課題
- **詳細**: `docs/aidlc/templates/` ディレクトリにはinception_progress_template.mdとoperations_progress_template.mdがあるが、construction_progress_template.mdが存在しない
- **候補**:
  1. Construction Phase用のprogressテンプレートを個別に作成する
  2. 3フェーズ共通のprogressテンプレートを作成する（共通化）
  3. progressテンプレートは不要とし、各プロンプト内に記載されたフォーマットに従う

### 2025-12-08 17:12:16 JST 気づき: コンテキストリセットのタイミング見直し
- **関連**: Unit 2（フェーズ遷移ガードレール強化）または新規課題
- **詳細**: 現在のプロンプトでは「Unit完了時」にコンテキストリセットを提案しているが、本来は「何かを開始する時」にリセットすべき
- **候補**:
  1. Unit 2の修正内容に「コンテキストリセットタイミングの見直し」を追加
  2. 新規Unitとして分離し、次サイクルで対応
  3. コンテキストリセット専用のガイドラインを作成

### 2025-12-08 17:14:15 JST 気づき: Unit開始前のバックログ確認がステップ化されていない
- **関連**: Unit 2（フェーズ遷移ガードレール強化）
- **詳細**: 気づき記録フローに「次のUnit開始時にバックログを確認」とあるが、「最初に必ず実行すること（5ステップ）」には含まれていない
- **対応**: Unit 2 実装時にバックログを確認し、関連する気づきがあれば一緒に対応する

### 2025-12-08 20:39:26 JST 気づき: Unit定義ファイルのパス予測が非効率
- **関連**: 新規課題
- **詳細**: Unit定義ファイルを読み込む際、ファイル名を予想して試してエラーになり、その後Globで探すという非効率な動作が発生している
- **例**: `unit_2_phase_transition_guardrail.md` を試して失敗 → Globで `unit2_phase_guardrail.md` を発見
- **対応案**:
  1. progress.mdのUnit一覧にファイルパス列を追加
  2. Unit定義テンプレートでファイル名規則を明確化
  3. Unitファイル名の命名規則を統一（例: `unit[番号]_[snake_case].md`）
