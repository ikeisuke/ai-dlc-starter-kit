# ドメインモデル設計: ルール責務分離とフェーズ簡略指示

**Unit**: 001-rules-separation
**作成日**: 2026-01-10

---

## 1. ルール責務の分類

### 1.1 AI-DLC共通ルール（AGENTS.mdに配置）

全プロジェクト・全サイクルで適用されるルール：

| カテゴリ | ルール内容 |
|----------|------------|
| 実行前検証 | MCPレビュー推奨、指示の妥当性検証 |
| フェーズ責務 | Inception=要件定義、Construction=設計実装分離、Operations=デプロイ運用 |
| 禁止事項 | 履歴削除禁止、承認なしの進行禁止、独自判断禁止 |

### 1.2 プロジェクト固有ルール（rules.mdに配置）

プロジェクトごとにカスタマイズされるルール：

| カテゴリ | 内容 |
|----------|------|
| コーディング規約 | 命名規則、フォーマット等 |
| ライブラリ制約 | 使用禁止/推奨ライブラリ |
| セキュリティ要件 | 認証・認可方針等 |
| パフォーマンス要件 | レスポンスタイム等 |
| カスタムワークフロー | レビュープロセス等 |

### 1.3 スターターキット固有ルール（このプロジェクトのrules.md）

AI-DLCスターターキット開発に特有のルール：

| ルール | 説明 |
|--------|------|
| メタ開発の意識 | ツール側(prompts/)と成果物側(docs/)の区別 |
| docs/aidlc/編集禁止 | rsyncで上書きされるため、prompts/package/を編集 |

---

## 2. フェーズ簡略指示のマッピング

### 2.1 キーワードとプロンプトの対応

| 簡略指示キーワード | 対応プロンプト |
|-------------------|----------------|
| `インセプション進めて`、`inception` | `docs/aidlc/prompts/inception.md` |
| `コンストラクション進めて`、`construction` | `docs/aidlc/prompts/construction.md` |
| `オペレーション進めて`、`operations` | `docs/aidlc/prompts/operations.md` |
| `セットアップ`、`setup` | `docs/aidlc/prompts/setup.md` |

### 2.2 サイクル判定ロジック

```
1. ブランチ名から判定
   - pattern: cycle/vX.X.X → サイクル vX.X.X
   - pattern: cycle/vX.X.X/unit-NNN → サイクル vX.X.X

2. mainブランチの場合
   - セットアップを促す: 「setup.md を読み込んでください」

3. コンテキストなしで「続けて」の場合
   - ユーザーに確認: 「どのフェーズを継続しますか？」
```

### 2.3 完了時メッセージの簡略化

現在の冗長なメッセージ:
```
以下のファイルを読み込んで、サイクル vX.X.X の Construction Phase を継続してください：
docs/aidlc/prompts/construction.md
```

簡略化後:
```
「コンストラクション進めて」と指示してください。
```

---

## 3. エンティティ定義

### 3.1 PhaseCommand（値オブジェクト）

フェーズ簡略指示コマンド

| 属性 | 型 | 説明 |
|------|-----|------|
| keywords | string[] | トリガーキーワード一覧 |
| promptPath | string | 対応プロンプトファイルパス |
| phaseName | string | フェーズ名 |

### 3.2 RuleCategory（列挙型）

```
- COMMON: AI-DLC共通ルール
- PROJECT_SPECIFIC: プロジェクト固有ルール
```

---

## 4. 責務の分離方針

### 4.1 ファイル配置

| ファイル | 責務 |
|----------|------|
| `AGENTS.md` | AI-DLC共通ルール + フェーズ簡略指示 |
| `rules.md` | プロジェクト固有ルールのみ |
| `rules_template.md` | 新規プロジェクト用テンプレート |

### 4.2 参照関係

```
AGENTS.md (読み込み必須)
    ├── 共通ルール（全プロジェクト共通）
    ├── フェーズ簡略指示機能
    └── docs/cycles/rules.md への参照

rules.md (プロジェクトごとにカスタマイズ)
    └── プロジェクト固有ルール
```
