# Unit 2: バージョン管理改善 - ドメインモデル設計

## 概要

バージョン管理に関する概念と責務を定義し、整合性のある更新フローを設計する。

---

## ドメイン概念

### 1. スターターキットバージョン (StarterKitVersion)

スターターキット自体のバージョンを表す概念。

**属性**:
- `version`: セマンティックバージョン文字列（例: "1.3.0"）

**管理場所**:
| ファイル | 役割 | 更新タイミング |
|----------|------|----------------|
| `version.txt` | マスターバージョン（単一の信頼できる情報源） | Operations Phase リリース時 |
| `docs/aidlc.toml` の `starter_kit_version` | インストール済みバージョンの記録 | セットアップ/アップグレード時 |

**責務**:
- `version.txt` が唯一の信頼できる情報源（Single Source of Truth）
- `aidlc.toml` はプロジェクトにインストールされた時点のバージョンを記録
- 両者の比較によりアップグレード要否を判定

### 2. サイクルバージョン (CycleVersion)

AI-DLCサイクルを識別するバージョン。

**属性**:
- `version`: バージョン文字列（例: "v1.3.0", "2024-12"）

**管理場所**:
- `docs/cycles/{version}/` ディレクトリ名
- `docs/cycles/{version}/history.md` 内のサイクル情報

**責務**:
- サイクル単位の成果物を識別
- プロジェクトのリリースバージョンと整合性を保つ（推奨）

### 3. プロジェクトバージョン (ProjectVersion)

スターターキットを導入するプロジェクト自体のバージョン。

**情報源**（優先順位順）:
1. `package.json` の `version` フィールド（Node.js）
2. `pyproject.toml` の `version` フィールド（Python）
3. `Cargo.toml` の `version` フィールド（Rust）
4. `build.gradle` / `pom.xml`（Java）
5. その他の設定ファイル

**責務**:
- 初回セットアップ時のサイクルバージョン提案の参考値を提供

---

## ドメインルール

### R1: スターターキットバージョン更新の整合性

Operations Phase でスターターキットをリリースする際：
1. `version.txt` を新バージョンに更新する
2. **同時に** `docs/aidlc.toml` の `starter_kit_version` も更新する

**理由**: 次回セットアップ時のアップグレード検出が正しく動作するため

### R2: サイクルバージョンの提案ロジック

初回セットアップ時のサイクルバージョン提案：
1. プロジェクトバージョン情報源を調査
2. バージョンが見つかった場合：そのバージョンを初期値として提案
3. バージョンが見つからない場合：`v1.0.0` を初期値として提案
4. ユーザーは提案値を変更可能

### R3: バージョン形式の許容

サイクルバージョンは以下の形式を許容：
- セマンティックバージョン: `v1.0.0`, `1.0.0`
- 日付ベース: `2024-12`, `2024.12`
- カスタム: プロジェクト固有の命名規則

---

## 更新フロー

### Operations Phase でのバージョン更新（US-2）

```
1. version.txt を新バージョンに更新
2. docs/aidlc.toml の starter_kit_version を同じ値に更新
3. README.md のバージョン情報を更新（該当箇所がある場合）
4. Git コミット
```

### 初回セットアップでのバージョン提案（US-3）

```
1. プロジェクトルートのバージョン情報源を調査
   - package.json, pyproject.toml, Cargo.toml 等を順にチェック
2. バージョンが見つかった場合
   → "プロジェクトバージョン {version} を検出しました。サイクルバージョンとして使用しますか？"
3. バージョンが見つからない場合
   → "サイクルバージョンを入力してください（デフォルト: v1.0.0）"
```

---

## 影響範囲

### 修正対象ファイル

| ファイル | 修正内容 |
|----------|----------|
| `docs/aidlc/prompts/operations.md` | バージョン更新手順の追加（US-2） |
| `prompts/setup-prompt.md` または `prompts/setup-init.md` | プロジェクトバージョン調査ステップの追加（US-3） |

### 関連ファイル（参照のみ）

| ファイル | 関連 |
|----------|------|
| `version.txt` | マスターバージョン |
| `docs/aidlc.toml` | インストール済みバージョン |
