# 論理設計: 進捗管理再設計

## 概要

Construction Phaseのprogress.mdを廃止し、Unit定義ファイルに状態セクションを追加する方式を実装する。

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。

## アーキテクチャパターン

**分散状態管理**: 各Unit定義ファイルが自身の状態を保持し、AIが実行時に収集・集約する方式

**選定理由**:
- 複数人開発時のコンフリクトを防止
- Unit単位での担当分けと整合
- 状態と定義を同一ファイルで管理し情報の分散を防止

## コンポーネント構成

### ファイル構成

```
docs/cycles/{{CYCLE}}/
├── story-artifacts/
│   └── units/
│       ├── unit1_xxx.md  ← 実装状態セクション追加
│       ├── unit2_xxx.md
│       └── ...
├── construction/
│   ├── units/            ← 実装記録（変更なし）
│   └── progress.md       ← 【廃止】
├── inception/
│   └── progress.md       ← 【維持】
└── operations/
    └── progress.md       ← 【維持】
```

### コンポーネント詳細

#### Unit定義ファイル（変更）

- **パス**: `docs/cycles/{{CYCLE}}/story-artifacts/units/unit{番号}_{name}.md`
- **責務**: Unitの定義 + 実装状態の管理
- **変更内容**: 末尾に「実装状態」セクションを追加

#### construction.md（変更）

- **パス**: `docs/aidlc/prompts/construction.md`
- **責務**: Construction Phaseの手順を定義
- **変更内容**:
  - progress.md参照を削除
  - Unit定義ファイルからの状態読み取りロジックを記載
  - Unit完了時の更新先をUnit定義ファイルに変更

#### unit_template.md（変更）

- **パス**: `docs/aidlc/templates/unit_template.md`
- **責務**: Unit定義の雛形
- **変更内容**: 「実装状態」セクションのテンプレートを追加

#### inception.md（変更）

- **パス**: `docs/aidlc/prompts/inception.md`
- **責務**: Inception Phaseの手順を定義
- **変更内容**: Unit定義作成時に「実装状態」セクション（初期値）を含める指示を追加

## データモデル概要

### Unit定義ファイル - 実装状態セクション

**形式**: Markdown

**追加フィールド**:

```markdown
---
## 実装状態

- **状態**: 未着手
- **開始日**: -
- **完了日**: -
- **担当**: -
```

| フィールド | 型 | 説明 | 有効値 |
|------------|------|------|--------|
| 状態 | enum | 現在の実装状態 | 未着手 / 進行中 / 完了 |
| 開始日 | date | 作業開始日 | YYYY-MM-DD または - |
| 完了日 | date | 作業完了日 | YYYY-MM-DD または - |
| 担当 | string | 担当者 | @username または - |

## 処理フロー概要

### Construction Phase開始時の処理フロー

**ステップ**:
1. `story-artifacts/units/` ディレクトリ内の全 `.md` ファイルを列挙
2. 各ファイルの「実装状態」セクションを読み取り
3. 依存関係（「依存する Unit」セクション）を読み取り
4. 状態が「進行中」のUnitがあれば、そのUnitを継続
5. なければ、依存Unitが全て完了しているUnitを「実行可能」として列挙
6. ユーザーに実行可能Unitを提示し、選択を求める

### Unit開始時の処理フロー

**ステップ**:
1. 選択されたUnit定義ファイルを読み込み
2. 「実装状態」セクションを更新:
   - 状態: 未着手 → 進行中
   - 開始日: 現在日付
   - 担当: 担当者名（任意）
3. ファイルを保存

### Unit完了時の処理フロー

**ステップ**:
1. Unit定義ファイルの「実装状態」セクションを更新:
   - 状態: 進行中 → 完了
   - 完了日: 現在日付
2. ファイルを保存
3. 履歴記録（history.md）
4. Gitコミット

## 変更対象ファイル一覧

### 1. `docs/aidlc/prompts/construction.md`

**変更箇所**:

| セクション | 変更内容 |
|------------|----------|
| 3. 進捗管理ファイル確認 | progress.md → Unit定義ファイルからの状態読み取りに変更 |
| 4. 対象Unit決定 | progress.md参照 → Unit定義ファイルの「実装状態」セクション参照に変更 |
| Unit完了時の必須作業 | progress.md更新 → Unit定義ファイルの「実装状態」更新に変更 |
| 完了基準 | progress.md更新 → Unit定義ファイル更新に変更 |

### 2. `docs/aidlc/templates/unit_template.md`

**変更箇所**:
- ファイル末尾に「実装状態」セクションのテンプレートを追加

### 3. `docs/aidlc/prompts/inception.md`

**変更箇所**:
- ステップ5（Unit定義作成）の指示に「実装状態」セクションの初期値を含める指示を追加

### 4. 既存Unit定義ファイル（v1.3.0）

**変更箇所**:
- 5つの既存Unit定義ファイルに「実装状態」セクションを追加

## 非機能要件（NFR）への対応

### スケーラビリティ

- **要件**: 複数人開発でもスケールする仕組み
- **対応策**: 各Unit定義ファイルが独立して状態を管理するため、複数人が同時に別Unitを作業してもコンフリクトしない

## 技術選定

- **言語**: Markdown
- **形式**: 人間可読なテキスト形式を維持

## 実装上の注意事項

1. **後方互換性**: 既存のUnit定義ファイルには「実装状態」セクションがないため、存在しない場合は「未着手」として扱う
2. **セクション位置**: 「実装状態」セクションはファイル末尾に配置（既存セクションの後）
3. **日付フォーマット**: `YYYY-MM-DD` 形式で統一

## 不明点と質問（設計中に記録）

（ドメインモデル設計で解決済み）
