# Unit 5: バックログ構造改善 - 実装計画

## 概要

backlog.md/backlog-completed.md の構造を改善し、heredocで追記しても構造が崩れないファイル構成を実現する。

## 現状の問題点

### 1. docs/cycles/backlog.md の構造
```
# バックログ（サイクル横断）
...
## 最終更新      ← ファイル終盤に配置
...
## 参照          ← 最終更新の後
...
### 新規項目     ← heredocで追記するとここに追加される
```

「最終更新」セクションがファイル終盤にあるため、heredocで追記すると構造が崩れる。

### 2. docs/cycles/backlog-completed.md の構造
同様に「最終更新」が終盤にあり、追記時に構造が崩れる。
また「完了済み延期タスク」セクションが重複している。

### 3. テンプレートファイル
- `docs/aidlc/templates/backlog_template.md`: 「最終更新」セクションがない（問題なし）
- `docs/aidlc/templates/backlog_completed_template.md`: 「最終更新」セクションがない（問題なし）
- `prompts/package/templates/` にも同様のテンプレートがある

## 改善方針

### 選択肢

1. **最終更新を先頭に移動** - メタ情報を先頭、追記セクションを末尾に配置
2. **追記専用セクションを明示** - ファイル末尾に「## 新規項目（追記用）」セクションを設置
3. **最終更新を廃止** - Gitの履歴で追跡するため「最終更新」自体が不要

### 推奨案: 選択肢3（最終更新の廃止）

**理由**:
- Gitの履歴で最終更新者・日時は追跡可能
- 手動更新が必要なメタ情報は忘れやすくメンテナンスコストが高い
- ファイル構造がシンプルになり、追記時の問題が解消される

## 実施内容

### Phase 1: 設計（このプランで承認後は不要）

設計ドキュメントは不要（ファイル構造の変更のみで、ドメインモデル・論理設計は該当なし）

### Phase 2: 実装

#### 1. テンプレートファイルの更新

**対象ファイル**:
- `docs/aidlc/templates/backlog_template.md`
- `docs/aidlc/templates/backlog_completed_template.md`
- `prompts/package/templates/backlog_template.md`
- `prompts/package/templates/backlog_completed_template.md`

**変更内容**:
- 「最終更新」セクションを削除（存在する場合）
- ファイル末尾に追記用のマーカーコメントを追加（オプション）
- 構造を整理し、末尾への追記が自然にできる形式に

#### 2. 既存バックログファイルの移行

**対象ファイル**:
- `docs/cycles/backlog.md`
- `docs/cycles/backlog-completed.md`

**変更内容**:
- 「最終更新」セクションを削除
- 「参照」セクションをファイル先頭（タイトル直下）に移動
- 重複セクションの整理（backlog-completed.mdの「完了済み延期タスク」重複を解消）
- 末尾への追記が自然にできる構造に整理

#### 3. プロンプトファイルの確認・更新

**確認対象**:
- `docs/aidlc/prompts/operations.md`
- `docs/aidlc/prompts/inception.md`
- `docs/aidlc/prompts/construction.md`

**変更内容**:
- バックログ追記時の手順が「最終更新」セクションの更新を求めている場合は削除
- heredocでの追記例を追加（必要に応じて）

### 期待される構造（改善後）

#### backlog.md
```markdown
# バックログ（サイクル横断）

> 参照: [完了済み項目](./backlog-completed.md)

---

## 延期タスク
...

## 技術的負債・修正タスク
...

## 次サイクルで検討するタスク
...

<!-- 新規項目はここに追記 -->
```

#### backlog-completed.md
```markdown
# 完了済みバックログ

---

## 完了済み技術的負債
...

## 完了済み延期タスク
...

<!-- 完了項目はここに追記 -->
```

## 完了基準

- [ ] 全テンプレートファイルの更新完了
- [ ] 既存バックログファイルの移行完了
- [ ] 重複セクションの解消
- [ ] プロンプトファイルの確認・更新完了
- [ ] ビルド成功（該当する場合）
- [ ] 実装記録の作成

## リスク

- **低**: 既存のバックログ内容は保持されるため、情報の損失リスクは低い
- **低**: 構造変更のみのためコードへの影響なし
