# ドメインモデル: Construction Phase Unit PR作成・マージ

## 概要
各Unit完了時にサイクルブランチへのPRを作成し、レビュー後にマージする機能の責務と構造を定義する。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。

## ドメイン概念

### Unit PR作成・マージプロセス
Construction Phase内で各Unitの実装が完了した際、Unit用ブランチからサイクルブランチへのPRを作成し、レビュー後にマージする。これにより、Unit単位でのレビューが可能になり、複数人・複数セッションでの並行作業が容易になる。

### ブランチ戦略
```
main
  └── cycle/vX.X.X （サイクルブランチ = Inception時にドラフトPR作成済み）
        ├── cycle/vX.X.X/unit-001 （Unit 001用ブランチ）
        ├── cycle/vX.X.X/unit-002 （Unit 002用ブランチ）
        └── cycle/vX.X.X/unit-NNN （Unit NNN用ブランチ）
```

## 責務定義

### 1. Unitブランチ作成
- **責務**: Unit作業開始時にUnitブランチを作成
- **タイミング**: Unit開始の承認を得た後
- **コマンド**: `git checkout -b cycle/vX.X.X/unit-NNN`
- **命名規則**: `cycle/{CYCLE}/unit-{NNN}` （NNN = 3桁のUnit番号）

### 2. 前提条件チェック
- **責務**: PR作成に必要な条件が満たされているか確認
- **チェック項目**:
  - GitHub CLI（gh）がインストールされているか
  - GitHub認証が完了しているか
  - リモートリポジトリが設定されているか
  - 現在のブランチがUnitブランチか

### 3. PR情報生成
- **責務**: PRのタイトルと本文を生成
- **タイトル形式**: `[Unit {NNN}] {Unit名}`
- **本文内容**:
  - Unit概要（Unit定義から抽出）
  - 変更ファイル一覧
  - テスト結果サマリ

### 4. PR作成実行
- **責務**: gh CLIを使用してPRを作成
- **コマンド**: `gh pr create --base cycle/vX.X.X --title "..." --body "..."`
- **対象ブランチ**: Unitブランチ → サイクルブランチ

### 5. PRレビュー
- **責務**: ユーザーによるレビューを待機
- **アクション**: PR URLを提示し、レビュー完了を待つ

### 6. PRマージ
- **責務**: gh CLIを使用してPRをマージ
- **コマンド**: `gh pr merge --squash --delete-branch`
- **オプション**: squash merge推奨（履歴の整理）
- **後処理**: Unitブランチを自動削除

### 7. サイクルブランチへの復帰
- **責務**: マージ後、サイクルブランチに戻る
- **コマンド**: `git checkout cycle/vX.X.X && git pull`

## エラーハンドリング

### GitHub CLI利用不可
- **条件**: `gh` コマンドが存在しない
- **対応**: スキップし、手動でのPR作成・マージを案内

### GitHub認証未完了
- **条件**: `gh auth status` が失敗
- **対応**: 認証方法を案内し、スキップ

### Unitブランチ作成失敗
- **条件**: 同名ブランチが既に存在
- **対応**: 既存ブランチにチェックアウトするか確認

### PR作成失敗
- **条件**: 何らかの理由でPR作成が失敗
- **対応**: エラー内容を表示し、手動作成を案内

### マージコンフリクト
- **条件**: サイクルブランチとの間でコンフリクト発生
- **対応**: コンフリクト解決手順を案内

## ユビキタス言語

- **Unitブランチ**: `cycle/{CYCLE}/unit-{NNN}` 形式のブランチ
- **サイクルブランチ**: `cycle/{CYCLE}` 形式のブランチ（Inception時にドラフトPR作成済み）
- **squash merge**: 複数コミットを1つにまとめてマージする方式

## 不明点と質問

なし（Unit定義とUnit 003のドメインモデルで明確化済み）
