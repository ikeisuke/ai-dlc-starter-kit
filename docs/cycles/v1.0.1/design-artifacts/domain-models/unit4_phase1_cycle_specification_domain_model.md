# ドメインモデル: Unit 4 Phase 1 - サイクル指定方法の改善

## 概要
setup-prompt.mdを改善し、将来のセットアップ時に生成されるプロンプトファイル（inception.md, construction.md, operations.md）がサイクル名をハードコードせず、実行時にユーザーに確認するフローを含むようにする。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。実装はImplementation Phase（コード生成ステップ）で行います。

## 問題領域（Problem Domain）

### 現状の問題点
v1.0.0の`prompts/setup-prompt.md`で生成されるプロンプトファイルには以下の問題がある：

1. **サイクル名のハードコード**
   - 生成されるプロンプトファイル内で `docs/cycles/v1.0.1/` のようにサイクル名が固定される
   - 新しいサイクル（v1.0.2, v2.0.0等）を開始する際に、プロンプトファイルを手動で修正する必要がある

2. **サイクル認識の欠如**
   - ユーザーがどのサイクルで作業しているか明示的に確認する仕組みがない
   - 誤って古いサイクルのディレクトリを参照してしまうリスクがある

3. **運用の煩雑さ**
   - サイクルごとにプロンプトファイルを更新する手間が発生
   - 複数サイクルを並行管理する場合に混乱しやすい

## ソリューション領域（Solution Domain）

### エンティティ（Entity）

#### Cycle（サイクル）
- **ID**: サイクル名（例: v1.0.1, v2.0.0, 2024-12等）
- **属性**:
  - name: String - サイクル識別子
  - cyclesRoot: String - サイクルディレクトリのルートパス（例: docs/cycles）
  - exists: Boolean - サイクルディレクトリが存在するか
- **振る舞い**:
  - validate(): サイクル名の妥当性を検証（ディレクトリ存在確認）
  - getPath(): サイクルの完全パス（{cyclesRoot}/{name}）を返す

### 値オブジェクト（Value Object）

#### CycleSpecification（サイクル指定）
- **属性**:
  - cycleName: String - ユーザーが指定したサイクル名
  - isSpecified: Boolean - サイクル名が指定されているか
- **不変性**: 一度生成されたら変更不可
- **等価性**: cycleName が同じであれば等価

#### CycleList（サイクル一覧）
- **属性**:
  - cycles: Array<String> - 利用可能なサイクル名のリスト
  - count: Integer - サイクル数
- **不変性**: 一度生成されたら変更不可
- **等価性**: cycles配列の内容が同じであれば等価

### ドメインサービス

#### CycleDiscoveryService（サイクル発見サービス）
- **責務**: ファイルシステムから利用可能なサイクルを発見する
- **操作**:
  - listAvailableCycles(cyclesRoot): cyclesRootディレクトリ配下の既存サイクルをリストアップ
  - getMostRecentCycle(cyclesRoot): 最新のサイクルを取得（タイムスタンプベース）

#### CycleConfirmationService（サイクル確認サービス）
- **責務**: ユーザーにサイクル名を確認し、適切なサイクルで作業を進める
- **操作**:
  - confirmCycle(): ユーザーからサイクル名を取得
  - validateAndSelect(cycleSpec): 指定されたサイクルの妥当性を検証して選択

## プロセスフロー

### サイクル確認フロー（Cycle Confirmation Flow）

**ステップ**:
1. **サイクル指定の確認**
   - プロンプト内でユーザーに「サイクル名（CYCLE変数）が設定されているか」を確認

2. **未指定の場合の処理**
   - CycleDiscoveryService.listAvailableCycles() を実行
   - 既存サイクル一覧を表示（最新5件程度）
   - ユーザーに「どのサイクルで作業しますか？」と質問
   - ユーザーからサイクル名の入力を受ける

3. **指定されている場合の処理**
   - CycleConfirmationService.validateAndSelect() でサイクルの存在を確認
   - 存在しない場合: エラーメッセージを表示し、ステップ2に戻る
   - 存在する場合: そのサイクルで処理を継続

4. **サイクル決定後**
   - 以降のプロンプト内で `{CYCLE}` 変数としてサイクル名を使用
   - すべてのパス参照で `{{CYCLES_ROOT}}/{CYCLE}/` を使用

## ユビキタス言語

このドメインで使用する共通用語：

- **Cycle（サイクル）**: 開発の反復単位。v1.0.0, v1.0.1, v2.0.0のようなバージョンや、2024-12のような時系列で識別される
- **CYCLES_ROOT**: サイクル固有成果物を格納するルートディレクトリ（通常は `docs/cycles`）
- **Cycle Specification（サイクル指定）**: ユーザーがどのサイクルで作業するかを明示的に指定すること
- **Cycle Discovery（サイクル発見）**: ファイルシステムから既存のサイクルディレクトリを検出すること
- **Hardcoded Cycle（ハードコードされたサイクル）**: プロンプトファイル内に直接記述された固定のサイクル名（v1.0.0の問題点）

## 設計原則

1. **明示性（Explicitness）**: サイクル名は常にユーザーが明示的に指定する
2. **検証（Validation）**: 指定されたサイクルが実際に存在することを確認する
3. **ガイダンス（Guidance）**: サイクル未指定時は、利用可能な選択肢を提示する
4. **一貫性（Consistency）**: すべてのフェーズプロンプトで同じサイクル確認フローを適用する

## 不明点と質問（設計中に記録）

なし（現時点で不明点なし）
