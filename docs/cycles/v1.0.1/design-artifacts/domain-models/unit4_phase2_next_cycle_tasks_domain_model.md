# ドメインモデル: Unit 4 Phase 2 - 次サイクルへのタスクリスト管理

## 概要
サイクル完了時に発見された課題や改善点を次サイクルのタスクリストとして記録し、次サイクル開始時に参照できる仕組みを提供する。ただし、記録されたタスクは「参考情報」であり、次サイクルで必ず実施する必要はない。

**重要**: このドメインモデル設計では**コードは書かず**、構造と責務の定義のみを行います。実装はImplementation Phase（コード生成ステップ）で行います。

## 問題領域（Problem Domain）

### 現状の課題

1. **サイクル間の情報断絶**
   - 各サイクルは独立しており、前サイクルで発見された課題や改善点が引き継がれない
   - Operations Phaseで「次のサイクルで対応すべき」と判断した項目が記録されない
   - 次のサイクル開始時に、前サイクルの状況を思い出す必要がある

2. **フィードバックの散逸**
   - 運用中に発見したバグや改善点が各所に散らばる（history.md、operations記録等）
   - 優先度や重要度が不明確
   - 次サイクルで何に取り組むべきか判断材料が不足

3. **柔軟性の欠如**
   - 「次のサイクルで必ずやる」という強制ではなく、「参考情報として引き継ぐ」という柔軟な仕組みが必要
   - ビジネス状況の変化により、記録されたタスクよりも新しい要件が優先される場合がある

## ソリューション領域（Solution Domain）

### エンティティ（Entity）

#### NextCycleTask（次サイクルタスク）
- **ID**: タスク番号（例: 1, 2, 3...）
- **属性**:
  - title: String - タスクのタイトル（1行概要）
  - description: String - 詳細説明
  - category: TaskCategory - タスクのカテゴリ（後述）
  - priority: TaskPriority - 優先度（後述）
  - source: String - 発見元（例: "Operations Phase", "ユーザーフィードバック"）
  - recordedDate: Date - 記録日
  - recordedCycle: String - 記録されたサイクル（例: v1.0.1）
- **振る舞い**:
  - validate(): タスク情報の妥当性を検証
  - format(): タスクを文字列形式で出力

#### NextCycleTaskList（次サイクルタスクリスト）
- **ID**: サイクル名（例: v1.0.1）
- **属性**:
  - cycle: String - このタスクリストを記録したサイクル
  - tasks: Array<NextCycleTask> - タスクのリスト
  - summary: String - 全体サマリー（任意）
  - createdDate: Date - 作成日
- **振る舞い**:
  - addTask(task): タスクを追加
  - getTasks(category): カテゴリでフィルタリング
  - getTasks(priority): 優先度でフィルタリング

### 値オブジェクト（Value Object）

#### TaskCategory（タスクカテゴリ）
- **属性**: category: String
- **制約**: 以下のいずれか
  - `bug`: バグ修正
  - `feature`: 新機能
  - `improvement`: 既存機能の改善
  - `refactoring`: リファクタリング
  - `documentation`: ドキュメント改善
  - `technical_debt`: 技術的負債の解消
  - `other`: その他
- **不変性**: 一度生成されたら変更不可
- **等価性**: category文字列が同じであれば等価

#### TaskPriority（タスク優先度）
- **属性**: priority: String
- **制約**: 以下のいずれか
  - `high`: 高優先度（次サイクルで検討すべき）
  - `medium`: 中優先度（機会があれば対応）
  - `low`: 低優先度（参考程度）
- **不変性**: 一度生成されたら変更不可
- **等価性**: priority文字列が同じであれば等価
- **重要な性質**: 優先度は「強制度」ではなく「推奨度」を表す。Highでも次サイクルで必ず実施する必要はない

### ドメインサービス

#### TaskRecordingService（タスク記録サービス）
- **責務**: Operations Phase完了時にタスクリストを作成する
- **操作**:
  - recordTasks(cycle, tasks): 次サイクル用のタスクリストファイルを作成
  - appendTask(cycle, task): 既存のタスクリストにタスクを追加

#### TaskRetrievalService（タスク取得サービス）
- **責務**: 前サイクルのタスクリストを読み込む
- **操作**:
  - getPreviousCycleTasks(currentCycle): 前サイクルのタスクリストを取得
  - listAvailableTaskLists(): 利用可能なタスクリストを一覧表示

## プロセスフロー

### タスク記録フロー（Operations Phase完了時）

**ステップ**:
1. **サイクル完了の確認**
   - Operations Phaseの全ステップが完了

2. **タスクの集約**
   - 運用中に発見したバグ、改善点、機能リクエストを整理
   - ユーザーフィードバックを確認
   - 次サイクルで対応を検討すべき項目をリストアップ

3. **タスクリストの作成**
   - `{{CYCLES_ROOT}}/{CYCLE}/next_cycle_tasks.md` を作成
   - 各タスクにカテゴリと優先度を設定
   - タスクは「推奨事項」であり、強制ではないことを明記

4. **記録完了**
   - タスクリストがコミットされ、次サイクルから参照可能になる

### タスク読み込みフロー（Inception Phase開始時）

**ステップ**:
1. **前サイクルの確認**
   - 現在のサイクルを確認（例: v1.0.2）
   - 前サイクル（例: v1.0.1）のタスクリストが存在するか確認

2. **タスクリストの提示**
   - 前サイクルのタスクリストが存在する場合:
     - ユーザーに「前サイクルから引き継がれたタスクがあります。参考にしますか？」と質問
     - ユーザーが確認を希望する場合、タスクリストを表示
   - 存在しない場合:
     - スキップ（前サイクルが存在しない初回セットアップ等）

3. **Intent作成への反映**
   - タスクリストは「参考情報」として提供
   - ユーザーが新しいIntentを作成する際に、必要に応じてタスクを組み込む
   - **重要**: タスクリストの内容を自動的にIntentに含める必要はない

4. **柔軟な対応**
   - ユーザーは前サイクルのタスクを無視して、全く新しいIntentを作成できる
   - 一部のタスクだけを採用することも可能
   - ビジネス状況の変化に応じて優先度を再評価

## ユビキタス言語

このドメインで使用する共通用語：

- **Next Cycle Task（次サイクルタスク）**: 前サイクルから引き継がれる課題や改善点。強制ではなく推奨事項
- **Task List（タスクリスト）**: 次サイクル用のタスクを記録したファイル（`next_cycle_tasks.md`）
- **Category（カテゴリ）**: タスクの種類（bug, feature, improvement等）
- **Priority（優先度）**: タスクの推奨度（high, medium, low）。強制度ではない
- **Reference Information（参考情報）**: タスクリストは参考情報であり、次サイクルで必ず実施する必要はない
- **Flexible Adoption（柔軟な採用）**: ユーザーは必要に応じてタスクを選択的に採用できる

## 設計原則

1. **非強制性（Non-Mandatory）**: タスクリストは強制ではなく推奨。次サイクルで無視することも可能
2. **透明性（Transparency）**: 前サイクルの課題を明示的に可視化
3. **柔軟性（Flexibility）**: ユーザーが自由にタスクを選択・無視できる
4. **連続性（Continuity）**: サイクル間の情報を引き継ぎ、改善の連続性を保つ
5. **軽量性（Lightweight）**: 複雑な管理ツールではなく、シンプルなMarkdownファイルで管理

## 不明点と質問（設計中に記録）

なし（現時点で不明点なし）
