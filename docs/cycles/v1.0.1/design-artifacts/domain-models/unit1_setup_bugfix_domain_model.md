# ドメインモデル: Unit 1 - セットアップバグ修正

## 概要
このUnitは「プロンプトファイル修正」という性質上、ビジネスロジックを持つドメインモデルは存在しない。代わりに、修正対象ファイルと修正内容を明確化する。

**重要**: この設計では**コードは書かず**、修正対象と修正方針の定義のみを行います。実装はImplementation Phase（コード生成ステップ）で行います。

## 修正対象の定義

### 修正対象1: セットアップ時のディレクトリ作成バグ

#### 問題の詳細
- **ファイル**: `prompts/setup-prompt.md`
- **問題**: ディレクトリ作成リスト（行188-198付近）に `inception/` ディレクトリの作成指示が含まれていない
- **影響**: Inception Phase実行時に `inception/progress.md` を作成しようとすると、親ディレクトリが存在せずエラーが発生する可能性がある

#### 修正方針
- `prompts/setup-prompt.md` の「対象ディレクトリ（サイクル固有）」セクションに以下を追加：
  - `{{CYCLES_ROOT}}/{{CYCLE}}/inception/`
- `inception/` ディレクトリ作成後、`.gitkeep` ファイルを配置

### 修正対象2: 日付コマンド展開問題の検証と修正

#### 問題の詳細
- **ファイル**:
  - `prompts/setup-prompt.md`
  - `docs/aidlc/prompts/inception.md`
  - `docs/aidlc/prompts/construction.md`
  - `docs/aidlc/prompts/operations.md`（存在する場合）
- **問題**: heredoc内での `date '+%Y-%m-%d %H:%M:%S'` コマンド使用方法の明確化が不足している可能性
- **影響**: 履歴記録時に日付が正しく展開されず、リテラル文字列として記録される可能性

#### 修正方針
履歴記録の指示箇所で、以下の2つの方法を明確に記載：

**方法1（推奨）**: heredoc外で日付を取得して変数に格納
```bash
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')
cat <<EOF | tee -a docs/cycles/v1.0.1/history.md
---
## ${TIMESTAMP}
...
EOF
```

**方法2**: heredocでダブルクォートを使用（シングルクォートは使わない）
```bash
cat <<EOF | tee -a docs/cycles/v1.0.1/history.md
---
## $(date '+%Y-%m-%d %H:%M:%S')
...
EOF
```

各フェーズプロンプトの履歴記録セクションで、この推奨方法を明記する。

## 既存実装の確認結果

### history.md の現状
- 既存の履歴記録（2025-11-26 23:31:45、2025-11-27 09:51:45）では、日付が正しく記録されている
- これは、セットアップ時とInception Phase実行時に正しく日付が展開されたことを示す

### 結論
- 日付展開自体は機能しているが、プロンプトファイル内での指示が曖昧な可能性がある
- 明確な実装例を追加することで、今後の実行で混乱を防ぐ

## 修正箇所の一覧

### ファイル1: `prompts/setup-prompt.md`
**修正箇所**: 行188-198付近（ディレクトリ作成リスト）
**修正内容**: `inception/` ディレクトリを追加

**修正箇所**: 行457-467付近（history.md記録ルール）
**修正内容**: 日付取得方法を明確化

### ファイル2: `docs/aidlc/prompts/inception.md`
**修正箇所**: 履歴記録の指示箇所（行309付近）
**修正内容**: 日付取得方法の具体例を追加

### ファイル3: `docs/aidlc/prompts/construction.md`
**修正箇所**: 履歴記録の指示箇所（行367付近）
**修正内容**: 日付取得方法の具体例を追加

### ファイル4: `docs/aidlc/prompts/operations.md`
**修正箇所**: 履歴記録の指示箇所（行425付近）
**修正内容**: 日付取得方法の具体例を追加

## 不明点と質問（設計中に記録）

**現時点で不明点はありません。**

既存のhistory.mdを確認した結果、日付が正しく記録されていることを確認しました。修正方針は明確であり、次のステップ（論理設計）に進むことができます。
