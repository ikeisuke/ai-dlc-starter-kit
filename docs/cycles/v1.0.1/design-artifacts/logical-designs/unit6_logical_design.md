# 論理設計: テストとバグ対応基盤

## 概要
Operations Phaseでのテスト記録フォーマットとバグ対応フローを定義するドキュメント群の構成を設計する。テンプレートとフロー文書の構造、および既存プロンプトとの統合方法を定義。

**重要**: この論理設計では**コードは書かず**、コンポーネント構成とインターフェース定義のみを行います。具体的なコード（SQL、JSON、実装コード等）はImplementation Phase（コード生成ステップ）で作成します。

---

## アーキテクチャパターン

**ドキュメント駆動アーキテクチャ**
- テンプレートとフロー文書がAI-DLCプロセスの一部として機能
- 各フェーズプロンプトから参照される形で統合
- Markdownベースで人間とAI双方が読み書き可能

---

## コンポーネント構成

### ドキュメント構成

```
docs/aidlc/
├── templates/
│   └── test_record_template.md    # テスト記録テンプレート【新規】
├── bug-response-flow.md            # バグ対応フロー文書【新規】
└── prompts/
    └── operations.md               # Operations Phaseプロンプト【更新】
```

### コンポーネント詳細

#### テスト記録テンプレート（test_record_template.md）
- **責務**: テストセッションの記録を統一形式で残すためのテンプレート提供
- **依存**: なし（独立したテンプレート）
- **使用場所**: Operations Phase のテスト実施時
- **公開インターフェース**:
  - テストセッション情報セクション
  - テスト項目チェックリスト
  - テスト結果記録セクション
  - バグレポートセクション
  - サマリーセクション

#### バグ対応フロー文書（bug-response-flow.md）
- **責務**: バグ発見時の分類基準と対応フローを文書化
- **依存**: 各フェーズプロンプトのバックトラックセクション
- **公開インターフェース**:
  - バグ分類ガイド（設計/実装/環境バグ）
  - 対応フローチャート
  - フェーズ間の移動手順
  - 再テスト手順

#### Operations Phaseプロンプト更新（operations.md）
- **責務**: テスト記録とバグ対応フローへの参照を追加
- **依存**: test_record_template.md, bug-response-flow.md
- **変更内容**:
  - テスト実施時のテンプレート使用指示
  - バグ発見時のフロー参照指示

---

## インターフェース設計

### テスト記録テンプレート構造

#### ヘッダーセクション
- **必須フィールド**:
  - セッション名: String - テストセッションの識別名
  - 対象Unit: String - テスト対象のUnit名
  - 実施日: Date - テスト実施日
  - 実施者: String - テスト実施者名
  - 環境: String - テスト環境の説明

#### テスト項目セクション
- **フォーマット**: チェックリスト形式（`- [ ]`）
- **項目構成**:
  - テストID: String - 項目の識別子
  - テスト名: String - テスト項目の名前
  - 優先度: Priority - High/Medium/Low
  - ステータス: Checkbox - Pass/Fail/Blocked/Skipped

#### 結果詳細セクション
- **フォーマット**: テーブル形式
- **カラム**:
  - テストID
  - 結果（Pass/Fail/Blocked/Skipped）
  - 実際の結果
  - 備考
  - バグID（Fail時）

#### バグレポートセクション
- **フォーマット**: 見出し + リスト形式
- **項目構成**:
  - バグID: String
  - タイトル: String
  - 重大度: Severity
  - バグ種類: BugType
  - 再現手順: List[String]
  - 期待動作: String
  - 実際動作: String

### バグ対応フロー構造

#### バグ分類ガイドセクション
- **判定基準テーブル**:
  - 症状パターン
  - バグ種類
  - 対応フェーズ
  - 対応例

#### フローチャートセクション
- **フォーマット**: Mermaidフローチャート
- **フロー**:
  1. バグ発見
  2. バグ種類判定
  3. 対応フェーズ決定
  4. バックトラック実行
  5. 修正
  6. 再テスト
  7. 完了確認

#### バックトラック手順セクション
- **フェーズ別手順**:
  - Construction Phase（設計）への戻り方
  - Construction Phase（実装）への戻り方
  - Operations Phase内での修正方法

---

## 処理フロー概要

### テスト実施フロー

**ステップ**:
1. テスト記録テンプレートをコピーして新規ファイル作成
2. ヘッダー情報を記入
3. テスト項目を順次実行、チェックリストを更新
4. 各テストの結果を結果詳細セクションに記録
5. Fail発見時、バグレポートセクションにバグを記録
6. サマリーセクションを記入

**関与するコンポーネント**: test_record_template.md, operations.md

### バグ対応フロー

**ステップ**:
1. バグレポートを確認
2. バグ分類ガイドでバグ種類を判定
3. 対応フェーズを決定
4. 該当フェーズのプロンプトを読み込み（バックトラック）
5. 修正を実施
6. 元のフェーズに戻り再テスト
7. バグステータスを更新

**関与するコンポーネント**: bug-response-flow.md, operations.md, construction.md

---

## 非機能要件（NFR）への対応

### パフォーマンス
- **要件**: 特別な要件なし
- **対応策**: N/A（ドキュメントのみ）

### セキュリティ
- **要件**: 特別な要件なし
- **対応策**: N/A

### スケーラビリティ
- **要件**: 数百のテスト項目に対応可能
- **対応策**:
  - テスト項目をカテゴリ別にグループ化
  - 1セッション1ファイルで管理
  - サマリーセクションで全体把握を容易に

### 可用性
- **要件**: テンプレートとフローが常にアクセス可能
- **対応策**:
  - Markdownファイルとしてリポジトリに保存
  - バージョン管理下に置く

---

## 技術選定

- **フォーマット**: Markdown
- **図表**: Mermaid（フローチャート、シーケンス図）
- **チェックリスト**: GitHub Flavored Markdown（`- [ ]`形式）

---

## 実装上の注意事項

- **既存プロンプトとの整合性**:
  - Construction Phaseの「Operations Phaseからバグ修正で戻ってきた場合」セクションと連携
  - Operations Phaseの「Constructionに戻る必要がある場合」セクションと連携
- **シンプルさの維持**:
  - 必要最小限の情報のみを記録
  - 複雑化を避け、実用性を重視
- **拡張性**:
  - 将来のCI/CD統合を考慮した構造
  - カスタマイズ可能なセクション構成

---

## Operations Phaseプロンプト更新箇所

### 追加すべきセクション/指示

1. **テスト実施セクションの更新**:
   - テスト記録テンプレートの使用指示を追加
   - テンプレートのパス: `docs/aidlc/templates/test_record_template.md`
   - 記録ファイルの保存先: `docs/cycles/{version}/test-records/`

2. **バグ対応セクションの追加/更新**:
   - バグ対応フロー文書への参照を追加
   - フロー文書のパス: `docs/aidlc/bug-response-flow.md`
   - バグ発見時の対応手順を明記

---

## 不明点と質問（設計中に記録）

現時点で不明点はありません。
