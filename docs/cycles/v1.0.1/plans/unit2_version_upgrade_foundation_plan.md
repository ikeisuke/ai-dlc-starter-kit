# Unit 2: バージョンアップ基盤 実装計画

## 概要
スターターキット本体がバージョンアップした際に、利用プロジェクト側でキットを最新化するための基盤を構築します。

## 目的
- 現在のバージョンとリモートの最新バージョンを比較する仕組みの実装
- バージョンアップ手順書の作成
- バージョン間の差分確認方法の文書化
- ロールバック手順の文書化

## 実装範囲

### Phase 1: 設計（対話形式、コードは書かない）

#### ステップ1: ドメインモデル設計
**成果物**: `docs/cycles/v1.0.1/design-artifacts/domain-models/unit2_version_upgrade_domain_model.md`

**設計内容**:
- バージョン情報を表現するエンティティ・値オブジェクト
- バージョン比較のドメインサービス
- バージョン情報リポジトリインターフェース

**対話ポイント**:
- バージョン情報のデータ構造（major.minor.patch）
- バージョン比較ロジックの詳細（セマンティックバージョニング）
- エラーハンドリング方針（ネットワークエラー時の挙動）

#### ステップ2: 論理設計
**成果物**: `docs/cycles/v1.0.1/design-artifacts/logical-designs/unit2_version_upgrade_logical_design.md`

**設計内容**:
- バージョンチェックスクリプトのコンポーネント構成
- アップグレードガイドの構成
- 技術選定（Bash / Python / Node.js）

**対話ポイント**:
- スクリプト言語の選定（プロジェクトの技術スタックに合わせる）
- リモートバージョン取得方法（GitHub API vs 直接ファイル取得）
- オフライン環境への対応方針

#### ステップ3: 設計レビュー
- 設計内容をユーザーに提示し、承認を得る
- **承認なしで実装フェーズに進まない**

---

### Phase 2: 実装（設計を参照してコード生成）

#### ステップ4: バージョンチェックスクリプト実装
**成果物**: `scripts/check-version.sh`（または `.py`, `.js`）

**実装内容**:
- ローカルバージョン取得（`docs/aidlc/version.txt` を読み込み）
- リモートバージョン取得（GitHub リポジトリの `docs/aidlc/version.txt` を取得）
- バージョン比較ロジック（セマンティックバージョニング）
- 結果出力（最新 / アップデート可能 / エラー）

**非機能要件**:
- 実行時間: 5秒以内
- ネットワークエラー時の適切なメッセージ表示
- オフライン環境での graceful degradation

#### ステップ5: アップグレードガイド作成
**成果物**: `docs/aidlc/upgrade-guide.md`

**文書内容**:
- バージョンアップの概要
- 前提条件（Git、ネットワーク接続）
- バージョンチェック手順（スクリプト実行方法）
- バージョン差分確認方法
  - `git log` でリモートとの差分確認
  - 変更内容の確認方法
- アップデート適用手順
  - バックアップ作成
  - リモートからのファイル取得
  - 手動マージ手順
- ロールバック手順
  - バックアップからの復元方法
- トラブルシューティング

#### ステップ6: テスト実行
**テスト内容**:
- バージョンチェックスクリプトの動作確認
  - ローカルバージョン読み込み
  - リモートバージョン取得
  - バージョン比較ロジック
  - エラーケース（ネットワークエラー、ファイル不在）
- アップグレードガイドの手順確認（dry-run）

#### ステップ7: 実装記録とレビュー
**成果物**: `docs/cycles/v1.0.1/construction/units/unit2_version_upgrade_implementation.md`

**記録内容**:
- 実装内容のサマリ
- テスト結果
- 技術的な判断事項
- 残課題（あれば）

---

## 完了基準
- [ ] ドメインモデル設計完了
- [ ] 論理設計完了
- [ ] 設計レビュー承認
- [ ] バージョンチェックスクリプト実装完了
- [ ] アップグレードガイド作成完了
- [ ] テストパス（スクリプト動作確認、手順確認）
- [ ] 実装記録に「完了」明記
- [ ] progress.md 更新
- [ ] history.md 追記
- [ ] Git コミット

---

## 想定される質問事項

**ドメインモデル設計時**:
- バージョン番号の形式はどうしますか？（例: 1.0.0、1.0.0-beta.1）
- バージョン比較で pre-release（alpha, beta等）をサポートしますか？

**論理設計時**:
- スクリプト言語は何にしますか？（Bash / Python / Node.js）
- リモートバージョン取得方法は？（GitHub API / 直接ファイル取得）
- 認証が必要な場合、APIトークンをどう管理しますか？

**実装時**:
- リモートリポジトリのURLは？（デフォルト: https://github.com/ikeisuke/ai-dlc-starter-kit）
- オフライン環境でバージョンチェックをスキップする仕組みは必要ですか？

---

## 依存関係
- なし（独立した Unit）

---

## 見積もり
- ドメインモデル設計: 1時間
- 論理設計: 1時間
- バージョンチェックスクリプト実装: 2時間
- アップグレードガイド作成: 2時間
- テスト: 1時間
- **合計: 7時間**（Unit定義の6時間から+1時間、設計フェーズを追加したため）
