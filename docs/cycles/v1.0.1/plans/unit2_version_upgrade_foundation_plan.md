# Unit 2: バージョンアップ基盤 実装計画（改訂版）

## 概要
スターターキット本体がバージョンアップした際に、利用プロジェクト側でキットを最新化するための基盤を構築します。

## 方針変更
当初計画からの変更点：
- スクリプトによる自動化 → **プロンプトベースの手動確認**に変更
- upgrade-guide.md → **セットアッププロンプト内に統合**
- **バージョンアップ時のフロー設計**を追加

## 成果物

| ファイル | 場所 | 内容 |
|----------|------|------|
| `CHANGELOG.md` | プロジェクトルート | スターターキットの変更履歴 |
| `version.txt` | プロジェクトルート | スターターキットのバージョン |
| セットアッププロンプト修正 | `prompts/setup-prompt.md` | バージョン確認フロー追加 |

---

## 実装内容

### 1. CHANGELOG.md・version.txt 作成

**version.txt**:
- 単純にバージョン番号のみ（例: `1.0.1`）
- コピー先では `docs/aidlc/version.txt` に配置される

**CHANGELOG.md**:
- セマンティックバージョニング形式
- 各バージョンの変更内容を記載

### 2. バージョンアップ時のフロー設計

セットアップ時に以下の分岐を処理：

```
セットアップ開始
    │
    ▼
バージョン確認（GitHub最新版 vs ローカル version.txt）
    │
    ├─【最新版】─────────────────────────┐
    │                                    │
    ├─【新規セットアップ】───────────────┤
    │  （version.txt が存在しない）       │
    │                                    ▼
    └─【アップデートあり】          通常セットアップ
         │                          （ディレクトリ作成等）
         ▼
    変更内容通知（CHANGELOGの差分）
         │
         ▼
    アップデート作業案内
    ・バックアップ推奨
    ・変更ファイルの確認方法
    ・適用手順（git pull / 手動コピー）
         │
         ▼
    進行中サイクルへの影響確認
    ・プロンプト変更の有無
    ・破壊的変更の有無
         │
         ▼
    通常セットアップ or 継続
```

### 3. セットアッププロンプト修正

`prompts/setup-prompt.md` に以下を追加：
- バージョン確認ステップ（冒頭）
- 新規 vs アップデートの分岐処理
- アップデート時の案内

---

## ケース別フロー詳細

### ケース A: 新規セットアップ
1. `docs/aidlc/version.txt` が存在しない
2. 最新版をそのまま使用
3. 通常のセットアップフローへ

### ケース B: 最新版を使用中
1. ローカル version.txt = GitHub 最新版
2. 「最新版です」と通知
3. 通常のセットアップフローへ（サイクル継続）

### ケース C: アップデートあり
1. ローカル version.txt < GitHub 最新版
2. CHANGELOG の差分を表示
3. アップデート方法を案内：
   - 方法1: `git pull`（Git管理している場合）
   - 方法2: 手動で変更ファイルをコピー
4. 進行中サイクルへの影響を確認
5. アップデート実施 or スキップを選択
6. セットアップ継続

### ケース D: ローカルが新しい（開発中など）
1. ローカル version.txt > GitHub 最新版
2. 「開発版を使用中です」と通知
3. そのまま継続

---

## 完了基準

- [ ] CHANGELOG.md 作成
- [ ] version.txt 作成
- [ ] セットアッププロンプトにバージョン確認フロー追加
- [ ] 各ケース（A〜D）の処理が記載されている
- [ ] progress.md 更新
- [ ] history.md 追記
- [ ] Git コミット

---

## 見積もり

- CHANGELOG.md・version.txt 作成: 30分
- バージョンアップフロー設計・プロンプト修正: 1.5時間
- 実装記録・コミット: 30分
- **合計: 2.5時間**

---

## 備考

- スクリプトによる自動化は不要（AIがプロンプトに従って確認）
- 各プロジェクトへの upgrade-guide.md 配置は不要
- シンプルさを優先
