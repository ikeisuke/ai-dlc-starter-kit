# Unit 4: サイクル管理基盤 - Phase 1（サイクル指定方法の改善）実装計画

## 概要
Unit 4の一部として、プロンプトからサイクル名のハードコードを削除し、ユーザーが明示的にサイクル名を指定する方式に改善する。

## 対象範囲
Unit 4の全体ではなく、**サイクル指定方法の改善**のみを先行実装する。

### Phase 1（今回実装）
- サイクル名のハードコード削除
- サイクル名の明示的指定方式の実装
- サイクル一覧表示機能

### Phase 2（後日実装）
- 次サイクルへのタスクリスト管理仕組みの設計
- サイクル横断タスク管理の実装
- タスク集約スクリプト

## Phase 1: 設計（対話形式）

### ステップ1: ドメインモデル設計
**成果物**: `docs/cycles/v1.0.1/design-artifacts/domain-models/unit4_phase1_cycle_specification_domain_model.md`

**内容**:
- 現状の問題点の整理（ハードコードの課題）
- サイクル指定方式の定義
- サイクル一覧取得ロジックの定義

### ステップ2: 論理設計
**成果物**: `docs/cycles/v1.0.1/design-artifacts/logical-designs/unit4_phase1_cycle_specification_logical_design.md`

**内容**:
- 修正対象ファイルの特定（**prompts/setup-prompt.md**のみ）
- サイクル確認フローの詳細設計
- サイクル一覧取得コマンドの設計（`ls -t docs/cycles/ | head -5`）

### ステップ3: 設計レビュー
ユーザーに設計内容を提示し、承認を得る。

## Phase 1: 実装

### ステップ4: プロンプトファイルの修正

**修正対象**:
1. `prompts/setup-prompt.md`
   - inception.md, construction.md, operations.md生成時に「最初に必ず実行すること」セクションにサイクル確認ステップを追加する指示を含める
   - ハードコードされた `{{CYCLES_ROOT}}/{{CYCLE}}/` を、実行時にユーザーに確認するフローに変更

### ステップ5: テスト
- サイクル名を指定してプロンプトを実行
- サイクル名を指定せずにプロンプトを実行（一覧表示を確認）
- 存在しないサイクル名を指定した場合の挙動を確認

### ステップ6: 統合とレビュー
- 修正内容の確認
- テスト結果の確認
- 実装記録の作成: `docs/cycles/v1.0.1/construction/units/unit4_phase1_cycle_specification_implementation.md`

## 完了基準
- [ ] `prompts/setup-prompt.md` が修正され、将来のセットアップ時にサイクル確認ステップを含むプロンプトが生成される
- [ ] サイクル名が指定されていない場合、一覧を表示してユーザーに選択を促すフローが含まれている
- [ ] サイクル名が指定されている場合、そのサイクルで処理が進むフローが含まれている
- [ ] テストが成功している（setup-prompt.mdの内容確認）
- [ ] 実装記録に「完了」が明記されている
- [ ] `progress.md` が更新されている（Unit 4 Phase 1完了として記録）
- [ ] `history.md` に記録されている
- [ ] Gitコミットが作成されている

## 見積もり
- Phase 1（サイクル指定方法の改善）: 2時間
  - 設計: 0.5時間
  - 実装: 1時間
  - テスト: 0.5時間

## 備考
- Unit 4の全体実装は後日、Phase 2として実施
- Phase 1は独立して動作する改善なので、先行実装可能
- Phase 2では、タスクリスト管理とサイクル横断タスク管理を実装
