# Unit 3: 表記揺れ対策 実装計画

## 概要
セットアップ時のプロンプト生成における表記揺れを防止する。

## 問題
- セットアップ時にAIがテンプレートを「解釈」して微妙に文章を変更してしまう
- 同じテンプレートでもセッションが違うと差分が発生
- バージョンアップ時に実質的な変更点がわかりにくい

## 解決策
**変数置換ルールの厳格化**
- テンプレートを**そのままコピー**
- `{{VAR}}` 形式の変数**のみ**を機械的に置換
- **文章の修正・改善・解釈は禁止**

---

## 成果物

| ファイル | 内容 |
|----------|------|
| `prompts/setup/common.md` | 変数一覧・置換ルールを追記 |
| `prompts/setup-prompt.md` | 禁止事項を追記 |

---

## 実装内容

### 1. 変数一覧の明示

`prompts/setup/common.md` に以下を追加：

```markdown
## 変数置換ルール【重要】

### 置換対象の変数一覧
| 変数名 | 説明 | 例 |
|--------|------|-----|
| {{PROJECT_NAME}} | プロジェクト名 | AI-DLC Starter Kit |
| {{CYCLE}} | サイクル識別子 | v1.0.1 |
| {{BRANCH}} | ブランチ名 | feature/v1.0.1 |
| {{AIDLC_ROOT}} | 共通ファイルルート | docs/aidlc |
| {{CYCLES_ROOT}} | サイクルルート | docs/cycles |
| {{ROLE_INCEPTION}} | Inception役割 | プロダクトマネージャー兼ビジネスアナリスト |
| {{ROLE_CONSTRUCTION}} | Construction役割 | ソフトウェアアーキテクト兼エンジニア |
| {{ROLE_OPERATIONS}} | Operations役割 | DevOpsエンジニア兼SRE |
| {{SETUP_PROMPT_PATH}} | セットアッププロンプトのパス | /path/to/setup-prompt.md |
| {{PROJECT_SUMMARY}} | プロジェクト概要 | [セットアップ時に設定] |
| {{LANGUAGE}} | 使用言語 | 日本語 |

### 置換ルール
1. テンプレート（コードブロック内）を**そのままコピー**する
2. 上記の変数**のみ**を対応する値に置換する
3. **文章の修正・改善・言い換えは禁止**
4. 変数以外の部分は**一切変更しない**
```

### 2. セットアッププロンプトに禁止事項追記

`prompts/setup-prompt.md` の冒頭に追加：

```markdown
## 表記揺れ防止ルール【重要】

プロンプトファイル生成時は以下を厳守：
- テンプレート（コードブロック内）を**そのままコピー**
- 変数（`{{VAR}}`形式）**のみ**を置換
- **文章の修正・改善・言い換えは禁止**
- 変数以外の部分は**一切変更しない**

詳細は `prompts/setup/common.md` の「変数置換ルール」を参照。
```

---

## 完了基準

- [ ] 変数一覧を `prompts/setup/common.md` に追記
- [ ] 禁止事項を `prompts/setup-prompt.md` に追記
- [ ] progress.md 更新
- [ ] history.md 追記
- [ ] Git コミット

---

## 見積もり

- 変数一覧作成: 30分
- プロンプト修正: 30分
- 実装記録・コミット: 30分
- **合計: 1.5時間**（当初8時間から大幅短縮）

---

## 備考

- 当初計画のオプション（ハッシュ管理、差分ツールカスタマイズ）は不採用
- シンプルな「ルール明示」で解決
