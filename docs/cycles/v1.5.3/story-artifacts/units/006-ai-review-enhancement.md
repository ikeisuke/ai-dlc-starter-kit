# Unit: AIレビュー機能の強化

## 概要
mode=required時にAIレビューが確実に実行されるようにし、人間に承認を求める前にAIレビューが自動実行される仕組みを導入する。

## 含まれるユーザーストーリー
- ストーリー 2.1: AIレビュー必須設定の確実な実行
- ストーリー 2.2: 人間承認前のAIレビュー自動化

## 責務
- mode=required時の強制実行ロジック
- 承認を求める全てのタイミングでAIレビューを先に実行
- MCP利用不可時の警告表示

## 境界
- レビュー内容の品質改善は含まない
- MCP自体の機能追加は行わない

## 依存関係

### 依存する Unit
- なし

### 外部依存
- Codex MCP または他のAI MCP

## 非機能要件（NFR）
- **パフォーマンス**: MCPの応答速度に依存
- **セキュリティ**: 該当なし
- **スケーラビリティ**: 該当なし
- **可用性**: MCP利用不可時のフォールバック

## 技術的考慮事項

### AIレビュー優先ルール
人間に承認を求める前に、以下を実行する：

1. AI MCP（Codex MCP等）が有効か確認
2. 有効な場合:
   - AIレビューを実行
   - レビュー結果を修正に反映
   - レビュー済みの成果物を人間に提示
3. 無効な場合:
   - mode = "required": 警告メッセージを表示、処理を続行するか確認
   - mode = "recommend": 直接人間に承認を求める

### 適用タイミング
**Inception Phase**:
- Intent承認前
- ユーザーストーリー承認前
- Unit定義承認前

**Construction Phase**:
- ドメインモデル設計完了時
- 論理設計完了時
- アーキテクチャ設計完了時
- 計画ファイル作成完了時

**Operations Phase**:
- デプロイ計画承認前

### mode=required 時の処理フロー
```
1. MCP利用可否チェック
   ├─ 利用可能 → AIレビュー実行 → 結果を人間に提示 → 承認を求める
   └─ 利用不可 → 警告表示
                  「AIレビューが必須設定ですが、MCPが利用できません。
                   続行しますか？（y/n）」
                  ├─ y → 人間承認へ（レビュースキップを記録）
                  └─ n → 処理中断
```

## 対象ファイル
- prompts/package/prompts/inception.md
- prompts/package/prompts/construction.md
- prompts/package/prompts/operations.md

## 実装優先度
High

## 見積もり
各フェーズのプロンプトにルールを追加

---
## 実装状態

- **状態**: 完了
- **開始日**: 2025-12-31
- **完了日**: 2025-12-31
- **担当**: -
