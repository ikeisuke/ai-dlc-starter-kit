# Unit 004: アップグレード後の動作改善 - 実行計画

## 概要
アップグレード完了後に自動でサイクル開始フローに入る問題を修正。ユーザーが明示的に指示するまでサイクル開始を待機するようにする。

## 関連バックログ
- `docs/cycles/backlog/bug-setup-prompt-auto-cycle-start.md`

## 現状の問題分析

### 症状
1. ユーザーがケースC（アップグレード可能）でアップグレードを選択
2. アップグレード処理（セクション4〜9）が完了
3. セクション10で「新しいセッションで」と案内しているが...
4. AIが自動で `setup.md` を読み込んでサイクル開始フローに入ってしまう

### 原因
- セクション10の完了メッセージと、その後の「次のステップ」セクションの指示が明確に「終了」を伝えていない
- ケースBとケースCの完了後の動作が区別されていない

## 修正方針

### 変更対象
- `prompts/setup-prompt.md`

### 修正内容

#### 1. ケースC（アップグレード）の完了メッセージ明確化
セクション10のアップグレード完了メッセージに以下を追加：
- 「セットアップは完了です。このセッションはここで終了です。」
- 「**重要**: 自動で次のファイルを読み込まないでください。」

#### 2. ケースBとケースCの区別を明確化
- ケースB: 「ユーザーの操作を待たずに自動で読み込むこと」を維持
- ケースC: アップグレード完了後は自動読み込みしない指示を追加

#### 3. 完了メッセージの統一
アップグレード完了時のメッセージを以下に統一：
```
AI-DLCのアップグレードが完了しました！

（更新内容省略）

---
**セットアップは完了です。このセッションはここで終了です。**

新しいセッションで以下のコマンドを実行してサイクルを開始してください：
```
以下のファイルを読み込んで、サイクルを開始してください：
docs/aidlc/prompts/setup.md
```
```

## 設計フェーズ

このUnitは主にプロンプトの修正であり、ドメインモデル・論理設計は不要と判断。
直接コード（プロンプト）修正に進む。

## 実装フェーズ

### 変更箇所
1. セクション10「完了メッセージと次のステップ」の「アップグレードの場合」を修正
2. 「次のステップ」セクションの「次のアクション」指示を追加

## 見積もり
- 設計: 不要（プロンプト修正のみ）
- 実装: 軽微な修正
- テスト: 手動確認

## リスク
- 低: プロンプトの文言修正のみ、既存機能への影響なし
