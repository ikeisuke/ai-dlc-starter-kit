# Unit 002: v1.5.1後方互換性の確保 - 実装計画

## 概要

v1.5.1 で `setup-cycle.md` が `setup.md` にリネームされたことによる後方互換性の問題を解決する。

## 問題の詳細

| バージョン | setup-cycle.md | setup.md |
|-----------|----------------|----------|
| v1.5.0以前 | あり | なし |
| v1.5.1以降 | なし | あり |

**問題のシナリオ**:
1. v1.5.0以前のプロジェクトで `setup-prompt.md`（v1.5.1以降）を実行
2. ケースC「アップグレード可能」で「2. 現在のバージョンのまま続行」を選択
3. `setup-prompt.md` は `docs/aidlc/prompts/setup.md` を読み込もうとする
4. アップグレードしていないので `setup.md` は存在しない
5. サイクル開始できない

## 修正方針

**フォールバック方式**:
1. まず `docs/aidlc/prompts/setup.md` の存在を確認
2. 存在する → プロジェクト内のファイルを使用
3. 存在しない → スターターキット内の `package/prompts/setup.md` を使用

## 修正対象ファイル

- `prompts/setup-prompt.md`

## 修正箇所

### 1. ケースB（行83付近）

**現状**:
```
**次のアクション**: プロジェクト内の `docs/aidlc/prompts/setup.md` を読み込み、処理を継続してください。ユーザーの操作を待たずに自動で読み込むこと。
```

**修正後**:
```
**次のアクション**:
1. `docs/aidlc/prompts/setup.md` の存在を確認
2. 存在する場合: プロジェクト内の `docs/aidlc/prompts/setup.md` を読み込む
3. 存在しない場合: このファイル（setup-prompt.md）と同じディレクトリにある `package/prompts/setup.md` を読み込む

ユーザーの操作を待たずに自動で読み込むこと。
```

### 2. ケースC「2を選択」（行106付近）

**現状**:
```
- **2 を選択**: プロジェクト内の `docs/aidlc/prompts/setup.md` を読み込む
```

**修正後**:
```
- **2 を選択**:
  1. `docs/aidlc/prompts/setup.md` の存在を確認
  2. 存在する場合: プロジェクト内のファイルを読み込む
  3. 存在しない場合: このファイルと同じディレクトリの `package/prompts/setup.md` を読み込む
```

### 3. ケースD（行124付近）

**現状**:
```
**次のアクション**: ユーザーが続行を承認した場合、プロジェクト内の `docs/aidlc/prompts/setup.md` を自動で読み込み、処理を継続してください。
```

**修正後**:
```
**次のアクション**: ユーザーが続行を承認した場合:
1. `docs/aidlc/prompts/setup.md` の存在を確認
2. 存在する場合: プロジェクト内のファイルを読み込む
3. 存在しない場合: このファイルと同じディレクトリの `package/prompts/setup.md` を読み込む
```

## 実装計画

### Phase 1: 設計（コードは書かない）

1. **ドメインモデル設計**: このUnitはプロンプトファイルの文字列修正のみであり、複雑なドメインモデルは不要。修正箇所の特定と影響範囲の分析に留める。

2. **論理設計**: 参照先パスの修正戦略を明確化
   - 相対パスで `package/prompts/setup.md` を参照
   - プロジェクト内ファイルの存在に依存しない

3. **設計レビュー**: ユーザー承認を得る

### Phase 2: 実装

1. **コード生成**: `prompts/setup-prompt.md` の該当箇所を修正
2. **テスト・検証**: 修正後のパスが正しいことを確認

## 影響範囲

- `setup-prompt.md` のみ
- 既存プロジェクトへの影響: なし（修正はスターターキット側のみ）

## リスク

- 低リスク: 単純な文字列置換のみ
