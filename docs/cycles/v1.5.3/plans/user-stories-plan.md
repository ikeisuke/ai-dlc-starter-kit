# ユーザーストーリー計画

## サイクル: v1.5.3

## 概要

Intentの対応項目11件を3つのEpicに分類してユーザーストーリーを作成する。

---

## Epic 1: セットアップ体験の改善

### ストーリー 1.1: zsh互換性の確保
**優先順位**: Must-have

As a macOSユーザー
I want to zshでもセットアップスクリプトが動作すること
So that macOSのデフォルトシェルでもエラーなくセットアップできる

**受け入れ基準**:
- [ ] grep -oP を使用しない代替実装になっている
- [ ] macOS (zsh) でセットアップが完了する
- [ ] Linux (bash) でもセットアップが完了する

**技術的考慮事項**:
- grep -E + sed または awk に置き換え
- 対象ファイル: prompts/setup-prompt.md:56, prompts/package/prompts/setup.md:73

---

### ストーリー 1.2: v1.5.1後方互換性の確保
**優先順位**: Must-have

As a v1.5.0以前のプロジェクトユーザー
I want to アップグレードせずにサイクル開始できること
So that 既存プロジェクトでもスムーズに新しいサイクルを開始できる

**受け入れ基準**:
- [ ] setup-cycle.md が存在しなくても動作する
- [ ] スターターキット内のsetup.mdを参照するようになっている
- [ ] エラーメッセージが明確

**技術的考慮事項**:
- prompts/setup-prompt.md でスターターキット内のファイルを参照

---

### ストーリー 1.3: サイクル名の自動引き継ぎ
**優先順位**: Must-have

As a 開発者
I want to セットアップからInceptionへサイクル名が自動で引き継がれること
So that 毎回サイクル名を指定する手間が省ける

**受け入れ基準**:
- [ ] setup.md完了メッセージにサイクル名が含まれる
- [ ] ブランチ名からサイクル名を自動推測できる
- [ ] inception.md がサイクル名を認識できる

**技術的考慮事項**:
- 完了メッセージの改善
- ブランチ名形式: cycle/vX.Y.Z

---

### ストーリー 1.4: アップグレード後の動作改善
**優先順位**: Should-have

As a アップグレードしたユーザー
I want to アップグレード完了後に自動でサイクル開始しないこと
So that 明示的に指示するまでサイクル開始を待機できる

**受け入れ基準**:
- [ ] アップグレード完了後は新しいセッションを案内
- [ ] ケースB（バージョン同じ）のみ自動進行
- [ ] 完了メッセージと実装が一致

---

### ストーリー 1.5: worktreeディレクトリ構造の改善
**優先順位**: Must-have

As a worktreeを使用する開発者
I want to worktreeが並列ディレクトリに作成されること
So that メインディレクトリが汚染されない

**受け入れ基準**:
- [ ] ../project-vX.Y.Z の形式でworktreeが作成される
- [ ] git -C を使用しない正しいコマンドが案内される
- [ ] 誤って作成した場合の修正手順がある

---

### ストーリー 1.6: AIによるworktree自動作成
**優先順位**: Should-have

As a 開発者
I want to AIがworktreeを自動作成すること
So that 手動でコマンドを実行する手間が省ける

**受け入れ基準**:
- [ ] worktree選択時にAIが自動でworktreeを作成する
- [ ] 権限エラー時は手動コマンドを表示
- [ ] ディスク容量不足時は警告を表示
- [ ] 既存worktree検出時は確認を求める

---

## Epic 2: AIレビュー機能の強化

### ストーリー 2.1: AIレビュー必須設定の確実な実行
**優先順位**: Must-have

As a 品質重視のプロジェクト管理者
I want to mode=required時にAIレビューが確実に実行されること
So that 人間承認前に必ずAIによる品質チェックが行われる

**受け入れ基準**:
- [ ] mode=required時は100%レビューが実行される
- [ ] MCP利用不可時は明確な警告メッセージを表示
- [ ] レビュースキップ時は理由を記録

---

### ストーリー 2.2: 人間承認前のAIレビュー自動化
**優先順位**: Must-have

As a 開発者
I want to 人間に承認を求める前にAIレビューが自動実行されること
So that 人間は高品質な成果物のみをレビューできる

**受け入れ基準**:
- [ ] 承認を求める全てのタイミングでAIレビューが先に実行される
- [ ] AIレビュー結果を人間に提示してから承認を求める
- [ ] mode=disabled以外では必ず実行される

---

### ストーリー 2.3: ブランチ名からのバージョン自動推測
**優先順位**: Should-have

As a 開発者
I want to ブランチ名からサイクルバージョンを自動推測すること
So that ブランチ作成済みの場合に再度バージョンを指定する必要がない

**受け入れ基準**:
- [ ] cycle/vX.Y.Z形式のブランチ名からバージョンを抽出
- [ ] 形式不一致時はユーザーに質問
- [ ] 抽出したバージョンをユーザーに確認

---

## Epic 3: 開発基盤の整備

### ストーリー 3.1: CI/CD構築
**優先順位**: Should-have

As a プロジェクト管理者
I want to PRマージ時にMarkdownリンターが実行されること
So that ドキュメントの品質が自動的に担保される

**受け入れ基準**:
- [ ] GitHub Actionsでワークフローが動作する
- [ ] PRに対してMarkdownリンターが実行される
- [ ] リンター結果がPRにコメントされる

---

### ストーリー 3.2: 監視・分析の案内
**優先順位**: Could-have

As a プロジェクト管理者
I want to GitHub Insightsの活用方法を知ること
So that プロジェクトの利用状況を把握できる

**受け入れ基準**:
- [ ] GitHub Insightsの活用案内がドキュメントに記載される
- [ ] 確認すべき指標が明示される

---

## 優先順位サマリー

| 優先度 | ストーリー数 | 内容 |
|--------|-------------|------|
| Must-have | 6 | 1.1, 1.2, 1.3, 1.5, 2.1, 2.2 |
| Should-have | 4 | 1.4, 1.6, 2.3, 3.1 |
| Could-have | 1 | 3.2 |
