# v1.0.0 テスト結果

## テスト実施日
2025-11-25

## 発見された問題

### 問題1: ヒストリファイル作成と記入の順序が逆転

**症状**:
ヒストリファイル作成と最初のヒストリ記入が逆転していた

**原因**:
プロンプトの記述が不明確だった：
- `prompts/setup-prompt.md:417` に「ファイルを読み込む必要はない（テンプレートが先頭にあるため）」と記載
- この記述により、AIがファイルが存在しない状態で追記しようとして順序が逆転する可能性があった

**修正内容**:
- `prompts/setup-prompt.md:409-420` の `history.md` セクションを明確化
  - 「初回セットアップ時にhistory.mdを作成」を明記
  - 「以降の各フェーズで既存ファイルに追記」を明記
  - 「ファイルを読み込む必要はない」の記述を削除
- `prompts/setup-prompt.md:245` の共通知識部分も同様に修正

**対応状況**:
- [x] 原因調査完了
- [x] 修正対応完了

---

### 問題2: テンプレートがJITのままでセットアップ時に作成されていない

**症状**:
テンプレートファイルがセットアップ時に作成されず、JIT（Just-In-Time）生成のままになっていた

**期待動作**:
セットアップ時に `docs/aidlc/templates/` にテンプレートファイルを作成する

**原因**:
`prompts/setup-prompt.md:433-436` で意図的にJIT生成方式を採用していた：
- MODE=setup の場合、個別のテンプレートファイルは作成しない（JIT生成するため）
- 各フェーズプロンプトで必要に応じてテンプレートを自動生成する設計

しかし、リリースノートには「テンプレートの共通化」と記載されており、期待とのギャップがあった。

**修正内容**:
- `prompts/setup-prompt.md:433-436` を修正：MODE=setup ですべてのテンプレートを作成するように変更
- 各フェーズプロンプトのテンプレート存在確認を完全に削除：
  - `inception.md`: テンプレート確認ステップを削除（セットアップ済み前提）
  - `construction.md`: 同上
  - `operations.md`: 同上
  - テンプレートが存在しない場合はファイル参照時に自然にエラーになる
- MODE=template 機能は維持（再生成または追加生成用）

**対応状況**:
- [x] 原因調査完了
- [x] 修正対応完了

---

### 問題3: 履歴記録とGitコミットの順序が非効率

**症状**:
各フェーズ完了時に以下の順序になり、2回のコミットが発生する：
1. Gitコミット（フェーズ完了）
2. history.md に履歴追記
3. 再度Gitコミット（履歴追記分）← 無駄

**期待動作**:
1. フェーズの作業完了
2. history.md に履歴追記
3. すべてまとめて1回のGitコミット

**原因**:
各フェーズプロンプトの「実行ルール」で「計画作成 → 承認 → 実行 → 履歴記録」の順序が指示されているが、Gitコミットのタイミングが「完了時の必須作業」として別セクションに記載されており、履歴記録の後になっている。

**修正方針**:
- 「実行ルール」を「計画作成 → 承認 → 実行 → 履歴記録 → Gitコミット」に変更
- 各フェーズの「完了時の必須作業」セクションから、履歴記録とGitコミットをまとめて記載し直す

**修正内容**:
- `inception.md` の「実行ルール」を簡潔化、「完了時の必須作業」に履歴記録→Gitコミットの順序を明記
- `construction.md` の「実行ルール」を簡潔化、「Unit完了時の必須作業」に履歴記録→Gitコミットの順序を明記
- `operations.md` の「実行ルール」を簡潔化、「完了時の必須作業」に履歴記録→Gitコミットの順序を明記

**対応状況**:
- [x] prompts/setup-prompt.md の各フェーズプロンプト定義を修正完了

---

### 問題4: Construction PhaseでInception完了確認が冗長

**症状**:
Construction Phaseの「最初に必ず実行すること」で以下の順序になっている：
- ステップ2: Inception完了確認（`ls` でファイル確認）
- ステップ3: progress.md 読み込み

**問題点**:
progress.mdが存在すれば、Inception Phaseは完了しているはず。
ステップ2のInception完了確認は不要。

**期待動作**:
progress.mdの読み込みのみで十分。progress.mdが存在しない場合は自然にエラーになる。

**修正方針**:
- Construction Phaseの「最初に必ず実行すること」からステップ2（Inception完了確認）を削除
- ステップ数を5ステップから4ステップに変更

**修正内容**:
- `construction.md` の「最初に必ず実行すること」からInception完了確認を削除
- ステップ番号を振り直し（5ステップ → 4ステップ）

**対応状況**:
- [x] prompts/setup-prompt.md のconstruction.md定義を修正完了

---

## 改善要望

### 要望1: 各フェーズでの進捗管理とコンテキストオーバーフロー対策

**背景**:
現在、progress.mdはConstruction Phaseのみで使用されている。
コンテキストオーバーフローした際の再開が、Inception PhaseとOperations Phaseで困難。

**要望内容**:
1. 全フェーズで進捗管理ファイルを導入
   - `docs/versions/v1.0.0/inception/progress.md` - Inceptionの各ステップ（Intent明確化、既存分析、ストーリー作成、Unit定義、PRFAQ作成）の進捗管理
   - `docs/versions/v1.0.0/construction/progress.md` - 既存（Unit管理）
   - `docs/versions/v1.0.0/operations/progress.md` - Operationsの各ステップ（デプロイ準備、CI/CD、監視、配布、運用）の進捗管理

2. 各フェーズプロンプトを読み込めば途中から自動再開
   - progress.mdを読んで、完了済みステップをスキップ
   - 未完了・進行中のステップから再開

**期待効果**:
- コンテキストオーバーフロー時に、フェーズプロンプトを読み込むだけで途中から再開可能
- 全フェーズで一貫した進捗管理

**実装内容**:
- Inception Phase:
  - progress.md自動作成・読み込み機能追加
  - 各ステップ開始時・完了時にprogress.md更新
  - バックトラックセクション追加（Unit追加・拡張）
- Operations Phase:
  - progress.md自動作成・読み込み機能追加
  - 各ステップ開始時・完了時にprogress.md更新
  - バックトラックセクション追加（バグ修正）
- Construction Phase:
  - バックトラックセクション追加（Inceptionに戻る、Operationsからのバグ修正）

**対応状況**:
- [x] 設計検討完了
- [x] プロンプト実装完了
- [ ] テンプレート追加

---

### 要望2: フェーズ間を戻る仕組み（バックトラック）

**背景**:
開発中に以下のようなケースで前のフェーズに戻る必要がある：
- Construction中にUnit追加・拡張が必要になった → Inceptionに戻る
- Operations中にバグ発見 → Constructionに戻る
- Construction中に要件変更 → Inceptionに戻る

**要望内容**:
フェーズを戻るための標準的な手順とプロンプトを用意

案1: 戻り専用プロンプト
- `docs/aidlc/prompts/back_to_inception.md` - Inceptionに戻る
- `docs/aidlc/prompts/back_to_construction.md` - Constructionに戻る

案2: 各フェーズプロンプトに「戻り方」セクションを追加
- Inception Phase: 「このフェーズに戻る場合」セクション
- Construction Phase: 「このフェーズに戻る場合」「Inceptionに戻る場合」セクション
- Operations Phase: 「このフェーズに戻る場合」「Constructionに戻る場合」セクション

**期待効果**:
- 柔軟な開発フロー（前のフェーズに戻って修正可能）
- Unit追加・要件変更に対応可能

**実装内容**:
要望1と統合して実装済み（各フェーズプロンプトに「このフェーズに戻る場合」セクション追加）

**対応状況**:
- [x] 設計検討完了
- [x] 実装完了

---

## その他の問題
（追加予定）
