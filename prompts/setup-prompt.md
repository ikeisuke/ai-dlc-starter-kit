# AI-DLC セットアップ - エントリーポイント

このファイルは AI-DLC セットアップのエントリーポイントです。
プロジェクトの状態を判定し、適切なセットアッププロンプトへ誘導します。

---

## 共通ルール

- **予想禁止・一問一答質問ルール【重要】**: 不明点や判断に迷う点がある場合、予想や仮定で進めてはいけない。必ずユーザーに質問する。

  **質問フロー（ハイブリッド方式）**:
  1. まず質問の数と概要を提示する
  2. 1問ずつ詳細を質問し、回答を待つ
  3. 回答を得てから次の質問に進む
  4. 回答に基づく追加質問が発生した場合は「追加で確認させてください」と明示して質問する

---

## 1. 実行環境の確認

**まず最初に、現在のカレントディレクトリを確認してください**:

```bash
pwd
```

**このセットアップは、対象プロジェクトのルートディレクトリで実行する必要があります。**

もし現在のディレクトリが `ai-dlc-starter-kit` リポジトリ内の場合:
- **このままセットアップを実行しないでください**
- **対象プロジェクトのルートディレクトリに移動してから、このファイルのフルパスを指定して再度実行してください**

**確認が完了したら、以下をユーザーに表示してください**:

```
現在のディレクトリ: [pwd の結果]

このディレクトリで AI-DLC セットアップを実行してよろしいですか？
```

ユーザーが「はい」と明示的に承認するまで、次のステップに進まないでください。

---

## 2. セットアップ種類の判定

以下のファイルの存在とバージョンを確認してください:

```bash
# aidlc.toml（新形式）または project.toml（旧形式）の存在確認
ls docs/aidlc.toml 2>/dev/null && echo "AIDLC_TOML_EXISTS" || \
  (ls docs/aidlc/project.toml 2>/dev/null && echo "PROJECT_TOML_EXISTS" || echo "CONFIG_NOT_EXISTS")

# プロジェクトのバージョン確認（aidlc.toml の starter_kit_version フィールド）
grep -oP 'starter_kit_version\s*=\s*"\K[^"]+' docs/aidlc.toml 2>/dev/null || echo "VERSION_NOT_FOUND"
```

また、このファイル（setup-prompt.md）のディレクトリから `../version.txt` を読み込み、**スターターキットのバージョン**を確認してください。

### 判定結果に基づく対応

#### ケース A: 設定ファイルが存在しない（初回セットアップ）

以下のメッセージを表示してください:

```
AI-DLC の初回セットアップを行います。
```

**次のアクション**: このファイル（setup-prompt.md）と同じディレクトリにある `setup-init.md` を読み込み、処理を継続してください。ユーザーの操作を待たずに自動で読み込むこと。

---

#### ケース B: `aidlc.toml` が存在 & バージョン同じ（サイクル開始）

以下のメッセージを表示してください:

```
AI-DLC は最新です。新しいサイクルを開始します。
```

**次のアクション**: プロジェクト内の `docs/aidlc/prompts/setup.md` を読み込み、処理を継続してください。ユーザーの操作を待たずに自動で読み込むこと。

---

#### ケース C: `aidlc.toml` が存在 & プロジェクトが古い（アップグレード可能）

以下のメッセージを表示し、ユーザーの選択を待ってください:

```
AI-DLC のアップグレードが利用可能です。

現在のバージョン: [aidlc.toml の starter_kit_version]
最新バージョン: [スターターキットの version.txt]

選択してください:
1. アップグレードする（プロンプト・テンプレートを更新）
2. 現在のバージョンのまま新しいサイクルを開始する

どちらを選択しますか？
```

**次のアクション**: ユーザーの選択後、該当ファイルを自動で読み込み、処理を継続してください:
- **1 を選択**: `setup-init.md` を読み込む（アップグレードモード）
- **2 を選択**: プロジェクト内の `docs/aidlc/prompts/setup.md` を読み込む

ユーザーの操作を待たずに自動で読み込むこと。

---

#### ケース D: プロジェクトが新しい（警告）

aidlc.toml の starter_kit_version > スターターキットの version.txt の場合:

```
警告: プロジェクトのバージョンがスターターキットより新しいです。

プロジェクト: [aidlc.toml の starter_kit_version]
スターターキット: [スターターキットの version.txt]

スターターキットのアップデートを推奨します。
現在のバージョンで続行しますか？
```

**次のアクション**: ユーザーが続行を承認した場合、プロジェクト内の `docs/aidlc/prompts/setup.md` を自動で読み込み、処理を継続してください。ユーザーの操作を待たずに自動で読み込むこと。

---

## 補足: 後方互換性

### 旧形式（project.toml）が存在する場合

`docs/aidlc.toml` は存在しないが `docs/aidlc/project.toml` が存在する場合:
- これは旧バージョンの AI-DLC でセットアップされたプロジェクトです
- `setup-init.md` を読み込み、移行モードとして処理してください

### さらに古い形式（version.txt のみ）が存在する場合

`docs/aidlc/project.toml` も `docs/aidlc.toml` も存在しないが `docs/aidlc/version.txt` が存在する場合:
- これはさらに旧バージョンの AI-DLC でセットアップされたプロジェクトです
- ケース A（初回セットアップ）として扱い、移行を案内してください

---

## AI-DLC 概要

AI-DLC（AI-Driven Development Lifecycle）は、AIを開発の中心に据えた新しい開発手法です。

**主要原則**:
- **会話の反転**: AIが作業計画を提示し、人間が承認・判断する
- **設計技法の統合**: DDD・BDD・TDDをAIが自動適用
- **短サイクル反復**: 各フェーズを短いサイクルで反復

**3つのフェーズ**:
1. **Inception**: 要件定義、ユーザーストーリー作成、Unit分解
2. **Construction**: 設計、実装、テスト
3. **Operations**: デプロイ、監視、運用
