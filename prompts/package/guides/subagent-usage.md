# サブエージェント活用ガイド

> **対象ツール**: Claude Code専用
>
> このガイドはClaude CodeのTask Toolを使用したサブエージェント機能を前提としています。
> 他のAIエージェントツール（Cursor、GitHub Copilot等）では動作しません。

## 概要

サブエージェントとは、Claude CodeのTask Toolで起動される独立したAIエージェントです。メインエージェント（ユーザーと対話中のエージェント）から特定のタスクを委任することで、効率的な並行作業が可能になります。

### いつ使用すべきか

- 独立して完結可能なタスクがある場合
- ユーザーとの対話が不要な定型作業
- メインの作業フローを中断したくない場合

## 委任可能な作業

以下のタスクはサブエージェントへの委任に適しています。

### バックログ関連

- バックログファイルの作成（`docs/cycles/backlog/`）
- GitHub Issueの作成
- 詳細は `docs/aidlc/guides/backlog-management.md` を参照

### ビルド・検証関連

- Markdownlint実行と自動修正
- ユニットテスト実行
- ビルドコマンド実行

### 独立したファイル編集

- 単一ファイルの定型編集
- 履歴ファイルへの追記
- 独立したドキュメントの作成

## 委任不可の作業（メインで処理）

以下のタスクはサブエージェントに委任せず、メインエージェントで処理してください。

- **ユーザーとの対話・承認取得**: 質問や確認が必要な作業
- **設計レビュー**: フィードバックを反映する必要がある作業
- **MCPレビュー**: レビュー結果に基づく判断が必要
- **一貫性が必要な複数ファイル編集**: 依存関係のあるファイル群の同時編集

## 委任可否判断チェックリスト

以下の**全て**に「はい」なら委任可能です:

| # | 確認項目 | はい/いいえ |
|---|---------|------------|
| 1 | ユーザーへの確認や承認は不要か？ | |
| 2 | 単一ファイルまたは完全に独立した複数ファイルへの作業か？ | |
| 3 | 明確な完了条件があるか？ | |
| 4 | メインエージェントのコンテキストなしで実行可能か？ | |

1つでも「いいえ」がある場合は、メインエージェントで処理してください。

## 実行パターン

### 直列実行（推奨）

タスクを1つずつ順番に実行するパターンです。

**利点**:

- 編集衝突がない
- デバッグしやすい
- 結果を確認しながら進められる

**適用場面**:

- 同一ファイルへの複数変更
- 前のタスクの結果に依存する作業

### 並列実行

複数タスクを同時実行するパターンです。

**利点**:

- 実行時間の短縮

**リスク**:

- ファイル編集の衝突

**適用場面**:

- 完全に独立したタスク（異なるファイル・異なる領域）

**並列実行の禁止条件**:

- 同一ファイルを編集する可能性がある
- 同一ディレクトリのインデックス（目次等）を更新する
- 依存関係のあるファイル群を編集する

## サンプル指示テンプレート

### バックログ追加の指示例

```text
以下のバックログ項目をGitHub Issueとして作成してください。

タイトル: [タイトル]
種類: feature / bugfix / chore
優先度: 高 / 中 / 低
内容:
[詳細な説明]

ラベル: cycle/vX.X.X を付与してください。
```

### Markdownlint実行の指示例

```text
以下のファイルに対してMarkdownlintを実行し、エラーがあれば自動修正してください。

対象: docs/cycles/vX.X.X/**/*.md

修正後、変更内容を報告してください。
```

### 履歴追記の指示例

```text
以下の内容を履歴ファイルに追記してください。

ファイル: docs/cycles/vX.X.X/history/construction_unitN.md

内容:
## [現在日時]
- フェーズ: Construction Phase
- Unit: [Unit名]
- ステップ: [ステップ名]
- 実行内容: [作業概要]
- 成果物: [ファイルリスト]
```

## 注意事項

- サブエージェントはメインエージェントのコンテキストを共有しません
- 必要な情報は全て指示に含めてください
- 結果は必ず確認し、必要に応じて修正してください
