# プランモード活用ガイド

> **対象ツール**: Claude Code専用
>
> このガイドはClaude CodeのEnterPlanMode機能を前提としています。
> 他のAIエージェントツール（Cursor、Codex CLI等）では動作しません。

## 1. プランモードとは

### 概要

プランモード（Plan Mode）は、Claude Codeの機能で、実装前に計画を立案・レビューするためのモードです。

コードベースを探索し、実装アプローチを検討した上で、ユーザーと合意形成を行ってから実装に進むことができます。

### メリット

| メリット | 説明 |
|----------|------|
| コードベース理解 | 既存コードを探索し、パターンやアーキテクチャを把握してから設計できる |
| 手戻り削減 | 実装前にアプローチを確認することで、方向性の誤りを早期に発見 |
| 認識合わせ | ユーザーと計画を共有し、期待値を合わせてから実装を開始 |

---

## 2. 使い方

### EnterPlanMode（プランモード開始）

Claude Codeが自動的にプランモードへの移行を提案する場合があります。

**プランモードで行えること**:

- コードベースの探索（Read, Grep, Glob等の読み取り系ツール）
- 既存パターンとアーキテクチャの理解
- 実装アプローチの設計・提案
- ユーザーへの計画提示

**プランモードで行えないこと**:

- ファイルの作成・編集（Edit, Write等の編集系ツール）
- コードの実行（Bash等）

### ExitPlanMode（プランモード終了）

ユーザーが計画を承認した後、ExitPlanModeで通常モードに戻り、実装を開始します。

**フロー**:

```text
1. EnterPlanMode（探索・計画策定）
      ↓
2. 計画をユーザーに提示
      ↓
3. ユーザー承認
      ↓
4. ExitPlanMode
      ↓
5. 実装開始
```

---

## 3. AI-DLCでの活用シーン

> **注**: AI-DLCでは現行フロー（Phase 1設計 → Phase 2実装）を基本とし、プランモードは**オプション**として必要に応じて活用する方針です（v1.7.2検討結果）。

### 活用が有効なケース

以下の場合にプランモードの活用が有効です：

| ケース | 例 |
|--------|-----|
| 複雑なUnit実装前 | アーキテクチャ決定が必要な機能追加 |
| 既存コード理解が必要 | 既存システムへの機能追加・修正 |
| 複数アプローチの選択 | キャッシュ方式、認証方式等の技術選定 |
| 要件が不明確 | パフォーマンス改善等、調査が必要なタスク |

### 非推奨ケース

以下の場合はプランモードを使用せず、直接実装に進むことを推奨します：

| ケース | 理由 |
|--------|------|
| 指示が明確 | 探索不要で即座に実装可能 |
| 軽微な修正 | タイポ修正、一行変更等 |
| 純粋なリサーチ | Task/Exploreエージェントを使用（実装を伴わない調査） |

### AI-DLC Phase 1との関係

プランモードはAI-DLC Construction Phaseの **Phase 1（設計）の前** に位置づけられます。

```text
[プランモード]（オプション）
    ↓ 探索結果をドメインモデル・論理設計に反映
Phase 1: 設計
├── ドメインモデル設計
├── 論理設計
└── 設計レビュー → 承認
    ↓
Phase 2: 実装
```

**プランモードの探索結果の活用**:

- 既存コードのパターンやアーキテクチャの理解 → ドメインモデル設計に反映
- 技術的な実装アプローチの検討結果 → 論理設計に反映

**重要**: プランモードの承認とAI-DLC設計レビューの承認は別物です。両方の承認プロセスが必要です。

---

## 4. 注意事項

### 編集制約

プランモード中は編集系ツールが使用できません。計画の記録が必要な場合は、ExitPlanMode後に設計ドキュメントとして作成します。

### 承認フローの関係

| 承認 | タイミング | 対象 |
|------|------------|------|
| プランモード承認 | ExitPlanMode前 | 実装アプローチの概要 |
| AI-DLC設計承認 | Phase 1完了時 | ドメインモデル・論理設計 |

### Task/Exploreとの使い分け

| モード | 目的 | 使用場面 |
|--------|------|----------|
| プランモード | 実装計画策定のための探索 | 実装タスクの前準備 |
| Task/Explore | 情報収集のみ | 調査・リサーチタスク |

**判断基準**: 探索後に実装を行う予定がある場合はプランモード、調査のみで完結する場合はTask/Exploreを使用します。

---

## 参考

- Claude Code EnterPlanMode（Claude Code内蔵ツール仕様）
  - **注**: EnterPlanModeの仕様はClaude Code内蔵ツールとして提供されており、公式ドキュメントとしては公開されていません。バージョンや設定により動作が異なる可能性があります。
- AI-DLC Construction Phase プロンプト (`docs/aidlc/prompts/construction.md`)
- v1.7.2 プランモード活用検討 (`docs/cycles/v1.7.2/requirements/plan-mode-research.md`)
