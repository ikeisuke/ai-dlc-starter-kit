---
name: codex
description: OpenAI Codex CLIを使用したコードレビュー、分析、コードベースへの質問を実行する。使用場面: (1) コードレビュー依頼時、(2) コードベース全体の分析、(3) 実装に関する質問、(4) バグの調査、(5) リファクタリング提案、(6) 解消が難しい問題の調査。トリガー: "codex", "コードレビュー", "レビューして", "分析して", "/codex"
---

# Codex

Codex CLIを使用してコードレビュー・分析を実行するスキル。

## 実行コマンド

```bash
codex exec -s read-only -C <project_directory> "<request>"
```

## セッション継続（resume）

前回のセッションを継続して会話する場合:

```bash
codex exec resume <session-id> "<request>"
```

- セッションIDは前回の実行結果の末尾に表示されます（例: `session id: xxx`）
- resumeを使用すると、前回のセッション設定（`-C`、`-s`等）が通常継承されます
- 同じコンテキストで追加の質問や確認ができます

## 反復レビュー時のルール【重要】

AI-DLCの反復レビューフロー（`docs/aidlc/prompts/common/review-flow.md`）でCodexを使用する際は、**必ずresumeを使用**してください。

### session idの確認・記録

1. **初回レビュー実行後**: 出力末尾に表示される session id を確認
2. **session idを記録**: 後続のレビューで使用するため、session idを控えておく
3. **2回目以降**: `codex exec resume <session-id> "<request>"` で継続（`-C`/`-s`は通常継承）

### resumeを使うべき場面

| 場面 | resume使用 | 理由 |
|------|------------|------|
| 反復レビュー（2回目以降） | 必須 | 前回の指摘内容を踏まえた継続レビューが必要 |
| 指摘への追加質問 | 必須 | 指摘の文脈を保持したまま深掘りできる |
| 修正後の再レビュー | 必須 | 修正箇所と元の指摘の関連を理解できる |
| 別のUnitや独立したレビュー対象 | 不要 | 新しいコンテキストで開始すべき |

**注**: 反復レビュー中に新規ファイルが追加された場合も、同じセッション（resume）を使用してください。「独立したレビュー対象」とは、別のUnitや別のレビュータスクを指します。

### 反復レビューの流れ

```text
[1回目] codex exec -s read-only -C . "コードをレビューしてください"
        → 指摘あり、session id: abc123

[修正を実施]

[2回目] codex exec resume abc123 "指摘を修正しました。再度レビューしてください"
        → 追加指摘あり

[修正を実施]

[3回目] codex exec resume abc123 "追加の修正を行いました。確認してください"
        → 指摘なし、レビュー完了
```

### 注意事項

- session idを紛失した場合は、新規セッションで再開（ただし前回の文脈は失われる）
- 長時間経過するとセッションが期限切れになる場合がある
- セッション期限切れの場合は新規セッションで再開

## パラメータ

| パラメータ | 説明 |
|-----------|------|
| `-s read-only` | 読み取り専用サンドボックス（安全な分析用） |
| `-s workspace-write` | ワークスペース書き込み可能 |
| `-C <dir>` | 対象プロジェクトのディレクトリ |
| `--full-auto` | 自動実行（`-s workspace-write`を含む、読み取り専用と併用不可） |
| `"<request>"` | 依頼内容（日本語可） |

## 使用例

### コードレビュー（読み取り専用）

```bash
codex exec -s read-only -C /path/to/project "このプロジェクトのコードをレビューして、改善点を指摘してください"
```

### バグ調査（読み取り専用）

```bash
codex exec -s read-only -C /path/to/project "認証処理でエラーが発生する原因を調査してください"
```

### 自動修正（書き込み可能）

```bash
codex exec --full-auto -C /path/to/project "このバグを修正してください"
```

### セッション引き継ぎ

上記「セッション継続（resume）」セクションを参照。

## 実行手順

1. ユーザーから依頼内容を受け取る
2. 対象プロジェクトのディレクトリを特定する
3. 上記コマンド形式でCodexを実行
4. 結果をユーザーに報告
