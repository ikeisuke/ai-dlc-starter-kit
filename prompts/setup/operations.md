# Operations Phase セットアップ

このファイルは `prompts/setup-prompt.md` から参照されます。

---

## operations.md プロンプト生成

`{{AIDLC_ROOT}}/prompts/operations.md` を作成：

```markdown
# Operations Phase プロンプト

**セットアッププロンプトパス**: {{SETUP_PROMPT_PATH}}

（このパスはテンプレート生成時に使用します）

---

## AI-DLC手法の要約

AI-DLCは、AIを開発の中心に据えた新しい開発手法です。従来のSDLCやAgileが「人間中心・長期サイクル」を前提としているのに対し、AI-DLCは「AI主導・短サイクル」で開発を推進します。

**主要原則**:
- **会話の反転**: AIが作業計画を提示し、人間が承認・判断する
- **設計技法の統合**: DDD・BDD・TDDをAIが自動適用
- **冪等性の保証**: 各ステップで既存成果物を確認し、差分のみ更新

**3つのフェーズ**: Inception（要件定義）→ Construction（実装）→ Operations（運用）
- **Inception**: Intentを具体的なUnitに分解し、ユーザーストーリーを作成
- **Construction**: ドメイン設計・論理設計・コード・テストを生成
- **Operations**: デプロイ・監視・運用を実施

**主要アーティファクト**:
- **Intent**: 開発の目的と狙い
- **Unit**: 独立した価値提供ブロック（Epic/Subdomainに相当）
- **Domain Design**: DDDに従ったビジネスロジックの構造化
- **Logical Design**: 非機能要件を反映した設計層

---

## プロジェクト情報

### プロジェクト概要
{{PROJECT_SUMMARY}}

### 技術スタック
Inception Phaseで決定済み、または既存スタックを使用

### ディレクトリ構成
- `{{AIDLC_ROOT}}/`: 共通プロンプト・テンプレート
- `{{CYCLES_ROOT}}/{{CYCLE}}/`: サイクル固有成果物
- プロジェクトルート: 実装コード

### 制約事項
- **ドキュメント読み込み制限**: ユーザーから明示的に指示されない限り、`{{CYCLES_ROOT}}/{{CYCLE}}/` 配下のファイルのみを読み込む（コンテキスト溢れ防止）
- プロジェクト固有の制約は `{{AIDLC_ROOT}}/prompts/additional-rules.md` を参照

### 開発ルール
- **人間の承認プロセス【重要】**: 計画作成後、必ず ①計画ファイルのパス提示、②「この計画で進めてよろしいですか？」と質問、③承認まで待機、④**承認なしで次のステップを開始しない**
- **質問と回答の記録【重要】**: 独自の判断をせず、不明点は `[Question]` タグで記録し `[Answer]` タグを配置。**一問一答形式で対話**（複数の質問をまとめない）
- **Gitコミットのタイミング【必須】**: セットアップ完了時、Inception Phase完了時、各Unit完了時、Operations Phase完了時
- **プロンプト履歴管理【重要】**: history.mdは必ず追記のみ（既存履歴を削除・上書きしない）。日時は `date '+%Y-%m-%d %H:%M:%S %Z'` で取得

### フェーズの責務分離
- **Inception Phase**: 要件定義とUnit分解（`{{AIDLC_ROOT}}/prompts/inception.md`）
- **Construction Phase**: 実装とテスト（`{{AIDLC_ROOT}}/prompts/construction.md`）
- **Operations Phase**: デプロイと運用（このフェーズ）

### 進捗管理と冪等性
- 各ステップ開始時に既存成果物を確認
- 存在するファイルのみ読み込む（全ファイルを一度に読まない）
- 差分のみ更新、完了済みのステップはスキップ

### テンプレート参照
ドキュメント作成時は `{{AIDLC_ROOT}}/templates/` 配下のテンプレートを参照

---

## あなたの役割

あなたは{{ROLE_OPERATIONS}}です。

---

## 最初に必ず実行すること（4ステップ）

### 0. サイクル確認【最重要】
- CYCLE変数が設定されているか確認（例: `CYCLE = v1.0.1`）
- **未設定の場合**: `ls -t {{CYCLES_ROOT}}/ | head -5` で既存サイクル一覧を表示し、ユーザーに選択を促す
- **設定済みの場合**: サイクルディレクトリの存在を確認し、存在すれば継続

### 1. 追加ルール確認
`{{AIDLC_ROOT}}/prompts/additional-rules.md` を読み込む

### 2. 進捗管理ファイル確認【重要】
- `{{CYCLES_ROOT}}/{{CYCLE}}/operations/progress.md` が存在するか確認
- **存在する場合**: 読み込んで完了済みステップを確認、未完了から再開
- **存在しない場合**: 初回実行として progress.md を作成（PROJECT_TYPEに応じて配布ステップを「スキップ」に設定）

### 3. 既存成果物の確認（冪等性の保証）
- `ls {{CYCLES_ROOT}}/{{CYCLE}}/operations/` で既存ファイルを確認
- 存在するファイルのみ読み込み、差分のみ更新

---

## フロー（各ステップ完了時にprogress.mdを更新）

1. **デプロイ準備【対話形式】**: 不明点は `[Question]`/`[Answer]` で記録、**一問一答形式**
2. **CI/CD構築【対話形式】**: 同様に**一問一答形式**で対話
3. **監視・ロギング戦略【対話形式】**: 同様に**一問一答形式**で対話
4. **配布**（モバイルの場合のみ、それ以外はスキップ）【対話形式】
5. **リリース後の運用【対話形式】**

（各ステップはテンプレートを参照）

---

## 実行ルール
計画作成 → 人間の承認【重要: 計画ファイルのパス提示、「進めてよろしいですか？」と質問、承認を待つ】→ 実行

---

## 完了基準
- すべて完成、デプロイ完了、CI/CD動作、監視開始

---

## 完了時の必須作業【重要】

1. **履歴記録**: `{{CYCLES_ROOT}}/{{CYCLE}}/history.md` に追記（heredoc使用、日時は `date '+%Y-%m-%d %H:%M:%S %Z'`）
2. **Gitコミット**: 作成したすべてのファイルをコミット

---

## このフェーズに戻る場合【バックトラック】

Constructionに戻る必要がある場合（バグ修正・機能修正）:
1. 現在のprogress.mdを確認
2. `{{AIDLC_ROOT}}/prompts/construction.md` を読み込み
3. Construction Phaseの「Operations Phaseからバグ修正で戻ってきた場合」セクションの手順に従う
4. 修正完了後、`{{AIDLC_ROOT}}/prompts/operations.md` を読み込んで再開

---

## AI-DLCサイクル完了【重要】

1. **フィードバック収集**: ユーザーからのフィードバック、メトリクス、課題を収集
2. **分析と改善点洗い出し**: 次期バージョンで対応すべき改善点をリストアップ

### 2.5. バックログ記録【重要】
次サイクル以降で対応すべきタスクをバックログに記録:
- タスクの集約（課題、改善点、バグ、機能リクエスト）
- ユーザーに質問: 「次サイクル以降で対応すべきタスクはありますか？」
- バックログファイル（`{{CYCLES_ROOT}}/backlog.md`）に追記
- 完了したタスクは `{{CYCLES_ROOT}}/backlog_completed.md` に移動

3. **次期サイクルの計画**: 新しいサイクル識別子を決定
4. **次のサイクル開始【重要】**: 新しいセッションでセットアップを実行
5. **ライフサイクルの継続**: Inception → Construction → Operations → (次サイクル) を繰り返し
```

---

## Operations Phase テンプレート

### deployment_checklist_template.md

```markdown
# デプロイチェックリスト

## デプロイ情報
- **バージョン**: [バージョン]
- **デプロイ予定日**: [日付]
- **デプロイ環境**: [本番 / ステージング / 開発]
- **担当者**: [名前]

## デプロイ前チェックリスト

### コード品質
- [ ] すべてのテストがパスしている
- [ ] ビルドが成功している
- [ ] コードレビューが完了している

### 環境設定
- [ ] 環境変数が設定されている
- [ ] 設定ファイルが正しい
- [ ] 依存関係がすべてインストールされている

### データベース
- [ ] マイグレーションスクリプトが準備されている
- [ ] バックアップが取得されている
- [ ] ロールバックスクリプトが準備されている

### 監視・ログ
- [ ] 監視ツールが設定されている
- [ ] ログ収集が設定されている
- [ ] アラート設定が完了している

## デプロイ手順

### 1. 事前準備
\`\`\`bash
# バックアップ取得
[コマンド]
\`\`\`

### 2. デプロイ実行
\`\`\`bash
# デプロイコマンド
[コマンド]
\`\`\`

### 3. 動作確認
- [ ] ヘルスチェックが成功する
- [ ] 主要機能が動作する
- [ ] ログにエラーがない

## ロールバック手順
\`\`\`bash
# 前バージョンに戻す
[コマンド]
\`\`\`

## デプロイ後チェックリスト
- [ ] ヘルスチェックが正常
- [ ] 主要機能が動作している
- [ ] エラーログがない

## 緊急連絡先
- **担当者**: [名前・連絡先]
- **エスカレーション先**: [名前・連絡先]
```

---

### monitoring_strategy_template.md

```markdown
# 監視・ロギング戦略

## 概要
[監視の目的と範囲]

## 監視項目

### システムメトリクス
- **CPU 使用率**: 閾値 80% でアラート
- **メモリ使用率**: 閾値 85% でアラート
- **ディスク使用率**: 閾値 90% でアラート

### アプリケーションメトリクス
- **リクエスト数**: [期待値]
- **レスポンスタイム**: 閾値 [N] ms でアラート
- **エラー率**: 閾値 [N]% でアラート

## 監視ツール
- **メトリクス監視**: [Prometheus, CloudWatch, Datadog 等]
- **ログ管理**: [ELK Stack, CloudWatch Logs 等]
- **ダッシュボード**: [Grafana, Kibana 等]

## アラート設定

### クリティカル（即座に対応）
- **条件**: [...]
- **通知先**: [メール、Slack、PagerDuty 等]

### 警告（確認が必要）
- **条件**: [...]
- **通知先**: [...]

## ログ設定

### ログレベル
- **ERROR**: エラー発生時
- **WARN**: 警告
- **INFO**: 通常の情報
- **DEBUG**: デバッグ情報（本番では無効化）

### ログ保持期間
- **本番環境**: [N] 日
- **ステージング**: [N] 日

## オンコール対応
- **担当者**: [ローテーション]
- **対応時間**: [24/7 / 営業時間内]

## 定期レビュー
- **頻度**: [週次 / 月次]
```

---

### distribution_feedback_template.md

```markdown
# 配布記録

## 配布情報
- **バージョン**: [バージョン]
- **配布日**: [日付]
- **配布チャネル**: [App Store / Google Play / npm 等]

## 配布準備

### チェックリスト
- [ ] アプリ/パッケージが署名されている
- [ ] メタデータが準備されている
- [ ] 配布チャネルのガイドラインに準拠している

## レビュー対応（該当する場合）
- **提出日**: [日付]
- **レビュー結果**: [承認 / リジェクト]
- **フィードバック**: [レビュアーからのフィードバック]

## 配布後のフィードバック

### ユーザーレビュー
- **平均評価**: [星の数]
- **主なフィードバック**: [...]

### バグレポート
- [バグ1]
- [バグ2]

### 機能リクエスト
- [リクエスト1]
- [リクエスト2]

## 次期バージョンへの反映
[フィードバックを元にした改善計画]
```

---

### post_release_operations_template.md

```markdown
# リリース後の運用記録

## リリース情報
- **バージョン**: [バージョン]
- **リリース日**: [日付]
- **リリース内容**: [要約]

## 運用状況

### 稼働状況
- **稼働率**: [N]%
- **ダウンタイム**: [N] 時間
- **インシデント数**: [N] 件

### パフォーマンス
- **平均レスポンスタイム**: [N] ms
- **リクエスト数**: [N] / 日

### ユーザー数
- **アクティブユーザー数**: [N]
- **新規ユーザー数**: [N]

## インシデント対応

### インシデント1: [タイトル]
- **発生日時**: [日時]
- **内容**: [...]
- **対応内容**: [...]
- **根本原因**: [...]
- **再発防止策**: [...]

## バグ対応

### 修正済みバグ
- [バグ1] - [修正バージョン]

### 未修正バグ
- [バグ2] - [優先度] - [予定修正バージョン]

## ユーザーフィードバック

### ポジティブ
- [フィードバック1]

### ネガティブ
- [フィードバック1]

### 機能リクエスト
- [リクエスト1] - [優先度]

## 改善点の洗い出し
- **パフォーマンス改善**: [...]
- **ユーザビリティ改善**: [...]
- **新機能**: [...]

## 次期バージョンの計画
- **対象バージョン**: [バージョン]
- **主要な改善・新機能**: [...]
- **リリース予定**: [日付]
```

---

### operations_progress_template.md

```markdown
# Operations Phase 進捗管理

## ステップ一覧

| ステップ | 状態 | 成果物 | 完了日 |
|---------|------|--------|--------|
| 1. デプロイ準備 | 未着手 | operations/deployment_checklist.md | - |
| 2. CI/CD構築 | 未着手 | operations/cicd_setup.md | - |
| 3. 監視・ロギング戦略 | 未着手 | operations/monitoring_strategy.md | - |
| 4. 配布 | 未着手 | operations/distribution_plan.md | - |
| 5. リリース後の運用 | 未着手 | operations/post_release_operations.md | - |

## 現在のステップ
次回: 1. デプロイ準備

## 完了済みステップ
なし

## 次回実行時の指示
デプロイ準備から開始してください。

## プロジェクト種別による差異
- モバイルアプリ（ios/android）: 全ステップ実施
- Web/バックエンド（web/backend/general）: ステップ4（配布）をスキップ

## 最終更新
日時: [自動設定]
```

**注意**: PROJECT_TYPEがweb/backend/generalの場合、ステップ4を「スキップ」に設定

---

### backlog_template.md

```markdown
# バックログ

このファイルは次サイクル以降で対応すべきタスクを管理します。

## タスク一覧

| ID | タイトル | カテゴリ | 優先度 | 記録元サイクル | 記録日 |
|----|---------|---------|--------|---------------|--------|

## タスク詳細

（新しいタスクは以下の形式で追記してください）

### BACKLOG-XXX: [タイトル]
- **カテゴリ**: [bug/feature/improvement/refactoring/documentation/technical_debt/other]
- **優先度**: [high/medium/low]
- **記録元サイクル**: [サイクル名]
- **記録日**: [日付]
- **詳細説明**:
  [タスクの詳細]
```

---

### backlog_completed_template.md

```markdown
# 完了済みバックログ

このファイルは過去のサイクルで完了したバックログタスクを記録します。

## 完了タスク一覧

| ID | タイトル | カテゴリ | 完了サイクル | 完了日 |
|----|---------|---------|-------------|--------|

## タスク詳細

（完了したタスクはbacklog.mdから移動されます）
```
